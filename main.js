!function(t){function e(e){for(var i,r,a=e[0],c=e[1],l=e[2],d=0,m=[];d<a.length;d++)r=a[d],o[r]&&m.push(o[r][0]),o[r]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(t[i]=c[i]);for(u&&u(e);m.length;)m.shift()();return s.push.apply(s,l||[]),n()}function n(){for(var t,e=0;e<s.length;e++){for(var n=s[e],i=!0,a=1;a<n.length;a++){var c=n[a];0!==o[c]&&(i=!1)}i&&(s.splice(e--,1),t=r(r.s=n[0]))}return t}var i={},o={3:0},s=[];function r(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.e=function(t){var e=[],n=o[t];if(0!==n)if(n)e.push(n[2]);else{var i=new Promise(function(e,i){n=o[t]=[e,i]});e.push(n[2]=i);var s=document.getElementsByTagName("head")[0],a=document.createElement("script");a.charset="utf-8",a.timeout=120,r.nc&&a.setAttribute("nonce",r.nc),a.src=function(t){return r.p+""+({}[t]||t)+".js"}(t);var c=setTimeout(function(){l({type:"timeout",target:a})},12e4);function l(e){a.onerror=a.onload=null,clearTimeout(c);var n=o[t];if(0!==n){if(n){var i=e&&("load"===e.type?"missing":e.type),s=e&&e.target&&e.target.src,r=new Error("Loading chunk "+t+" failed.\n("+i+": "+s+")");r.type=i,r.request=s,n[1](r)}o[t]=void 0}}a.onerror=a.onload=l,s.appendChild(a)}return Promise.all(e)},r.m=t,r.c=i,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},r.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r.oe=function(t){throw console.error(t),t};var a=window.webpackJsonp=window.webpackJsonp||[],c=a.push.bind(a);a.push=e,a=a.slice();for(var l=0;l<a.length;l++)e(a[l]);var u=c;s.push([27,2]),n()}({27:function(t,e,n){"use strict";n.r(e),n(57),n(56),n(54);const i=function(){const t=[];return{load:function(e){return t.includes(e.src)?Promise.resolve():new Promise(n=>{const i=document.createElement("script");Object.keys(e).forEach(t=>{i.setAttribute(t,e[t])}),document.getElementsByTagName("body")[0].appendChild(i),t.push(e.src),i.onload=n})}}}();function o(t){t.parentElement.removeChild(t)}function s(t,e){const n=document.querySelector(t);n&&n.classList.remove(e)}function r(t,e,n=null){for(;e&&e!==n;){if(e.hasAttribute(t))return{elementRef:e,attrValue:e.getAttribute(t)};e=e.parentElement}}function a(t,e){return!!e&&!e.contains(t)}function c(t){const e=function(t){const e=t%60;return e<10?`0${e}`:e}(t),n=function(t){const e=Math.floor(t/60%60);return t>=3600&&e<10?`0${e}`:e}(t);return`${function(t){const e=Math.floor(t/3600);return e?`${e}:`:""}(t)}${n}:${e}`}function l(t,e){const n=new CustomEvent(t,{detail:e});window.dispatchEvent(n)}function u(t){return"object"==typeof t?URL.createObjectURL(t):t}function d(t,{id:e,title:n}){t.setAttribute("title",n),t.querySelector(".js-icon").setAttribute("href",`#${e}`)}function m(t){let e=t.length;for(;e;){const i=Math.floor(Math.random()*e);e-=1;var n=[t[i],t[e]];t[e]=n[0],t[i]=n[1]}return t}const f=Object.assign({repeat:!1,shuffle:!1,once:!1,mute:!1,volume:.4},JSON.parse(localStorage.getItem("settings"))||{});function p(t,e){f[t]=e,g(f)}function y(t){return f[t]}function v(t){delete f[t],g(f)}function g(t){localStorage.setItem("settings",JSON.stringify(t))}n(17),n(49);const b=[];function h(t){return b.some(e=>e===t)}function w(){const t=window.location.hash.slice(2).replace(/\/+$/g,"");let e=!1,n="home";l("route-change",{tabId:n=t&&!h(t)?"not-found":(e=t.startsWith("playlist/"))?t.split("playlist/")[1]:n,isPlaylistTab:e})}window.addEventListener("hashchange",w),n(0);const k={};let E="",L=null;function I(t){return k[t]}function j(t){return k[t.id]=Object.assign({sortedBy:"index",order:1,shuffled:!1,tracks:[],playbackIndex:0,playbackOrder:[]},t,{rendered:!1,initialized:!1}),k[t.id]}function $(t,e){Object.assign(k[t],e)}function x(t){return t.reduce((t,e)=>t+=e.durationInSeconds,0)}function T(t=""){E=t}function B(){return E}function A(t){return t===E}function S(){return k[E]}function M(t){return t?Object.assign({},t):null}function O(t){L=M(t)}function R(t){Object.assign(L,t)}function H(){return L}function V(t,e){const n=I(t);return M(n?n.tracks.find(t=>t.name===e):null)}function C(t){const e=S();$(e.id,{playbackIndex:e.playbackOrder.indexOf(parseInt(t,10))})}function P(t,e){const n=t.map((t,e)=>e);return e?m(n):n}function _({id:t,tracks:e},n){$(t,{shuffled:n,playbackOrder:P(e,n)}),function(){const t=H();t&&C(t.index)}()}function U(t){return t.map((t,e)=>(t.index=e,t))}function q(t){return document.getElementById(`js-sidebar-entry-${t}`)}function D(){const t=document.getElementById("js-active-playlist-icon");t&&o(t)}document.getElementById("js-sidebar-container").addEventListener("click",({currentTarget:t,target:e})=>{if(r("data-link",e,t)||a(e,t.firstElementChild))return void t.classList.add("hidden");const n=r("data-btn",e,t);n&&function(t){const e=document.getElementById("js-sidebar-form");e?o(e):Oi("sidebar",t.parentElement,"afterend",Mi)}(n.elementRef)});let z=null;function W(){window.removeEventListener("click",K,!0),o(z.element),z=null}function Y(t,e,n){e(t,n),z={id:t,element:document.getElementById(t),removeOnClick:n.removeOnClick,initiator:n.element},window.addEventListener("click",K,!0)}function X(t,e,n){if(z){const i=z.id;W(),i!==t&&Y(t,e,n)}else Y(t,e,n)}function K({target:t}){if(z.removeOnClick)return void W();const e=a(t,z.element),n=a(t,z.initiator);e&&n&&W()}function N({currentTarget:t,target:e}){const n=r("data-panel-item",e,t);if(!n)return;const i=n.attrValue,s=n.elementRef;"btn"===i?(Oi("move-to",s.parentElement,"beforeend",F),o(s)):(t.removeEventListener("click",N),function(t){const e=be(ge()),n=oi().tracks;Si(I(t),n.filter(n=>e.includes(n.index)&&!V(t,n.name)).map(e=>Object.assign({},e,{playlistId:t})),!0)}(i),W(),oe())}function F(t){const e=document.getElementById("js-move-to-list"),n=ii();Mi(t),e?e.innerHTML=J(n):t.target.insertAdjacentHTML("beforebegin",Z(n))}function J(t){return Object.keys(k).map(I).reduce((e,n)=>(n.id!==t&&(e+=`\n                <li data-panel-item="${n.id}">\n                    <button class="btn-icon move-to-list-item-btn">${n.title}</button>\n                </li>\n            `),e),"")}function Z(t){const e=J(t);return e?`<ul id="js-move-to-list" class="move-to-list">${e}</ul>`:""}function G(t,{playlistId:e}){document.getElementById("js-move-to-panel-container").insertAdjacentHTML("beforeend",`\n        <div id="${t}" class="panel move-to-panel">\n            <h3 class="panel-title move-to-panel-title">Move to</h3>\n            ${Z(e)}\n            <button class="btn-icon move-to-new-pl-btn" data-panel-item="btn">\n                <svg viewBox="0 0 24 24">\n                    <use href="#plus"></use>\n                </svg>\n                <span>Create new playlist</span>\n            </button>\n        </div>\n    `)}let Q=!1,tt=!1;function et(){return Q}async function nt(){if(Q||tt)return;const t=document.getElementById("js-google-sign-in-or-out-btn");tt=!0,t.disabled=!0;try{await i.load({src:"https://apis.google.com/js/api.js"}),await new Promise(t=>gapi.load("client:auth2",t)),await gapi.client.init({apiKey:"AIzaSyD33Rxm4dA34Mh84oSxYTUUF_jyCLLOua4",clientId:"293076144560-r5cear7rprgo094u6ibcd6nl3bbg18te.apps.googleusercontent.com",discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest"],scope:"https://www.googleapis.com/auth/youtube.force-ssl"}),gapi.auth2.getAuthInstance().isSignedIn.get()&&(t.textContent="Sign Out"),Q=!0,tt=!1,l("google-api-initialized")}catch(t){tt=!1,console.log(t)}finally{t.disabled=!1}}function it({title:t,body:e}){X("js-player-message",function(t,e=""){return(n,{element:i})=>{i.insertAdjacentHTML("beforeend",`\n            <div id="${n}" class="panel player-message">\n                <h3 class="panel-title player-message-title">${t}</h3>\n                ${e&&`<p class="player-message-body">${e}</p>`}\n            </div>\n        `)}}(t,e),{element:document.getElementById("js-player"),removeOnClick:!0})}function ot(){const t=document.getElementById("js-online-status");navigator.onLine?t.classList.remove("visible"):t.classList.add("visible")}function st(t){return new Promise(e=>{let n=URL.createObjectURL(t),i=new Audio(n);i.preload="metadata",i.addEventListener("loadedmetadata",function t(){e(Math.floor(i.duration)),i.removeEventListener("loadedmetadata",t),i=null,n=URL.revokeObjectURL(n)})})}async function rt(t,e,i=[]){const o=t[i.length],s=o.audioTrack,r=o.name,a=await async function(t){if("audio/flac"===t.type)return(0,(await n.e(1).then(n.bind(null,59))).default)(t);if("audio/ogg"===t.type)return(0,(await n.e(0).then(n.bind(null,58))).default)(t);let e={};var i=await Promise.all([new Promise(e=>{parse_audio_metadata(t,e)}),st(t)]);return(e=i[0]).duration=i[1],e}(s),l=a.artist,u=a.title,d=a.album,m=a.duration,f=a.picture;return i.push({audioTrack:s,name:r,title:l?u.trim():r,artist:l?l.trim():"",album:d?d.trim():"",thumbnail:f||"assets/images/album-art-placeholder.png",durationInSeconds:m,duration:c(m),player:"native",playlistId:e}),i.length!==t.length?await rt(t,e,i):i}function at(t,e,{initialized:n,id:i}){it({title:`${t} files`,body:e}),kt(t),n&&Hi(i)}async function ct(t,e,n,o){if(wt(t),!n.length)return void at(t,"No valid audio file found",e);const s=(r=n,a=e.tracks,r.reduce((t,e)=>{const n=(c=e.name.trim()).slice(0,c.lastIndexOf("."));return a.some(t=>t.name===n)||t.push({audioTrack:e,name:n}),t},[]));var r,a,c;if(s.length)try{await i.load({src:"libs/metadata-audio-parser.min.js"}),Si(e,await o(s,e.id))}catch(t){console.log(t),Hi(e.id)}finally{kt(t)}else at(t,`Track${n.length>1?"s":""} already exist`,e)}async function lt(t,e,n=[]){const i=t[n.length],o=await(s=i.audioTrack.link,fetch(s).then(t=>t.blob()));var s;const r=await st(o);return n.push({audioTrack:o,durationInSeconds:r,index:n.length,title:i.name,artist:"",album:"",name:i.name,duration:c(r),thumbnail:"assets/images/album-art-placeholder.png",player:"native",playlistId:e}),n.length!==t.length?await lt(t,e,n):n}n(48),window.addEventListener("sw-state-change",({detail:t})=>{"init"===t?it({title:"Content is cached for offline use."}):"update"===t&&it({title:"Update is available, please refresh."})}),window.addEventListener("online",ot),window.addEventListener("offline",ot),window.addEventListener("load",ot),document.getElementById("js-dropbox-option").addEventListener("mouseenter",function t({currentTarget:e}){i.load({src:"https://www.dropbox.com/static/api/2/dropins.js",id:"dropboxjs","data-app-key":"6ur73hspbv8o1z9"}),e.removeEventListener("mouseenter",t)}),n(28);const ut=[];function dt(t){it({title:"YouTube",body:t}),kt("youtube")}function mt(t){if(t.includes("H")||(t=`0H${t}`),!t.includes("M")){const e=t.indexOf("H")+1;t=`${t.slice(0,e)}0M${t.slice(e)}`}return t.includes("S")||(t=`${t}0`),t.match(/\d{1,}/g).reverse().reduce((t,e,n)=>t+=e*60**n,0)}function ft(t,e,n,i,o){let s=`part=${e}&${n}=${i}&maxResults=50&key=AIzaSyD33Rxm4dA34Mh84oSxYTUUF_jyCLLOua4`;const r=gapi.auth2.getAuthInstance();return o&&(s+=`&pageToken=${o}`),r.isSignedIn.get()&&(s+=`&access_token=${r.currentUser.get().getAuthResponse().access_token}`),fetch(`https://www.googleapis.com/youtube/v3/${t}?${s}`).then(t=>t.json())}function pt(t){return t.filter(t=>{const e=t.snippet.title;return"Deleted video"!==e&&"Private video"!==e})}function yt(t,e){return t.map(t=>({id:t.snippet.resourceId.videoId,durationInSeconds:t.durationInSeconds,duration:c(t.durationInSeconds),name:t.snippet.title,title:t.snippet.title,artist:"",album:"",thumbnail:t.snippet.thumbnails.medium.url,player:"youtube",playlistId:e}))}async function vt(t,e,n){const i=I(e);n||(n=i?"update":"new"),i&&Ri(e);const o=await async function t(e,n){const i=await ft("playlistItems","snippet","playlistId",e,n);i.error&&function({code:t,message:e},n){throw 403===t?dt("You need to be sign in if you want to import private playlist"):404===t&&dt("Playlist was not found"),Hi(n),new Error(e)}(i.error,e);const o=pt(i.items),s=yt(await async function(t){const e=t.map(t=>t.snippet.resourceId.videoId).join(),n=await ft("videos","contentDetails","id",e);return t.reduce((t,e)=>{const i=n.items.find(({id:t})=>t===e.snippet.resourceId.videoId);return i&&(e.durationInSeconds=mt(i.contentDetails.duration)-1,t.push(e)),t},[])}(o),e);if(i.nextPageToken){const n=await t(e,i.nextPageToken);return s.concat(n)}return s}(e),s=await async function(t){const e=(await ft("playlists","snippet,status","id",t)).items;return{title:e[0].snippet.title,status:e[0].status.privacyStatus}}(e);jt({url:t,title:s.title,id:e,tracks:o,player:"youtube",type:"grid",isPrivate:"private"===s.status},n)}function gt(t,e){if(tt)return void function(t,e){ut.some(e=>e.url===t)||ut.push({url:t,type:e})}(t,e);const n=function(t){let e="",n="";try{const i=new URL(t).searchParams;e=i.get("v"),n=i.get("list")}catch(i){const o=t.match(/v=[a-zA-Z0-9\-_]+/),s=t.match(/list=[a-zA-Z0-9\-_]+/);o&&(e=o[0].slice(2)),s&&(n=s[0].slice(5))}return{videoId:e,playlistId:n}}(t),i=n.videoId,o=n.playlistId;i?async function(t,e){const n=I("youtube");e||(e=n?"update":"new"),n&&Ri("youtube");const i=(await ft("videos","snippet,contentDetails","id",t)).items;if(n&&n.tracks.length,!i.length)return dt("Video was not found"),void Hi("youtube");var o;jt({title:"YouTube",id:"youtube",tracks:(o=i,yt(pt(o).map(t=>(t.snippet.resourceId={videoId:t.id},t.durationInSeconds=mt(t.contentDetails.duration)-1,t)),"youtube")),player:"youtube",type:"grid"},e)}(i,e):o?"WL"===o?dt("Importing Watch Later playlist is not allowed"):vt(t,o,e):dt("Invalid url")}window.addEventListener("google-api-initialized",()=>{ut.forEach(({url:t,type:e})=>{gt(t,e)}),ut.length=0});let bt="";function ht(t=""){bt=t}function wt(t){Et(t,!0)}function kt(t){Et(t,!1)}function Et(t,e){const n=document.querySelector(`[data-option=${t}]`).children;Array.from(n).forEach(t=>{t.hasAttribute("data-item")&&(t.disabled=e)})}function Lt(){ht(),function(){const t=document.getElementById("js-import-form");t&&(t.removeEventListener("submit",xt),o(t),s(".import-option-btn.active","active"))}()}function It(t,{url:e,type:n}){"youtube"===t&&gt(e,n)}async function jt(t,e="new"){const n=t.tracks.splice(0);let i=null,o=[];if("new"===e)i=j(t),o=n;else if("sync"===e)o=n,function(t){Ci({action:"remove-tracks",playlist:{_id:t._id,tracks:t.tracks}}),t.tracks.length=0,t.duration=0}(i=I(t.id));else{if("update"!==e)throw new Error("Unknown import type");o=function(t,e){return t.reduce((t,n)=>(e.some(t=>t.name===n.name)||t.push(n),t),[])}(n,(i=I(t.id)).tracks)}Si(i,await function(t){return t.length?new Promise(e=>{let n=0;t.forEach(i=>{const o=new Image;o.onload=function(){(n+=1)===t.length&&e(t)},o.onerror=function(){i.thumbnail="assets/images/album-art-placeholder.png",(n+=1)===t.length&&e(t)},o.src=i.thumbnail})}):Promise.resolve(t)}(o)),Lt(),kt(t.player)}function $t({target:t}){(function(t){const e=function(t){const e=new Audio;return t.filter(t=>e.canPlayType(t.type))}(t),n="local-files";let i=I(n);i&&i.initialized?Ri(n):i=j({id:n,title:"Local files",type:"list",player:"native"}),ct("local",i,e,rt)})([...t.files]),t.value="",t.removeEventListener("change",$t),o(t)}function xt(t){const e=t.target.elements.url.value.trim();if(e){const n=t.target.getAttribute("data-for");Lt(),wt(n),It(n,{url:e})}t.preventDefault()}function Tt(t,{element:e}){e.insertAdjacentHTML("afterend",`\n        <div id="${t}" class="panel info-panel">\n            <h3 class="panel-title">Accepted formats</h3>\n            <ul>\n                <li class="info-panel-content-item">youtube.com/playlist?list={playlistId}</li>\n                <li class="info-panel-content-item">youtube.com/watch?v={videoId}</li>\n            </ul>\n        </div>\n    `)}function Bt(t){const e=document.querySelector(`[data-entry-id="${t}"]`);return e?e.querySelector("[data-action='sync']"):null}function At(t){const e=Bt(t);e&&(e.disabled=!1)}function St(t){const e=Bt(t);e&&(e.disabled=!0)}function Mt({action:t,title:e,iconId:n}){return`\n        <button class="btn-icon pl-entry-btn" data-action="${t}" title="${e}">\n            <svg viewBox="0 0 24 24">\n                <use href="#${n}">\n            </svg>\n        </button>\n    `}function Ot(t){let e=Math.floor(t/3600),n=Math.ceil(t/60%60);return 60===n&&(n=0,e+=1),`${e} hr ${n} min`}function Rt(t){return function(t){const e="assets/images/album-art-placeholder.png",n=m(t.map(t=>t.thumbnail)),i=[];for(const t of n){if(4===i.length)break;t!==e&&i.push(t)}for(;i.length<4;)i.push(e);return i}(t).map(t=>`\n        <div class="pl-entry-thumb-image-container">\n            <img src="${u(t)}" class="pl-entry-thumb-image" alt="">\n        </div>\n    `).join("")}function Ht(t,e){const n=x(e);t.querySelector(".track-count").textContent=`${e.length} tracks`,t.querySelector(".playlist-duration").textContent=Ot(n)}function Vt(t,e){t.querySelector(".pl-entry-thumbnail").innerHTML=Rt(e)}function Ct({id:t,tracks:e}){const n=document.getElementById("js-pl-entries").children;for(const i of n)if(t===i.getAttribute("data-entry-id")){Ht(i,e),Vt(i,e);break}}function Pt(t,{element:e,pl:n}){e.insertAdjacentHTML("afterend",`\n        <div id="${t}" class="panel pl-entry-panel">\n            <h3 class="panel-title">Playlist settings</h3>\n            <label class="pl-entry-setting">\n                <input type="checkbox" class="checkbox-input" ${n.syncOnInit?"checked":""}>\n                <div class="checkbox"></div>\n                <span>Synchronize playlist on startup</span>\n            </label>\n        </div>\n    `),document.getElementById(t).addEventListener("change",Wt)}async function _t(t){t.length&&(et()||(t.forEach(t=>{St(t.id)}),await nt(),t.forEach(t=>{At(t.id)})),Lt(),wt("youtube"),t.forEach(({player:t,url:e})=>{It(t,{url:e,type:"sync"})}))}function Ut({currentTarget:t}){const e=r("data-entry-id",t).attrValue,n=I(e),i=n._id,o=n.title,s=t.value;t.removeEventListener("blur",Ut),t.removeEventListener("keyup",qt),s?s!==o&&(function(t,e){q(t).querySelector(".sidebar-link").textContent=e}(e,s),$(e,{title:s}),Ci({action:"change-title",playlist:{_id:i,title:s}})):t.value=o}function qt({currentTarget:t,which:e}){13===e&&t.blur()}function Dt({target:t}){const e=r("data-entry-id",t),n=r("data-action",t);if(!e||!n||n.elementRef.disabled)return;const i=n.attrValue,s=n.elementRef,a=I(e.attrValue);"remove"===i?(function({id:t,rendered:e,_id:n}){A(t)&&Zn(H()),e&&function(t){li(t),o(si(t))}(t),function(t){delete k[t]}(t),function(t){o(q(t))}(t),Ci({action:"remove",playlist:{_id:n}})}(a),function(t){const e=t.parentElement;var n;o(t),e.children.length||((n=e).removeEventListener("click",Dt),n.removeEventListener("focus",zt,!0),o(n.parentElement))}(e.elementRef)):"sync"===i?_t([a]):"settings"===i?X("js-pl-entry-panel",Pt,{element:s,pl:a}):"edit"===i&&s.querySelector(".input").focus()}function zt({target:t}){const e=r("data-action",t);e&&"edit"===e.attrValue&&(t.addEventListener("blur",Ut),t.addEventListener("keyup",qt))}function Wt({target:t}){const e=I(r("data-entry-id",t).attrValue);e.syncOnInit=t.checked,Ci({action:"change-sync",playlist:{_id:e._id,syncOnInit:e.syncOnInit}})}document.getElementById("js-import-options").addEventListener("click",({currenTarget:t,target:e})=>{const n=r("data-item",e,t);if(!n||n.elementRef.disabled)return;const i=r("data-option",e,t).attrValue;"local"===i?function(t){const e=document.getElementById("js-file-picker")||function(){const t=document.createElement("input");return t.setAttribute("type","file"),t.setAttribute("id","js-file-picker"),t.classList.add("file-picker"),t.addEventListener("change",$t),document.body.appendChild(t),t}();"file"===t?(e.removeAttribute("webkitdirectory"),e.removeAttribute("directory"),e.removeAttribute("allowdirs"),e.setAttribute("multiple","")):"folder"===t&&(e.removeAttribute("multiple"),e.setAttribute("webkitdirectory",""),e.setAttribute("directory",""),e.setAttribute("allowdirs","")),e.click()}(n.attrValue):"dropbox"===i?Dropbox.choose({success(t){const e="dropbox";ct(e,I(e)||j({id:e,title:"Dropbox",type:"grid",player:"native"}),t,lt)},linkType:"direct",multiselect:!0,extensions:["audio"]}):"youtube"===i&&function({attrValue:t,elementRef:e}){if("form-toggle"===t){const t="youtube";bt!==t?(e.classList.add("active"),function(t,e){const n="js-import-form",i=`\n        <form id=${n} class="import-form" data-for="${e}">\n            <input type="text" name="url" class="input" placeholder="URL" required>\n            <button class="btn">Import</button>\n        </form>\n    `;t.insertAdjacentHTML("afterend",i);const o=document.getElementById(n);o.elements.url.focus(),o.addEventListener("submit",xt)}(e,t),ht(t),et()||nt()):Lt()}else"google-sign-in-or-out"===t?async function(t){if(!t.disabled){t.disabled=!0;try{const e=gapi.auth2.getAuthInstance();e.isSignedIn.get()?(await e.signOut(),t.textContent="Sign In"):(await e.signIn(),t.textContent="Sign Out")}catch(t){console.log(t)}t.disabled=!1}}(e):"youtube-info"===t&&X(`js-${t}-panel`,Tt,{element:e})}(n)});const Yt={},Xt={};let Kt=null,Nt=null,Ft=null,Jt={},Zt=[],Gt=0,Qt=!1,te=!1;function ee({id:t,tracks:e}){Kt&&ne(),e.length&&(Kt=si(t)).addEventListener("mousedown",ye)}function ne(){Kt.removeEventListener("mousedown",ye),Kt=null}function ie(){ge().forEach(t=>{t.classList.remove("selected")})}function oe(){ie(),re()}function se(){te||(te=!0,function(){const t="js-move-to-panel-container";document.getElementById("js-playlist-type-btns").insertAdjacentHTML("beforebegin",`\n        <div id="${t}" class="playlist-tab-header-item" data-move-to>\n            <button class="btn-icon" data-item="move-to" title="Move to">\n                <svg viewBox="0 0 24 24">\n                    <path d="M2,16H10V14H2M18,14V10H16V14H12V16H16V20H18V16H22V14M14,6H2V8H14M14,10H2V12H14V10Z" />\n                </svg>\n            </button>\n        </div>\n    `),document.getElementById(t).addEventListener("click",N)}(),setTimeout(()=>{window.addEventListener("click",pe,!0)},0),window.addEventListener("keypress",ve))}function re(){te&&(te=!1,function(){const t=document.getElementById("js-move-to-panel-container");t.removeEventListener("click",N),o(t)}(),window.removeEventListener("click",pe,!0),window.removeEventListener("keypress",ve))}function ae(t,e){return t>e?e:t<0?0:t}function ce(){clearInterval(Gt),Gt=0}function le(t){Qt=!0,requestAnimationFrame(()=>{Ft&&function(t,e,n,i){let o=t.x-e.x,s=t.y-e.y;if(o<0){const t=e.x+o;o*=-1,n.left=t,i.left=`${t}px`}else n.left!==e.x&&(n.left=e.x,i.left=`${e.x}px`);if(s<0){const t=e.y+s;s*=-1,n.top=t,i.top=`${t}px`}else n.top!==e.y&&(n.top=e.y,i.top=`${e.y}px`);n.right=n.left+o,n.bottom=n.top+s,i.width=`${o}px`,i.height=`${s}px`}(Xt,Yt,Jt,Ft.style),function(t,e,n){for(let i=0;i<t.length;i++){const o=t[i],s=o.ref.classList;e.right>o.left&&e.left<o.right&&e.bottom>o.top&&e.top<o.bottom?(n&&!o.selected&&s.contains("selected")&&(s.remove("selected"),o.removed=!0),o.removed||(s.add("selected"),o.selected=!0)):o.selected?(s.remove("selected"),o.selected=!1):o.removed&&(s.add("selected"),o.removed=!1)}}(Zt,Jt,t),Qt=!1})}function ue(t,e,{scrollHeight:n,height:i}){e.scrollTop+=36,Xt.y=e.scrollTop+i,Xt.y>=n&&(Xt.y=n,ce()),Qt||le(t)}function de(t,e){e.scrollTop-=36,Xt.y=e.scrollTop,Xt.y<=0&&(Xt.y=0,ce()),Qt||le(t)}function me(t){const e=Nt,n=e.top,i=e.left,o=e.width,s=e.height,r=e.scrollHeight,a=t.clientY-n;if(Xt.x=ae(t.clientX-i,o),Xt.y=ae(Kt.scrollTop+a,r),t.preventDefault(),!Ft&&function(t,e){return t.x>e.x+2||t.x<e.x-2||t.y>e.y+2||t.y<e.y-2}(Xt,Yt))return Zt=function(){const t=ui(ii());return Array.from(t).map(t=>{const e=t.offsetTop,n=t.offsetLeft;return{ref:t,top:e,left:n,right:n+t.offsetWidth,bottom:e+t.offsetHeight}})}(),Ft=function(t,{x:e,y:n}){return Jt.top=n,Jt.left=e,t.insertAdjacentHTML("afterbegin",`\n        <div class="selection-area" style="top: ${n}px; left: ${e}px"></div>\n    `),t.firstElementChild}(Kt,Yt),document.activeElement.blur(),t.ctrlKey||ie(),void re();if(Qt||le(t.ctrlKey),Gt&&a>0&&a<s)ce();else if(!Gt){let e=null;if(a>s&&Xt.y<r)e=ue;else{if(!(a<0&&Xt.y>0))return;e=de}Gt=setInterval(e,40,t.ctrlKey,Kt,Nt)}}function fe({target:t,ctrlKey:e}){if(Gt&&ce(),Ft){const t=ge();o(Ft),Ft=null,Jt={},Zt.length=0,t.length?se():re()}else{const n=r("data-index",t,Kt);n?function(t,e){if(e||ie(),t.classList.toggle("selected"),t.classList.contains("selected"))se();else{const e=ge();t.blur(),e.length||re()}}(n.elementRef,e):e||oe()}window.removeEventListener("mousemove",me),window.removeEventListener("mouseup",fe)}function pe({target:t}){!r("data-move-to",t)&&a(t,Kt)&&oe()}function ye({currentTarget:t,target:e,which:n,clientX:i,clientY:o}){var s;1===n&&(r("data-btn",e)?oe():(Nt={top:(s=t).offsetTop,left:s.offsetLeft,width:s.clientWidth,height:s.offsetHeight,scrollHeight:s.scrollHeight},Yt.x=i-Nt.left,Yt.y=t.scrollTop+o-Nt.top,Yt.x<Nt.width&&(window.addEventListener("mousemove",me),window.addEventListener("mouseup",fe))))}function ve({key:t,keyCode:e}){"Delete"!==t&&127!==e||(function(){const t=ge(),e=oi(),n=be(t),i=function(t,e){const n=[],i=[];return t.forEach(t=>{e.includes(t.index)?i.push(t):n.push(t)}),{tracksToRemove:i,tracksToKeep:U(n)}}(e.tracks,n),s=i.tracksToKeep,r=i.tracksToRemove;(function(t){t.forEach(o)})(t),function(t,e,n){const i=Math.min(...n),o=Array.from(ui(t)).slice(i);"list"===e?function(t,e){o.forEach((t,n)=>{t.setAttribute("data-index",e+n),t.querySelector(".list-item-index").textContent=e+n+1})}(0,i):function(t,e){o.forEach((t,n)=>{t.setAttribute("data-index",e+n)})}(0,i)}(e.id,e.type,n),$(e.id,{playbackOrder:P(s,y("shuffle")),tracks:s}),Ci({action:"remove-tracks",playlist:{_id:e._id,tracks:r}}),function(t,e){const n=H();if(n&&A(t)){const i=V(t,n.name);let o=n.index;e.includes(o)||!i?R({index:-1}):R({index:o=i.index}),C(o)}}(e.id,n),Ct(e),s.length||(ne(),Li(e))}(),re())}function ge(){return Array.from(Kt.querySelectorAll(".track.selected"))}function be(t){return t.map(t=>parseInt(t.getAttribute("data-index"),10))}const he=document.getElementById("js-filter-input"),we=he.parentElement;let ke=0,Ee="";function Le(t,e,n){t.forEach(t=>{const i=e[t.index],o=new RegExp(n,"gi"),s=`\n            ${t.title}\n            ${t.artist}\n            ${t.album}\n        `;o.test(s)?i.classList.remove("hidden"):i.classList.add("hidden")})}function Ie(t,e=""){const n=I(t).tracks;if(!n.length)return;const i=ui(t);Ee=e?t:"",Le(n,i,e),function(t){const e=document.getElementById("js-clear-input-btn");t?e.classList.add("visible"):e.classList.remove("visible")}(e)}function je(){Ee&&(he.value="",Ie(Ee))}function $e(){he.classList.remove("active"),he.removeEventListener("keyup",Te),window.removeEventListener("click",xe)}function xe({target:t}){a(t,we)&&$e()}function Te({target:t}){const e=ii(),n=t.value.trim().toLowerCase();clearTimeout(ke),ke=setTimeout(Ie,400,e,n)}function Be(t){document.getElementById("js-order-toggle").querySelector(".js-icon").setAttribute("href",`#${1===t?"down":"up"}-arrow`)}function Ae(t,e){return"index"===t?e.primaryIndex:"duration"===t?e.durationInSeconds:e[t].toLowerCase()}function Se(t,e,n){t.sort((t,i)=>{const o=Ae(e,t),s=Ae(e,i);return o<s?-n:o>s?n:0})}function Me(t,e){const n=document.getElementById("js-filter-input").value,i=t.sortedBy===e&&1===t.order?-1:1;if(Se(t.tracks,e,i),$(t.id,{order:i,sortedBy:e,tracks:U(t.tracks)}),Ci({action:"change-sorting",playlist:{order:i,_id:t._id,sortedBy:e}}),Li(t),Ai(t),n){const e=ui(t.id);Le(t.tracks,e,n)}}function Oe({sortedBy:t,order:e}){var n;n=t,document.getElementById("js-sort-toggle").textContent=n,Be(e)}function Re(t,{sortedBy:e}){document.getElementById("js-sort-panel-container").insertAdjacentHTML("beforeend",function(t,e){return`<ul id="${t}" class="panel sort-panel">${function(t){return["index","name","title","artist","album","duration"].reduce((e,n)=>{return`\n            ${e}\n            <li>\n                <button class="btn-icon sort-option-btn${n===t?" active":""}" data-sort="${n}">\n                    ${n}\n                </button>\n            </li>\n        `},"")}(e)}</ul>`}(t,e)),document.getElementById(t).addEventListener("click",He)}function He({currentTarget:t,target:e}){const n=e.getAttribute("data-sort"),i=oi();t.removeEventListener("click",He),W(),n!==i.sortedBy&&(Oe({sortedBy:n,order:1}),Me(i,n))}he.addEventListener("focus",({currentTarget:t})=>{t.classList.add("active"),t.addEventListener("keyup",Te),window.addEventListener("click",xe)}),we.addEventListener("click",({target:t})=>{const e=r("data-filter-item",t);if(!e)return;const n=e.attrValue;"icon"===n?he.focus():"button"===n&&(je(),$e())});const Ve=document.getElementById("js-volume-slider"),Ce=document.getElementById("js-track-slider"),Pe=document.getElementById("js-controls");let _e=!1;const Ue=function(){let t=0;function e(){clearTimeout(t)}function n(e,i,o){const s=performance.now()-i-o;_e||Ze(e,e.currentTime),qn.updateTrack({currentTime:e.currentTime}),e.currentTime<=e.durationInSeconds?(e.currentTime+=1,o+=1e3,t=setTimeout(n,1e3-s,e,i,o)):l("track-end")}return{stop:e,start:function(t){const i=performance.now();e(),n(t,i,0)}}}();function qe(t){const e=mi(t);e&&e.classList.add("show-spinner"),document.getElementById("js-play-btn").classList.add("show-spinner")}function De(t){const e=mi(t);e&&e.classList.remove("show-spinner"),document.getElementById("js-play-btn").classList.remove("show-spinner")}function ze(t){return t?{id:"play",title:"Play"}:{id:"pause",title:"Pause"}}function We(t,e){d(t,ze(e))}function Ye(t,e){const n={on:{id:"volume-off",title:"Unmute"},off:{id:"volume",title:"Mute"}};d(t,e?n.on:n.off)}function Xe(t,e){const n=document.getElementById(`js-${t}-slider`).getBoundingClientRect();let i=(e-n.left)/n.width*100;return i<0?i=0:i>100&&(i=100),i}function Ke(){Ue.stop(),Ze()}function Ne(t){p("volume",t),Ge(t),function(t){const e=H()||{};"native"===e.player?Cn(t):"youtube"===e.player&&En(t)}(t)}function Fe(t){const e=document.getElementById("js-volume-slider-label");e.textContent=`${Math.floor(t)}%`,e.style.left=`${t}%`}function Je(t,e){document.getElementById(`js-${t}-slider-thumb`).style.left=`${100*e}%`,document.getElementById(`js-${t}-slider-elapsed`).style.transform=`scaleX(${e})`}function Ze(t,e=0){const n=c(e),i=t?t.durationInSeconds:1,o=t?t.duration:n;_e||(document.getElementById("js-track-current").textContent=n),Je("track",e/i),Ce.setAttribute("aria-valuenow",e),Ce.setAttribute("aria-valuetext",`${n} of ${o}`)}function Ge(t){const e=Math.floor(100*t);Je("volume",t),Ve.setAttribute("aria-valuenow",e),Ve.setAttribute("aria-valuetext",`${e}% volume`)}function Qe(t="0:00",e=0){document.getElementById("js-track-duration").textContent=t,Ce.setAttribute("aria-valuemax",e)}function tn(t,e){const n=Xe("track",t);return{percent:n,currentTime:Math.floor(e*n/100)}}function en(t,e){const n=document.getElementById("js-track-slider-label");n.style.left=`${t}%`,n.textContent=c(e)}function nn({pageX:t}){const e=H(),n=tn(t,e.durationInSeconds),i=n.percent,o=n.currentTime;Ze(e,o),en(i,o)}function on({pageX:t}){const e=H();if(!e)return;const n=tn(t,e.durationInSeconds);en(n.percent,n.currentTime)}function sn({pageX:t}){const e=H();if(_e=!1,e){const n=tn(t,e.durationInSeconds).currentTime;Ze(e,n),Qn(e.player,n),qn.updateTrack({currentTime:n})}window.removeEventListener("mousemove",nn),window.removeEventListener("mouseup",sn),Ce.addEventListener("mousemove",on)}function rn({pageX:t}){const e=Xe("volume",t),n=e/100;n!==y("volume")&&(Fe(e),n?(un(),Ne(n)):ln({attrValue:"mute",elementRef:document.getElementById("js-volume-btn")}))}function an({pageX:t}){Fe(Xe("volume",t))}function cn(){window.removeEventListener("mousemove",rn),window.removeEventListener("mouseup",cn),Ve.addEventListener("mousemove",an)}function ln({attrValue:t,elementRef:e}){const n=!y(t);e.classList.toggle("active"),e.setAttribute("aria-checked",n),p(t,n),"shuffle"===t?function(t){const e=S();e&&_(e,t)}(n):"mute"===t&&(function(t){const e=t?0:y("volumeBeforeMute");t?p("volumeBeforeMute",y("volume")):v("volumeBeforeMute"),Ne(e)}(n),Ye(e,n))}function un(){const t=y("mute");if(t){const e=document.getElementById("js-volume-btn");v("volumeBeforeMute"),p("mute",!t),Ye(e,!t),e.classList.remove("active")}}Ce.addEventListener("mousedown",t=>{1===t.which&&H()&&(_e=!0,nn(t),Ce.removeEventListener("mousemove",on),window.addEventListener("mousemove",nn),window.addEventListener("mouseup",sn))}),Ce.addEventListener("mousemove",on),Ce.addEventListener("keydown",({which:t})=>{const e=H();if(!e||t<37||t>40)return;const n=e.durationInSeconds;let i=qn.getTrack().currentTime;38===t||39===t?(i+=5)>n&&(i=n):37!==t&&40!==t||(i-=5)<0&&(i=0),Ze(e,i),Qn(e.player,i),qn.updateTrack({currentTime:i})}),Ve.addEventListener("mousedown",t=>{1===t.which&&(rn(t),Ve.removeEventListener("mousemove",an),window.addEventListener("mousemove",rn),window.addEventListener("mouseup",cn))}),Ve.addEventListener("mousemove",an),Ve.addEventListener("keydown",({which:t})=>{let e=y("volume");if(38===t||39===t)(e+=.05)>1&&(e=1),un();else if(e&&(37===t||40===t)&&(e-=.05)<=0)return e=0,void ln({attrValue:"mute",elementRef:document.getElementById("js-volume-btn")});Ne(e)}),document.getElementById("js-main-controls").addEventListener("click",({target:t})=>{const e=r("data-item",t);e&&function(t){switch(e.attrValue){case"previous":Kn("direction",-1,B());break;case"play":!function(){const t=H();t?Yn(t):Kn("direction",0,ii())}();break;case"next":Nn()}}()}),Pe.addEventListener("click",({target:t})=>{const e=r("data-item",t);e&&ln(e)}),Pe.addEventListener("keyup",({which:t,target:e})=>{const n=r("data-item",e);!n||32!==t&&13!==t||ln(n)}),document.getElementById("js-control-toggle-btn").addEventListener("click",()=>{Pe.classList.toggle("visible")}),Ge(y("volume")),Array.from(document.querySelectorAll(".control-btn")).forEach(t=>{const e=t.getAttribute("data-item"),n=y(e);n&&(t.classList.add("active"),t.setAttribute("aria-checked",!0),"mute"===e&&Ye(t,n))});const dn=1,mn=2,fn=3,pn=-1;let yn=!1,vn=null,gn=null;function bn({data:t}){const e=H();if(!e||"youtube"!==e.player)return;const n=document.getElementById("js-yt-player"),i=Dn()?mn:dn;if(document.activeElement===n&&(t===dn&&i===mn||t===mn&&i===dn))return n.blur(),i===mn&&l("track-start",vn.getCurrentTime()),void zn(e);if(t===dn){if(i===mn)return void vn.pauseVideo();l("track-start",vn.getCurrentTime())}else t===mn&&i===dn?vn.playVideo():t===fn?(Ue.stop(),qe(e)):De(e)}function hn(){yn=!0,kn(...gn),gn=null}function wn(t){if(console.log(t),t.data>=100){const t=H();Zn(t),it({title:`Cannot play ${t.name}`,body:"It is either removed or marked as private"})}}function kn(t,e,n){if(yn)return En(e),void vn.loadVideoById(t.id,n);gn=[t,e,n],i.load({src:"https://www.youtube.com/iframe_api"})}function En(t){vn.setVolume(100*t)}window.onYouTubeIframeAPIReady=function(){vn=new YT.Player("js-yt-player",{playerVars:{autoplay:0,disablekb:1,controls:0,fs:0,showinfo:0,rel:0,iv_load_policy:3},events:{onReady:hn,onStateChange:bn,onError:wn}})};const Ln=document.getElementById("js-now-playing"),In=document.getElementById("js-media-container");let jn,$n,xn=null,Tn=null,Bn=0,An=0;function Sn(){clearTimeout(An),cancelAnimationFrame(Bn),Tn.style.textIndent="0",An=0,Tn=null}function Mn(t,e,n,i=0){i=Math.abs(i)<e+10?i-1:n,t.style.textIndent=`${i}px`,Bn=requestAnimationFrame(()=>{Mn(t,e,n,i)})}function On({currentTarget:t}){t.removeEventListener("mouseleave",On),Tn&&Sn()}function Rn(){const t=document.getElementById("js-track-name");t&&o(t)}function Hn(t="./assets/images/album-art-placeholder.png"){document.getElementById("js-artwork").src=t}function Vn(t){xn&&URL.revokeObjectURL(xn),function(t,e){document.title=t.artist&&t.title?`${t.artist} - ${t.title}`:t.name,Hn(),Rn(),function(t,e){Hn(e),Ln.classList.remove("inactive"),Ln.insertAdjacentHTML("beforeend",ki(t,"js-track-name"))}(t,e)}(t,xn=u(t.thumbnail)),function(t,e){const n=document.getElementById("js-yt-player");if("youtube"===t.player){const e=document.getElementById("js-yt-player-watch");n.classList.remove("hidden"),e.setAttribute("href",`https://www.youtube.com/watch?v=${t.id}`)}else{const t=document.getElementById("js-media-image");n.classList.add("hidden"),t.src=e}}(t,xn)}function Cn(t){$n.volume=t}function Pn(t){$n.currentTime=t}Ln.addEventListener("mousemove",function({currentTarget:t,target:e}){if(Tn&&e!==Tn&&e!==t)Sn();else if(An)return;const n=e.scrollWidth,i=e.offsetWidth;n>i&&(Tn=e,An=setTimeout(Mn,400,e,n,i),e.addEventListener("mouseleave",On))}),In.addEventListener("click",function({currentTarget:t,target:e}){const n=r("data-item",e);if(!n)return;const i=n.attrValue,o=n.elementRef,s=H();"image"===i?Yn(s):"yt-watch"===i?function(t,e){const n=Dn(),i=qn.getTrack().currentTime;n||(vn.pauseVideo(),zn(e,!n)),t.setAttribute("href",`https://www.youtube.com/watch?v=${e.id}&time_continue=${i}`)}(o,s):"close"===i&&t.classList.remove("visible")}),document.getElementById("js-expand-media-btn").addEventListener("click",function(){In.classList.toggle("visible")});let _n=!0,Un=!1;const qn=function(){function t(){return JSON.parse(localStorage.getItem("track"))||{}}function e(t){localStorage.setItem("track",JSON.stringify(t))}function n(){localStorage.removeItem("track")}return{getTrack:t,removeTrack:n,saveTrack:e,updateTrack:function(n){e(Object.assign(t(),n))},initTrack:function(){const e=t();if(!e)return;const i=V(e.playlistId,e.name);i?(Xn(i,e.currentTime),Ze(i,e.currentTime),_n=!0):n()}}}();function Dn(){return _n}function zn(t,e){(_n="boolean"==typeof e?e:!_n)&&(D(),Ue.stop()),Wn(t,_n)}function Wn(t,e){We(document.getElementById("js-play-btn"),e),ji(t,e)}function Yn(t){"native"===t.player?_n?$n.play():$n.pause():"youtube"===t.player&&function(t){if(!yn)return;const e=vn.getPlayerState();e!==fn&&e!==pn&&(t?vn.playVideo():vn.pauseVideo())}(_n),zn(t)}function Xn(t,e){const n=y("volume");T(t.playlistId),C(t.index),O(t),function(t){const e=I(t.playlistId);Vn(t),Qe(t.duration,t.durationInSeconds),Ce.classList.add("visible"),e.rendered&&-1!==t.index&&Ii(e.id,t.index,{scrollToTrack:Un}),Un=!1,_n=!1}(t),void 0===e&&(qe(t),Wn(t,_n)),"native"===t.player?function(t,e,n){jn=URL.createObjectURL(t),($n=new Audio(jn)).onplaying=function(){l("track-start",$n.currentTime)},Cn(e),"number"!=typeof n?$n.play():Pn(n)}(t.audioTrack,n,e):"youtube"===t.player&&kn(t,n,e)}function Kn(t,e,n){const i=I(n),o=y("shuffle"),s=H();let r=null,a=!1;if(i){if(s&&(Ke(),ji(s,!0),Jn(s)),i.shuffled!==o&&(a=!0,_(i,o)),"index"===t)!a&&i.shuffled&&_(i,i.shuffled),r=M(i.tracks[e]);else if("direction"===t){if(!(r=function(t,e){const n=function({playbackIndex:t,playbackOrder:e},n){return t+=n,!n||t>=e.length?t=0:-1===t&&(t=e.length-1),e[t]}(t,e);return M(t.tracks[n])}(i,e)))return void Gn(s);Un=!0}Xn(r)}}function Nn(){Kn("direction",1,B())}function Fn({currentTarget:t,detail:e,target:n}){const i=t.id.split("js-tab-")[1],o=r("data-btn",n,t),s=r("data-index",n,t);if(2===e&&s&&!o)Kn("index",s.attrValue,i);else if(o){const t=parseInt(s.attrValue,10),e=H();e&&e.playlistId===i&&t===e.index?Yn(e):Kn("index",t,i)}}function Jn(t){"native"===t.player?(jn&&(URL.revokeObjectURL(jn),jn=null),$n.pause(),$n.currentTime=0,$n=null):"youtube"===t.player&&function(t){yn&&(De(t),vn.stopVideo())}(t)}function Zn(t){t&&Jn(t),Gn(t)}function Gn(t){_n=!0,qn.removeTrack(),Qe(),Ce.classList.remove("visible"),document.title="Veery",Hn(),Rn(),Ln.classList.add("inactive"),In.classList.remove("visible"),xn&&(URL.revokeObjectURL(xn),xn=null),O(),T(),D(),s(".track.playing","playing"),t&&(Ke(),De(t),Wn(t,_n))}function Qn(t,e){Ue.stop(),"native"===t?Pn(e):"youtube"===t&&function(t){vn.seekTo(t,!0)}(e)}window.addEventListener("track-start",({detail:t})=>{const e=H();!function(t){const e=q(t);D(),e.insertAdjacentHTML("beforeend",'\n        <svg viewBox="0 0 24 24" id="js-active-playlist-icon" class="active-playlist-icon">\n            <use href="#volume"></use>\n        </svg>\n    ')}(e.playlistId),qn.saveTrack({name:e.name,playlistId:e.playlistId}),Ue.start({currentTime:Math.floor(t),duration:e.duration,durationInSeconds:e.durationInSeconds}),De(e)}),window.addEventListener("track-end",()=>{const t=H();y("once")?Zn(t):(qn.removeTrack(),y("repeat")?Xn(t):Nn())});const ti=document.getElementById("js-tab-header"),ei=matchMedia("(max-width: 540px)");let ni="";function ii(){return ni}function oi(){return I(ni)}function si(t){return document.getElementById(`js-tab-${t}`)}ti.addEventListener("click",({currentTarget:t,target:e})=>{const n=r("data-item",e,t);if(!n)return;const i=oi(),o=n.attrValue;"move-to"===o?X("js-move-to-panel",G,{playlistId:i.id,element:n.elementRef}):"list"!==o&&"grid"!==o||o===i.type?"sorting"===o?X("js-sort-panel",Re,{sortedBy:i.sortedBy,element:n.elementRef}):"order"===o&&i.sortedBy?(Me(i=i,i.sortedBy),Be(i.order)):"sidebar"===o&&document.getElementById("js-sidebar-container").classList.remove("hidden"):xi(o,i)}),window.addEventListener("route-change",({detail:{isPlaylistTab:t,tabId:e}})=>{const n=ni,i=document.getElementById(`js-tab-${n}`);s(".sidebar-entry.active","active"),s(".tab.active","active"),function(t=""){ni=t}(t?e:""),i&&i.removeEventListener("click",Fn),t?(function(t){const e=I(t);e.rendered?Ei(t):function(t){const e=function(t){const e=wi(t);return`<div id="js-tab-${t.id}" class="tab">${e}</div>`}(t);document.getElementById("js-tabs").insertAdjacentHTML("beforeend",e),t.rendered=!0,t.tracks.length&&(Ei(t.id),ci(t.id))}(e),"list"===e.type&&ei.matches?xi("grid",e):$i(e.type),Oe(e),ee(e),je(),e.tracks.length&&si(t).addEventListener("click",Fn)}(e),ti.classList.add("playlist-tab-active")):ti.classList.remove("playlist-tab-active"),si(e).classList.add("active"),"not-found"!==e&&q(e).classList.add("active")}),ei.onchange=function({matches:t}){const e=oi();t&&e&&"list"===e.type&&xi("grid",e)};const ri={};function ai(t){t.forEach(({isIntersecting:t,target:e})=>{t?function(t){const e=oi(),n=e.tracks,i=e.type,o=n[t.getAttribute("data-index")],s=H(),r=Dn(),a=s&&s.name===o.name?ze(r):ze(!0);t.innerHTML="list"===i?yi(o,a):bi(o,a)}(e):e.innerHTML=""})}function ci(t){if(!IntersectionObserver||ri[t])return;ri[t]=new IntersectionObserver(ai,{root:si(t)});const e=ui(t);Array.from(e).forEach(e=>{ri[t].observe(e)})}function li(t){ri[t]&&(ri[t].disconnect(),delete ri[t])}function ui(t){return document.getElementById(`js-${t}`).children}function di(t,e){return ui(t)[e]}function mi(t){const e=I(t.playlistId);if(-1!==t.index&&e.rendered)return di(t.playlistId,t.index).querySelector(".btn-icon")}function fi(t){return pi(t,yi(t,{id:"play",title:"Play"}))}function pi({index:t},e=""){return`<li class="list-item track" data-index="${t}" tabindex="0">${e}</li>`}function yi(t,{title:e,id:n}){return`\n        <span class="list-item-first-col">\n            <span class="list-item-index">${t.index+1}</span>\n            <button class="btn-icon track-play-pause-btn" data-btn="play" title="${e}">\n                <svg viewBox="0 0 24 24">\n                    <use class="js-icon" href="#${n}"></use>\n                </svg>\n            </button>\n        </span>\n        <span class="list-item-col">${t.title}</span>\n        <span class="list-item-col">${t.artist}</span>\n        <span class="list-item-col">${t.album}</span>\n        <span class="list-item-last-col">${t.duration}</span>\n    `}function vi(t){return gi(t,bi(t,{id:"play",title:"Play"}))}function gi({index:t},e=""){return`<li class="grid-item track" data-index="${t}" tabindex="0">${e}</li>`}function bi(t,{title:e,id:n}){return`\n        <div class="artwork-container grid-item-first-col" tabindex="-1">\n            <button class="btn-icon track-play-pause-btn artwork-container-btn" data-btn="play" title="${e}">\n                <svg viewBox="0 0 24 24">\n                    <use class="js-icon" href="#${n}"></use>\n                </svg>\n            </button>\n            <img src="${u(t.thumbnail)}" class="artwork" alt="">\n        </div>\n        ${ki(t)}\n        <div class="grid-item-duration">${t.duration}</div>\n    `}function hi(t,e){return t.map(e).join("")}function wi(t){return t.tracks.length?function({id:t,type:e,tracks:n}){let i=fi,o=vi;return"IntersectionObserver"in window&&(i=pi,o=gi),"list"===e?function(t,e){return`\n        <ul class="list-view-header">\n            <li class="list-item-first-col">#</li>\n            <li class="list-item-col">Title</li>\n            <li class="list-item-col">Artist</li>\n            <li class="list-item-col">Album</li>\n            <li class="list-item-last-col">Duration</li>\n        </ul>\n        <ul id="js-${t}" class="playlist-view">${hi(n,i)}</ul>\n    `}(t):function(t,e){return`<ul id="js-${t}" class="playlist-view grid-view">${hi(n,o)}</ul>`}(t)}(t):'<p class="playlist-message">This playlist is empty</p>'}function ki(t,e=""){let n=t.name;return t.artist&&t.title&&(n=`\n            <div class="track-title">${t.title}</div>\n            <div class="track-artist">${t.artist} ${t.album?`- ${t.album}`:""}</div>\n        `),`<div id="${e}" class="track-name">${n}</div>`}function Ei(t){const e=H();e&&e.playlistId===t&&-1!==e.index&&requestAnimationFrame(()=>{Ii(t,e.index,{scrollToTrack:!0}),ji(e,Dn())})}function Li(t){var e;si(t.id).innerHTML=wi(t),t.tracks.length?(e=t.id,ri[e]&&li(e),ci(e),Ei(t.id)):li(t.id)}function Ii(t,e,{scrollToTrack:n}={}){const i=di(t,e);s(".track.playing","playing"),i.classList.add("playing"),n&&i.scrollIntoView({inline:"center"})}function ji(t,e){const n=mi(t);n&&We(n,e)}function $i(t){const e=document.getElementById("js-list-toggle-btn"),n=document.getElementById("js-grid-toggle-btn");"list"===t?(e.classList.add("active"),n.classList.remove("active")):(n.classList.add("active"),e.classList.remove("active"))}function xi(t,e){$(e.id,{type:t}),Ci({action:"change-type",playlist:{_id:e._id,type:t}}),Li(e),ee(e),$i(t)}function Ti(t){_(t,y("shuffle")),Se(t.tracks,t.sortedBy,t.order),t.tracks=U(t.tracks)}function Bi(t){var e,n,i;t.initialized=!0,h(e=`playlist/${t.id}`)||b.push(e),n=t.title,i=t.id,document.getElementById("js-sidebar-entries").insertAdjacentHTML("beforeend",`\n        <li id="js-sidebar-entry-${i}" class="sidebar-entry">\n            <a href="./#/playlist/${i}" class="sidebar-link" data-link>${n}</a>\n        </li>\n    `),function(t){const e=function(){const t="js-pl-entries";return document.getElementById(t)||function(t){document.getElementById("js-tab-home").insertAdjacentHTML("beforeend",`\n        <div class="pl-entry-container">\n            <h2 class="home-tab-section-title">Playlists</h2>\n            <ul id="${t}"></ul>\n        </div>\n    `);const e=document.getElementById(t);return e.addEventListener("click",Dt),e.addEventListener("focus",zt,!0),e}(t)}(),n=x(t.tracks),i=t.url?Mt({action:"sync",title:"Synchronize playlist",iconId:"sync"}):"",o=t.url?`\n        <div class="pl-entry-panel-container">\n            ${Mt({action:"settings",title:"Settings",iconId:"settings"})}\n        </div>\n    `:"",s=Mt({action:"remove",title:"Remove playlist",iconId:"trash"});e.insertAdjacentHTML("beforeend",`\n        <li class="pl-entry" data-entry-id=${t.id}>\n            <div class="pl-entry-thumbnail">${Rt(t.tracks)}</div>\n            <div class="pl-entry-input-container" data-action="edit">\n                <input type="text" class="input pl-entry-input" value="${t.title}">\n                <svg viewBox="0 0 24 24" class="pl-entry-input-icon">\n                    <use href="#edit">\n                </svg>\n            </div>\n            <div class="pl-entry-content">\n                <div class="pl-entry-stats">\n                    ${t.isPrivate?'\n        <svg viewBox="0 0 24 24" class="pl-entry-stats-item">\n            <use href="#lock"></use>\n        </svg>\n    ':""}\n                    <span class="pl-entry-stats-item track-count">${t.tracks.length} tracks</span>\n                    <span class="pl-entry-stats-item playlist-duration">${Ot(n)}</span>\n                </div>\n                ${i}\n                ${o}\n                ${s}\n            </div>\n        </li>\n    `)}(t),Ti(t)}function Ai(t){const e=H();if(e&&A(t.id)){const n=V(t.id,e.name);let i=-1;n?i=n.index:s(".track.playing","playing"),R({index:i}),C(i)}}function Si(t,e,n){var i;e.length&&(e=function(t,e=0){return t.map((t,n)=>(t.primaryIndex=e+n,t))}(e,t.lastTrackIndex),t.lastTrackIndex=e[e.length-1].primaryIndex+1,t.tracks=t.tracks.concat(e),t.duration=x(t.tracks)),t.initialized?(Hi(t.id),Ti(t),Ai(t),Ct(t),t.rendered&&Li(t),Ci({action:"add-tracks",playlist:{_id:t._id,tracks:e}})):(Bi(t),Ci({action:"add",playlist:t})),n&&(i=`playlist/${t.id}`,window.location.hash=`/${i}`)}function Mi(t){const e=j({title:t.target.title.value,id:Math.random().toString(36).slice(2),type:"grid"});Bi(e),Ci({action:"add",playlist:e}),t.preventDefault(),t.target.reset()}function Oi(t,e,n,i){e.insertAdjacentHTML(n,`\n        <form id="js-${t}-form" class="${t}-form">\n            <input type="text" name="title" class="input" autocomplete="off" placeholder="Playlist title" required>\n            <button class="btn">Create</button>\n        </form>\n    `);const o=document.getElementById(`js-${t}-form`);o.elements.title.focus(),o.addEventListener("submit",i)}function Ri(t){q(t).classList.add("show-spinner"),St(t)}function Hi(t){q(t).classList.remove("show-spinner"),At(t)}const Vi=new Worker("./ww.js");function Ci(t){Vi.postMessage(t)}Vi.onmessage=function({data:{action:t,payload:e}}){"init"===t?(e.forEach(t=>{Bi(j(t))}),_t(e.filter(t=>t.syncOnInit)),qn.initTrack(),w()):"update"===t&&$(e.id,e)},Vi.onerror=function(t){console.log(t)},"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("./sw.js").then(t=>{t.onupdatefound=(()=>{const e=t.installing;e.onstatechange=(()=>{"installed"===e.state&&l("sw-state-change",navigator.serviceWorker.controller?"update":"init")})})}).catch(console.log)})},54:function(t,e,n){},56:function(t,e,n){}});