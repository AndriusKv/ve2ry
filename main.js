!function(t){var e=window.webpackJsonp;window.webpackJsonp=function(n,o,r){for(var a,s,c=0,l=[];c<n.length;c++)s=n[c],i[s]&&l.push(i[s][0]),i[s]=0;for(a in o)Object.prototype.hasOwnProperty.call(o,a)&&(t[a]=o[a]);for(e&&e(n,o,r);l.length;)l.shift()()};var n={},i={2:0};function o(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.e=function(t){var e=i[t];if(0===e)return new Promise(function(t){t()});if(e)return e[2];var n=new Promise(function(n,o){e=i[t]=[n,o]});e[2]=n;var r=document.getElementsByTagName("head")[0],a=document.createElement("script");a.type="text/javascript",a.charset="utf-8",a.async=!0,a.timeout=12e4,o.nc&&a.setAttribute("nonce",o.nc),a.src=o.p+""+t+".js";var s=setTimeout(c,12e4);function c(){a.onerror=a.onload=null,clearTimeout(s);var e=i[t];0!==e&&(e&&e[1](new Error("Loading chunk "+t+" failed.")),i[t]=void 0)}return a.onerror=a.onload=c,r.appendChild(a),n},o.m=t,o.c=n,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o.oe=function(t){throw console.error(t),t},o(o.s=11)}([function(t,e,n){var i=n(7).f,o=Function.prototype,r=/^\s*function ([^ (]*)/,a="name";a in o||n(2)&&i(o,a,{configurable:!0,get:function(){try{return(""+this).match(r)[1]}catch(t){return""}}})},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e,n){t.exports=!n(4)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,e){var n=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,e,n){"use strict";var i=n(6),o=n(19),r=n(4),a=n(22),s=n(9);t.exports=function(t,e,n){var c=s(t),l=n(a,c,""[t]),u=l[0],d=l[1];r(function(){var e={};return e[c]=function(){return 7},7!=""[t](e)})&&(o(String.prototype,t,u),i(RegExp.prototype,c,2==e?function(t,e){return d.call(t,this,e)}:function(t){return d.call(t,this)}))}},function(t,e,n){var i=n(7),o=n(18);t.exports=n(2)?function(t,e,n){return i.f(t,e,o(1,n))}:function(t,e,n){return t[e]=n,t}},function(t,e,n){var i=n(14),o=n(15),r=n(17),a=Object.defineProperty;e.f=n(2)?Object.defineProperty:function(t,e,n){if(i(t),e=r(e,!0),i(n),o)try{return a(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},function(t,e){var n=0,i=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++n+i).toString(36))}},function(t,e,n){var i=n(23)("wks"),o=n(8),r=n(3).Symbol,a="function"==typeof r;(t.exports=function(t){return i[t]||(i[t]=a&&r[t]||(a?r:o)("Symbol."+t))}).store=i},function(t,e,n){n(5)("split",2,function(t,e,i){"use strict";var o=n(24),r=i,a=[].push,s="split",c="length",l="lastIndex";if("c"=="abbc"[s](/(b)*/)[1]||4!="test"[s](/(?:)/,-1)[c]||2!="ab"[s](/(?:ab)*/)[c]||4!="."[s](/(.?)(.?)/)[c]||"."[s](/()()/)[c]>1||""[s](/.?/)[c]){var u=void 0===/()??/.exec("")[1];i=function(t,e){var n=String(this);if(void 0===t&&0===e)return[];if(!o(t))return r.call(n,t,e);var i,s,d,m,f,p=[],v=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),y=0,g=void 0===e?4294967295:e>>>0,b=new RegExp(t.source,v+"g");for(u||(i=new RegExp("^"+b.source+"$(?!\\s)",v));(s=b.exec(n))&&!((d=s.index+s[0][c])>y&&(p.push(n.slice(y,s.index)),!u&&s[c]>1&&s[0].replace(i,function(){for(f=1;f<arguments[c]-2;f++)void 0===arguments[f]&&(s[f]=void 0)}),s[c]>1&&s.index<n[c]&&a.apply(p,s.slice(1)),m=s[0][c],y=d,p[c]>=g));)b[l]===s.index&&b[l]++;return y===n[c]?!m&&b.test("")||p.push(""):p.push(n.slice(y)),p[c]>g?p.slice(0,g):p}}else"0"[s](void 0,0)[c]&&(i=function(t,e){return void 0===t&&0===e?[]:r.call(this,t,e)});return[function(n,o){var r=t(this),a=void 0==n?void 0:n[e];return void 0!==a?a.call(n,r,o):i.call(String(r),n,o)},i]})},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});n(12),n(13);const i=function(){const t=[];return{load:function(e){return t.includes(e.src)?Promise.resolve():new Promise(n=>{const i=document.createElement("script");Object.keys(e).forEach(t=>{i.setAttribute(t,e[t])}),document.getElementsByTagName("body")[0].appendChild(i),t.push(e.src),i.onload=n})}}}();function o(t){return t.charAt(0).toUpperCase()+t.slice(1)}function r(t){t.parentElement.removeChild(t)}function a(t,e){const n=document.querySelector(t);n&&n.classList.remove(e)}function s(t,e,n=null){for(;e&&e!==n;){if(e.hasAttribute(t))return{elementRef:e,attrValue:e.getAttribute(t)};e=e.parentElement}}function c(t,e){return!!e&&!e.contains(t)}function l(t){const e=function(t){const e=t%60;return e<10?`0${e}`:e}(t),n=function(t){const e=Math.floor(t/60%60);return t>=3600&&e<10?`0${e}`:e}(t);return`${function(t){const e=Math.floor(t/3600);return e?`${e}:`:""}(t)}${n}:${e}`}function u(t,e){const n=new CustomEvent(t,{detail:e});window.dispatchEvent(n)}function d(t){return"object"==typeof t?URL.createObjectURL(t):t}function m(t,{id:e,title:n}){t.setAttribute("title",n),t.querySelector(".js-icon").setAttribute("href",`#${e}`)}function f(t,e="",n="spinner"){t.insertAdjacentHTML("beforeend",`\n        <img src="./assets/images/ring-alt.svg" id="${e}" class="${n}" alt="">\n    `)}function p(t){t.disabled=!1,"IMG"===t.lastElementChild.tagName&&r(t.lastElementChild)}function v(t,e,n){t.disabled=!0,f(t,e,n)}const y=Object.assign({repeat:!1,shuffle:!1,once:!1,mute:!1,volume:.2},JSON.parse(localStorage.getItem("settings"))||{});function g(t,e){y[t]=e,localStorage.setItem("settings",JSON.stringify(y))}function b(t){return y[t]}function h(t){delete y[t]}n(10);const E=["home"];function w(t){return E.some(e=>e===t)}function k(t){window.location.hash=`/${t}`}function L(t){if(!w(t))return void k("home");const e=t.startsWith("playlist/");u("route-change",{tabId:e?t.split("playlist/")[1]:t,isPlaylistTab:e})}window.addEventListener("hashchange",()=>{const t=window.location.hash.slice(2);t?L(t):history.back()});n(0);const x={};let I="",j=null;function T(t){return x[t]}function $(t){return t.tracks&&(t.duration=A(t.tracks)),x[t.id]=Object.assign({sortedBy:"index",order:1,shuffled:!1,tracks:[],playbackIndex:0,playbackOrder:[],duration:0},t,{rendered:!1,initialized:!1}),x[t.id]}function B(t,e){Object.assign(x[t],e)}function A(t){return t.reduce((t,e)=>t+=e.durationInSeconds,0)}function S(t=""){I=t}function M(){return I}function O(t){return t===I}function C(){return x[I]}function _(t){return t?Object.assign({},t):null}function R(t){j=_(t)}function V(t){Object.assign(j,t)}function H(){return j}function P(t,e){const n=T(t);return _(n?n.tracks.find(t=>t.name===e):null)}function U(t){const e=C();B(e.id,{playbackIndex:e.playbackOrder.indexOf(parseInt(t,10))})}function q(t,e){const n=t.map((t,e)=>e);return e?function(t){let e=t.length;for(;e;){const i=Math.floor(Math.random()*e);e-=1;var n=[t[i],t[e]];t[e]=n[0],t[i]=n[1]}return t}(n):n}function D({id:t,tracks:e},n){B(t,{shuffled:n,playbackOrder:q(e,n)}),function(){const t=H();t&&U(t.index)}()}function z(t){return t.map((t,e)=>(t.index=e,t))}function N(t){return document.getElementById(`js-sidebar-entry-${t}`)}function W(){const t=document.getElementById("js-active-playlist-icon");t&&r(t)}document.getElementById("js-sidebar-container").addEventListener("click",({currentTarget:t,target:e})=>{if(s("data-link",e,t)||c(e,t.firstElementChild))return void t.classList.add("hidden");const n=s("data-btn",e,t);n&&function(t){const e=document.getElementById("js-sidebar-form");e?r(e):Ai("sidebar",t.parentElement,"afterend",Bi)}(n.elementRef)});let F=null;function K(){window.removeEventListener("click",J,!0),r(F.element),F=null}function Y(t,e,n){e(t,n),F={id:t,element:document.getElementById(t),removeOnClick:n.removeOnClick,initiator:n.element},window.addEventListener("click",J,!0)}function X(t,e,n){if(F){const i=F.id;K(),i!==t&&Y(t,e,n)}else Y(t,e,n)}function J({target:t}){if(F.removeOnClick)return void K();const e=c(t,F.element),n=c(t,F.initiator);e&&n&&K()}let Z=!1;function G(){return Z}async function Q(){if(Z)return;const t=document.getElementById("js-google-sign-in-or-out-btn");Z=!0,v(t);try{await i.load({src:"https://apis.google.com/js/api.js"}),await new Promise(t=>gapi.load("client:auth2",t)),await gapi.client.init({apiKey:"AIzaSyD33Rxm4dA34Mh84oSxYTUUF_jyCLLOua4",clientId:"293076144560-r5cear7rprgo094u6ibcd6nl3bbg18te.apps.googleusercontent.com",discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest"],scope:"https://www.googleapis.com/auth/youtube.force-ssl"}),gapi.auth2.getAuthInstance().isSignedIn.get()&&(t.firstElementChild.textContent="Sign Out")}catch(t){console.log(t)}p(t)}const tt=document.getElementById("js-volume-slider"),et=document.getElementById("js-track-slider"),nt=document.getElementById("js-controls");let it=!1,ot=!1;const rt=function(){let t=0;function e(){clearTimeout(t)}function n(e,i,o){const r=performance.now()-i-o;it||gt(e,e.currentTime),ae.updateTrack({currentTime:e.currentTime}),e.currentTime<=e.durationInSeconds?(e.currentTime+=1,o+=1e3,t=setTimeout(n,1e3-r,e,i,o)):u("track-end")}return{stop:e,start:function(t){const i=performance.now();e(),n(t,i,0)}}}();function at(t){if(ot)return;const e=pi(t),n="play-pause-btn-spinner";ot=!0,e&&f(e,`js-track-${n}`),f(document.getElementById("js-play-btn"),`js-${n}`)}function st(){if(!ot)return;const t="play-pause-btn-spinner",e=document.getElementById(`js-track-${t}`);ot=!1,e&&r(e),r(document.getElementById(`js-${t}`))}function ct(t,e){const n={on:{id:"play",title:"Play"},off:{id:"pause",title:"Pause"}};m(t,e?n.on:n.off)}function lt(t,e){const n={on:{id:"volume-off",title:"Unmute"},off:{id:"volume",title:"Mute"}};m(t,e?n.on:n.off)}function ut(t,e){const n=document.getElementById(`js-${t}-slider`).getBoundingClientRect();let i=(e-n.left-6)/(n.width-12)*100;return i<0?i=0:i>100&&(i=100),i}function dt(){rt.stop(),gt()}function mt(t){g("volume",t),bt(t),function(t){const e=H()||{};"native"===e.player?ee(t):"youtube"===e.player&&Ut(t)}(t)}function ft(t){const e=document.getElementById("js-volume-slider-label");e.textContent=`${Math.floor(t)}%`,e.style.left=`${t}%`}function pt({pageX:t}){const e=ut("volume",t),n=e/100;n!==b("volume")&&(ft(e),n?(Tt(),mt(n)):jt({attrValue:"mute",elementRef:document.getElementById("js-volume-btn")}))}function vt(){window.removeEventListener("mousemove",pt),window.removeEventListener("mouseup",vt),tt.addEventListener("mousemove",ht)}function yt(t,e){document.getElementById(`js-${t}-slider-thumb`).style.left=`${100*e}%`,document.getElementById(`js-${t}-slider-elapsed`).style.transform=`scaleX(${e})`}function gt(t,e=0){const n=l(e),i=t?t.durationInSeconds:1,o=t?t.duration:n;it||(document.getElementById("js-track-current").textContent=n),yt("track",e/i),et.setAttribute("aria-valuenow",e),et.setAttribute("aria-valuetext",`${n} of ${o}`)}function bt(t){const e=Math.round(100*t);yt("volume",t),tt.setAttribute("aria-valuenow",e),tt.setAttribute("aria-valuetext",`${e}% volume`)}function ht({pageX:t}){ft(ut("volume",t))}function Et(t="0:00",e=0){document.getElementById("js-track-duration").textContent=t,et.setAttribute("aria-valuemax",e)}function wt(t,e){const n=ut("track",t);return{percent:n,currentTime:Math.floor(e*n/100)}}function kt(t,e){const n=document.getElementById("js-track-slider-label");n.style.left=`${t}%`,n.textContent=l(e)}function Lt({pageX:t}){const e=H(),n=wt(t,e.durationInSeconds),i=n.percent,o=n.currentTime;gt(e,o),kt(i,o)}function xt({pageX:t}){const e=H();if(!e)return;const n=wt(t,e.durationInSeconds);kt(n.percent,n.currentTime)}function It({pageX:t}){const e=H();if(it=!1,e){const n=wt(t,e.durationInSeconds).currentTime;gt(e,n),be(e.player,n),ae.updateTrack({currentTime:n})}window.removeEventListener("mousemove",Lt),window.removeEventListener("mouseup",It),et.addEventListener("mousemove",xt)}function jt({attrValue:t,elementRef:e}){const n=!b(t);e.classList.toggle("active"),e.setAttribute("aria-checked",n),g(t,n),"shuffle"===t?function(t){const e=C();e&&D(e,t)}(n):"mute"===t&&(!function(t){const e=t?0:b("volumeBeforeMute");t?g("volumeBeforeMute",b("volume")):h("volumeBeforeMute");mt(e)}(n),lt(e,n))}function Tt(){const t=b("mute");if(t){const e=document.getElementById("js-volume-btn");h("volumeBeforeMute"),g("mute",!t),lt(e,!t),e.classList.remove("active")}}et.addEventListener("mousedown",t=>{1===t.which&&H()&&(it=!0,Lt(t),et.removeEventListener("mousemove",xt),window.addEventListener("mousemove",Lt),window.addEventListener("mouseup",It))}),et.addEventListener("mousemove",xt),et.addEventListener("keydown",({which:t})=>{const e=H();if(!e||t<37||t>40)return;const n=e.durationInSeconds;let i=ae.getTrack().currentTime;38===t||39===t?(i+=5)>n&&(i=n):37!==t&&40!==t||(i-=5)<0&&(i=0),gt(e,i),be(e.player,i),ae.updateTrack({currentTime:i})}),tt.addEventListener("mousedown",t=>{1===t.which&&(pt(t),tt.removeEventListener("mousemove",ht),window.addEventListener("mousemove",pt),window.addEventListener("mouseup",vt))}),tt.addEventListener("mousemove",ht),tt.addEventListener("keydown",({which:t})=>{let e=b("volume");if(38===t||39===t)(e+=.05)>1&&(e=1),Tt();else if(e&&(37===t||40===t)&&(e-=.05)<=0)return e=0,void jt({attrValue:"mute",elementRef:document.getElementById("js-volume-btn")});mt(e)}),document.getElementById("js-main-controls").addEventListener("click",({target:t})=>{const e=s("data-item",t);e&&function(t){switch(t){case"previous":fe("direction",-1,M());break;case"play":!function(){const t=H();if(!t)return void fe("direction",0,si());de(t)}();break;case"next":pe()}}(e.attrValue)}),nt.addEventListener("click",({target:t})=>{const e=s("data-item",t);e&&jt(e)}),nt.addEventListener("keyup",({which:t,target:e})=>{const n=s("data-item",e);!n||32!==t&&13!==t||jt(n)}),document.getElementById("js-control-toggle-btn").addEventListener("click",()=>{nt.classList.toggle("visible")}),bt(b("volume")),Array.from(document.querySelectorAll(".control-btn")).forEach(t=>{const e=t.getAttribute("data-item"),n=b(e);n&&(t.classList.add("active"),t.setAttribute("aria-checked",!0),"mute"===e&&lt(t,n))});const $t=1,Bt=2,At=3,St=-1;let Mt=!1,Ot=!1,Ct=null,_t=null;function Rt({data:t}){const e=H();if(!e||"youtube"!==e.player)return;const n=document.getElementById("js-yt-player"),i=se(),o=i?Bt:$t;if(document.activeElement===n&&(t===$t&&o===Bt||t===Bt&&o===$t))return n.blur(),o===Bt&&u("track-start",Ct.getCurrentTime()),void ce(!i,e);if(t===$t){if(o===$t&&(Mt=!1),Mt||o===Bt)return Mt=!1,Ct.pauseVideo(),void st();u("track-start",Ct.getCurrentTime())}else t===Bt&&o===$t?(Ct.playVideo(),st()):t===At&&(rt.stop(),at(e))}function Vt(){Ot=!0,Pt(..._t),_t=null}function Ht(t){if(console.log(t),t.data>=100){const t=H();ye(t),he({title:`Cannot play ${t.name}`,body:"It is either removed or marked as private"})}}function Pt(t,e,n){if(!Ot)return _t=[t,e,n],void i.load({src:"https://www.youtube.com/iframe_api"});Ut(e),"number"==typeof n?(Mt=!0,Ct.loadVideoById(t.id,n)):Ct.loadVideoById(t.id)}function Ut(t){Ct.setVolume(100*t)}window.onYouTubeIframeAPIReady=function(){Ct=new YT.Player("js-yt-player",{playerVars:{autoplay:0,disablekb:1,controls:0,fs:0,showinfo:0,rel:0,iv_load_policy:3},events:{onReady:Vt,onStateChange:Rt,onError:Ht}})};let qt,Dt,zt=0,Nt=0,Wt=null,Ft=!1;function Kt(){clearTimeout(Nt),cancelAnimationFrame(zt),Wt.style.textIndent="0",Nt=0,Wt=null}function Yt(t,e,n,i=0){i=Math.abs(i)<e+10?i-1:n,t.style.textIndent=`${i}px`,zt=requestAnimationFrame(()=>{Yt(t,e,n,i)})}function Xt({currentTarget:t,target:e}){const n=s("data-item",e);if(!n)return;const i=n.attrValue,o=n.elementRef,r=H();"image"===i?de(r):"yt-watch"===i?function(t,e){const n=se(),i=ae.getTrack().currentTime;n||(Ct.pauseVideo(),ce(!n,e)),t.setAttribute("href",`https://www.youtube.com/watch?v=${e.id}&time_continue=${i}`)}(o,r):"close"===i&&t.classList.remove("visible")}function Jt({currentTarget:t,target:e}){if(t===e)return;if(Wt&&e!==Wt)Kt();else if(Nt)return;const n=e.scrollWidth,i=e.parentElement.offsetWidth-8;n>i&&(Wt=e,Nt=setTimeout(Yt,400,e,n,i),t.addEventListener("mouseleave",Zt))}function Zt({currentTarget:t}){t.removeEventListener("mouseleave",Zt),Wt&&Kt()}function Gt(){document.getElementById("js-media-container").classList.toggle("visible")}function Qt(){Ft&&(Ft=!1,document.title="Veery",document.getElementById("js-track-name").removeEventListener("mousemove",Jt),document.getElementById("js-expand-media-btn").removeEventListener("click",Gt),document.getElementById("js-now-playing").innerHTML="")}function te(t){Ft&&Qt(),Ft=!0,document.title=t.artist&&t.title?`${t.artist} - ${t.title}`:t.name,function(t){const e=document.getElementById("js-now-playing"),n=t.artist&&t.title?t.artist:t.name,i=n!==t.name?`<div class="track-title">${t.title}</div>`:"";e.insertAdjacentHTML("beforeend",`\n        <div class="now-playing-art-container">\n            <button id="js-expand-media-btn" class="btn btn-icon expand-media-btn" title="Expand">\n                <svg viewBox="0 0 24 24">\n                    <use href="#expand"></use>\n                </svg>\n            </button>\n            <img src=${d(t.thumbnail)} class="artwork" alt="">\n        </div>\n        <div id="js-track-name" class="track-name">\n            ${i}\n            <div class="track-artist">${n}</div>\n        </div>\n    `),document.getElementById("js-track-name").addEventListener("mousemove",Jt),document.getElementById("js-expand-media-btn").addEventListener("click",Gt)}(t)}function ee(t){Dt.volume=t}function ne(t){Dt.currentTime=t}const ie=document.getElementById("js-tab-playlist-container");let oe=!0,re=!1;const ae=function(){function t(){return JSON.parse(localStorage.getItem("track"))||{}}function e(t){localStorage.setItem("track",JSON.stringify(t))}function n(){localStorage.removeItem("track")}return{getTrack:t,removeTrack:n,saveTrack:e,updateTrack:function(n){e(Object.assign(t(),n))},initTrack:function(){const e=t();if(!e)return;const i=P(e.playlistId,e.name);i?(me(i,e.currentTime),gt(i,e.currentTime),oe=!0):n()}}}();function se(){return oe}function ce(t,e){(oe=t)&&(W(),rt.stop()),ue(e,oe)}function le(t){const e=T(t.playlistId);te(t),Et(t.duration,t.durationInSeconds),et.classList.add("visible"),function(t){const e=document.getElementById("js-yt-player"),n=document.getElementById("js-yt-player-watch"),i=document.getElementById("js-media-image");"youtube"===t.player?(e.classList.remove("hidden"),n.classList.remove("hidden"),i.classList.add("hidden"),n.setAttribute("href",`https://www.youtube.com/watch?v=${t.id}`)):(e.classList.add("hidden"),n.classList.add("hidden"),i.classList.remove("hidden"),i.src=d(t.thumbnail))}(t),e.rendered&&-1!==t.index&&wi(e.id,t.index,{scrollToTrack:re}),re=!1,oe=!1}function ue(t,e){ct(document.getElementById("js-play-btn"),e),ki(t,e)}function de(t){"native"===t.player?oe?Dt.play():Dt.pause():"youtube"===t.player&&function(t){if(!Ot)return;const e=Ct.getPlayerState();e!==At&&e!==St&&(t?Ct.playVideo():Ct.pauseVideo())}(oe),ce(!oe,t)}function me(t,e){const n=b("volume");var i,o,r;S(t.playlistId),U(t.index),R(t),le(t),void 0===e&&(at(t),ue(t,oe)),"native"===t.player?(i=t.audioTrack,o=n,r=e,qt&&URL.revokeObjectURL(qt),qt=URL.createObjectURL(i),(Dt=new Audio(qt)).onplaying=function(){u("track-start",Dt.currentTime)},ee(o),"number"!=typeof r?Dt.play():ne(r)):"youtube"===t.player&&Pt(t,n,e)}function fe(t,e,n){const i=T(n),o=b("shuffle"),r=H();let a=null;if(i){if(r&&(dt(),ki(r,!0),ve(r.player)),i.shuffled!==o&&D(i,o),"index"===t)a=_(i.tracks[e]);else if("direction"===t){if(!(a=function(t,e){const n=function({playbackIndex:t,playbackOrder:e},n){return t+=n,!n||t>=e.length?t=0:-1===t&&(t=e.length-1),e[t]}(t,e);return _(t.tracks[n])}(i,e)))return void ge(r);re=!0}me(a)}}function pe(){fe("direction",1,M())}function ve(t){"native"===t?(Dt.pause(),Dt.currentTime=0,Dt=null):"youtube"===t&&Ot&&(st(),Ct.stopVideo())}function ye(t){t&&ve(t.player),ge(t)}function ge(t){oe=!0,ae.removeTrack(),Et(),et.classList.remove("visible"),Qt(),R(),S(),W(),a(".track.playing","playing"),document.getElementById("js-media-container").classList.remove("visible"),t&&(dt(),st(),ue(t,oe))}function be(t,e){var n;rt.stop(),"native"===t?ne(e):"youtube"===t&&(n=e,Ct.seekTo(n,!0))}function he({title:t,body:e}){var n,i;X("js-player-message",(n=t,i=e,(t,{element:e})=>{e.insertAdjacentHTML("beforeend",`\n            <div id="${t}" class="panel player-message">\n                <p class="play-message-title">${n}</p>\n                <p class="play-message-body">${i}</p>\n            </div>\n        `)}),{element:document.getElementById("js-player"),removeOnClick:!0})}function Ee(t){return new Promise(e=>{let n=URL.createObjectURL(t),i=new Audio(n);i.preload="metadata",i.addEventListener("loadedmetadata",function t(){e(Math.floor(i.duration)),i.removeEventListener("loadedmetadata",t),i=null,n=URL.revokeObjectURL(n)})})}async function we(t,e,i=[]){const o=t[i.length],r=o.audioTrack,a=o.name,s=await async function(t){if("audio/flac"===t.type)return(0,(await n.e(1).then(n.bind(null,27))).default)(t);if("audio/ogg"===t.type)return(0,(await n.e(0).then(n.bind(null,28))).default)(t);let e={};var i=await Promise.all([new Promise(e=>{parse_audio_metadata(t,e)}),Ee(t)]);return(e=i[0]).duration=i[1],e}(r),c=s.artist,u=s.title,d=s.album,m=s.duration,f=s.picture;return i.push({audioTrack:r,name:a,title:c?u.trim():a,artist:c?c.trim():"",album:d?d.trim():"",thumbnail:f||"assets/images/album-art-placeholder.png",durationInSeconds:m,duration:l(m),player:"native",playlistId:e}),i.length!==t.length?await we(t,e,i):i}function ke(t,e,{initialized:n,id:i}){he({title:`${t} files`,body:e}),He(t),n&&Mi(i)}async function Le(t,e,n,o){if(Ve(t),!n.length)return void ke(t,"No valid audio file found",e);const r=(a=n,s=e.tracks,a.reduce((t,e)=>{const n=(c=e.name.trim()).slice(0,c.lastIndexOf("."));return s.some(t=>t.name===n)||t.push({audioTrack:e,name:n}),t},[]));var a,s,c;if(r.length)try{await i.load({src:"libs/metadata-audio-parser.min.js"}),$i(e,await o(r,e.id))}catch(t){console.log(t),Mi(e.id)}finally{He(t)}else ke(t,`Track${n.length>1?"s":""} already exist`,e)}function xe(t){const e=function(t){const e=new Audio;return t.filter(t=>e.canPlayType(t.type))}(t),n="local-files";let i=T(n);i&&i.initialized?Si(n):i=$({id:n,title:"Local files",type:"list",player:"native"}),Le("local",i,e,we)}async function Ie(t,e,n=[]){const i=t[n.length],o=await(r=i.audioTrack.link,fetch(r).then(t=>t.blob()));var r;const a=await Ee(o);return n.push({audioTrack:o,durationInSeconds:a,index:n.length,title:i.name,artist:"",album:"",name:i.name,duration:l(a),thumbnail:"assets/images/album-art-placeholder.png",player:"native",playlistId:e}),n.length!==t.length?await Ie(t,e,n):n}ie.addEventListener("dblclick",function({currentTarget:t,target:e}){if(s("data-btn",e,t))return;const n=s("data-index",e,t);n&&fe("index",n.attrValue,si())}),ie.addEventListener("click",({currentTarget:t,target:e})=>{const n=s("data-btn",e,t);if(!n)return;const i=s("data-index",n.elementRef,t).attrValue,o=parseInt(i,10),r=H(),a=si();r&&r.playlistId===a&&o===r.index?de(r):fe("index",o,a)}),window.addEventListener("track-start",({detail:t})=>{const e=H(),n=e.playlistId,i=e.name,o=e.durationInSeconds;!function(t){const e=N(t);W(),e.insertAdjacentHTML("beforeend",'\n        <svg viewBox="0 0 24 24" id="js-active-playlist-icon" class="active-playlist-icon">\n            <use href="#volume"></use>\n        </svg>\n    ')}(n),ae.saveTrack({playlistId:n,name:i}),rt.start({currentTime:Math.floor(t),durationInSeconds:o}),st()}),window.addEventListener("track-end",()=>{const t=H();b("once")?ye(t):(ae.removeTrack(),b("repeat")?me(t):pe())});n(26);function je(t){he({title:"YouTube",body:t}),He("youtube")}function Te(t){if(t.includes("H")||(t=`0H${t}`),!t.includes("M")){const e=t.indexOf("H")+1;t=`${t.slice(0,e)}0M${t.slice(e)}`}return t.includes("S")||(t=`${t}0`),t.match(/\d{1,}/g).reverse().reduce((t,e,n)=>t+=e*60**n,0)}function $e(t,e,n,i,o){let r=`part=${e}&${n}=${i}&maxResults=50&key=AIzaSyD33Rxm4dA34Mh84oSxYTUUF_jyCLLOua4`;const a=gapi.auth2.getAuthInstance();return o&&(r+=`&pageToken=${o}`),a.isSignedIn.get()&&(r+=`&access_token=${a.currentUser.get().getAuthResponse().access_token}`),fetch(`https://www.googleapis.com/youtube/v3/${t}?${r}`).then(t=>t.json())}function Be(t){return t.filter(t=>{const e=t.snippet.title;return"Deleted video"!==e&&"Private video"!==e})}function Ae(t,e){return t.map(t=>({id:t.snippet.resourceId.videoId,durationInSeconds:t.durationInSeconds,duration:l(t.durationInSeconds),name:t.snippet.title,title:t.snippet.title,artist:"",album:"",thumbnail:t.snippet.thumbnails.medium.url,player:"youtube",playlistId:e}))}async function Se(t,e){const n=await $e("playlistItems","snippet","playlistId",t,e);n.error&&function(t,e){const n=t.code;throw 403===n?je("You need to be sign in if you want to import private playlist"):404===n&&je("Playlist was not found"),Mi(e),new Error(t.message)}(n.error,t);const i=Be(n.items),o=Ae(await async function(t){const e=t.map(t=>t.snippet.resourceId.videoId).join(),n=await $e("videos","contentDetails","id",e);return t.reduce((t,e)=>{const i=n.items.find(({id:t})=>t===e.snippet.resourceId.videoId);return i&&(e.durationInSeconds=Te(i.contentDetails.duration)-1,t.push(e)),t},[])}(i),t);if(n.nextPageToken){const e=await Se(t,n.nextPageToken);return o.concat(e)}return o}async function Me(t,e){const n="youtube",i=T(n);e||(e=i?"update":"new"),i&&Si(n);const o=(await $e("videos","snippet,contentDetails","id",t)).items;i&&i.tracks.length;if(!o.length)return je("Video was not found"),void Mi(n);var r;qe({title:"YouTube",id:n,tracks:(r=o,Ae(Be(r).map(t=>(t.snippet.resourceId={videoId:t.id},t.durationInSeconds=Te(t.contentDetails.duration)-1,t)),"youtube")),player:n,type:"grid"},e)}async function Oe(t,e,n){const i=T(e);n||(n=i?"update":"new"),i&&Si(e);const o=await Se(e),r=await async function(t){const e=(await $e("playlists","snippet,status","id",t)).items;return{title:e[0].snippet.title,status:e[0].status.privacyStatus}}(e);qe({url:t,title:r.title,id:e,tracks:o,player:"youtube",type:"grid",isPrivate:"private"===r.status},n)}function Ce(t,e){const n=function(t){let e="",n="";try{const i=new URL(t).searchParams;e=i.get("v"),n=i.get("list")}catch(i){const o=t.match(/v=[a-zA-Z0-9\-_]+/),r=t.match(/list=[a-zA-Z0-9\-_]+/);o&&(e=o[0].slice(2)),r&&(n=r[0].slice(5))}return{videoId:e,playlistId:n}}(t),i=n.videoId,o=n.playlistId;i?Me(i,e):o?"WL"===o?je("Importing Watch Later playlist is not allowed"):Oe(t,o,e):je("Invalid url")}let _e="";function Re(t=""){_e=t}function Ve(t){const e=document.querySelector(`[data-option=${t}]`).children;Array.from(e).forEach(t=>{t.hasAttribute("data-item")&&v(t,"","import-option-spinner")})}function He(t){const e=document.querySelector(`[data-option=${t}]`).children;Array.from(e).forEach(t=>{t.hasAttribute("data-item")&&p(t)})}function Pe(){Re(),function(){const t=document.getElementById("js-import-form");t&&(t.removeEventListener("submit",Ne),r(t),a(".import-option-btn.active","active"))}()}function Ue(t,{url:e,type:n}){"youtube"===t&&Ce(e,n)}async function qe(t,e="new"){const n=t.tracks.splice(0);let i=null,o=[];if("new"===e)i=$(t),o=n;else if("sync"===e)i=T(t.id),o=n,Ci({action:"remove-tracks",playlist:{_id:(s=i)._id,tracks:s.tracks}}),s.tracks.length=0,s.duration=0;else{if("update"!==e)throw new Error("Unknown import type");i=T(t.id),r=n,a=i.tracks,o=r.reduce((t,e)=>(a.some(t=>t.name===e.name)||t.push(e),t),[])}var r,a,s;var c;$i(i,await(c=o,c.length?new Promise(t=>{let e=0;c.forEach(n=>{const i=new Image;i.onload=function(){(e+=1)===c.length&&t(c)},i.onerror=function(){n.thumbnail="assets/images/album-art-placeholder.png",(e+=1)===c.length&&t(c)},i.src=n.thumbnail})}):Promise.resolve(c))),Pe(),He(t.player)}function De({target:t}){xe([...t.files]),t.value="",t.removeEventListener("change",De),r(t)}function ze(t){const e=document.getElementById("js-file-picker")||function(){const t=document.createElement("input");return t.setAttribute("type","file"),t.setAttribute("id","js-file-picker"),t.classList.add("file-picker"),t.addEventListener("change",De),document.body.appendChild(t),t}();"file"===t?(e.removeAttribute("webkitdirectory"),e.removeAttribute("directory"),e.removeAttribute("allowdirs"),e.setAttribute("multiple","")):"folder"===t&&(e.removeAttribute("multiple"),e.setAttribute("webkitdirectory",""),e.setAttribute("directory",""),e.setAttribute("allowdirs","")),e.click()}function Ne(t){const e=t.target.elements.url.value.trim();if(e){const n=t.target.getAttribute("data-for");Pe(),Ve(n),Ue(n,{url:e})}t.preventDefault()}function We(t,{element:e}){e.insertAdjacentHTML("afterend",`\n        <div id="${t}" class="panel info-panel">\n            <h3 class="info-panel-title">Accepted formats</h3>\n            <ul>\n                <li class="info-panel-content-item">youtube.com/playlist?list={playlistId}</li>\n                <li class="info-panel-content-item">youtube.com/watch?v={videoId}</li>\n            </ul>\n        </div>\n    `)}function Fe({attrValue:t,elementRef:e}){if("form-toggle"===t){const t="youtube";_e!==t?(e.classList.add("active"),function(t,e){const n="js-import-form",i=`\n        <form id=${n} class="import-form" data-for="${e}">\n            <input type="text" name="url" class="input" placeholder="URL" required>\n            <button class="btn">Import</button>\n        </form>\n    `;t.insertAdjacentHTML("afterend",i);const o=document.getElementById(n);o.elements.url.focus(),o.addEventListener("submit",Ne)}(e,t),Re(t),G()||Q()):Pe()}else"google-sign-in-or-out"===t?async function(t){if(!t.disabled){v(t);try{const e=gapi.auth2.getAuthInstance();e.isSignedIn.get()?(await e.signOut(),t.firstElementChild.textContent="Sign In"):(await e.signIn(),t.firstElementChild.textContent="Sign Out")}catch(t){console.log(t)}p(t)}}(e):"youtube-info"===t&&X(`js-${t}-panel`,We,{element:e})}function Ke(){const t="js-pl-entries";return document.getElementById(t)||function(t){const e=document.createElement("div"),n=document.createElement("h2"),i=document.createElement("ul");return e.classList.add("pl-entry-container"),n.classList.add("home-tab-section-title"),i.classList.add("pl-entries"),n.textContent="Playlists",i.id=t,i.addEventListener("click",rn),i.addEventListener("focus",an,!0),e.appendChild(n),e.appendChild(i),document.getElementById("js-tab-home").appendChild(e),i}(t)}function Ye(t){const e=document.querySelector(`[data-entry-id="${t}"]`);return e?e.querySelector("[data-action='sync']"):null}function Xe(t){const e=Ye(t);e&&p(e)}function Je(t){const e=Ye(t);e&&v(e)}function Ze(){const t=document.getElementById("js-pl-entries");t&&Array.from(t.children).forEach(t=>{const e=T(t.getAttribute("data-entry-id")),n=e.tracks,i=e.duration;t.querySelector(".track-count").textContent=`${n.length} tracks`,t.querySelector(".playlist-duration").textContent=Ge(i)})}function Ge(t){let e=Math.floor(t/3600),n=Math.ceil(t/60%60);return 60===n&&(n=0,e+=1),`${e} hr ${n} min`}function Qe(t,{element:e,pl:n}){e.insertAdjacentHTML("afterend",`\n        <div id="${t}" class="panel pl-entry-panel">\n            <h3 class="pl-entry-panel-title">Playlist settings</h3>\n            <label class="pl-entry-setting">\n                <input type="checkbox" class="checkbox-input" ${n.syncOnInit?"checked":""}>\n                <div class="checkbox"></div>\n                <span>Synchronize playlist on startup</span>\n            </label>\n        </div>\n    `),document.getElementById(t).addEventListener("change",sn)}function tn(t){const e=t.parentElement;var n;r(t),e.children.length||((n=e).removeEventListener("click",rn),n.removeEventListener("focus",an,!0),r(n.parentElement))}async function en(t){t.length&&(G()||(t.forEach(t=>{Je(t.id)}),await Q(),t.forEach(t=>{Xe(t.id)})),Pe(),Ve("youtube"),t.forEach(({player:t,url:e})=>{Ue(t,{url:e,type:"sync"})}))}function nn({currentTarget:t}){const e=s("data-entry-id",t).attrValue,n=T(e),i=n._id,o=n.title,r=t.value;var a;(t.removeEventListener("blur",nn),t.removeEventListener("keyup",on),r)?r!==o&&(a=r,N(e).querySelector(".sidebar-link").textContent=a,B(e,{title:r}),Ci({action:"change-title",playlist:{_id:i,title:r}})):t.value=o}function on({currentTarget:t,which:e}){13===e&&t.blur()}function rn({target:t}){const e=s("data-entry-id",t),n=s("data-action",t);if(!e||!n||n.elementRef.disabled)return;const i=n.attrValue,o=n.elementRef,a=T(e.attrValue);"remove"===i?(!function({id:t,rendered:e,_id:n}){O(t)&&ye(H());e&&r(li(t));o=t,delete x[o],i=t,r(N(i)),Ci({action:"remove",playlist:{_id:n}});var i;var o}(a),tn(e.elementRef)):"sync"===i?en([a]):"settings"===i?X("js-pl-entry-panel",Qe,{element:o,pl:a}):"edit"===i&&o.querySelector(".input").focus()}function an({target:t}){const e=s("data-action",t);e&&"edit"===e.attrValue&&(t.addEventListener("blur",nn),t.addEventListener("keyup",on))}function sn(t){const e=T(s("data-entry-id",t.target).attrValue);e.syncOnInit=t.target.checked,Ci({action:"change-sync",playlist:{_id:e._id,syncOnInit:e.syncOnInit}})}function cn({currentTarget:t,target:e}){const n=s("data-panel-item",e,t);if(!n)return;const i=n.attrValue,o=n.elementRef;"btn"===i?(Ai("move-to",o.parentElement,"beforeend",ln),r(o)):(t.removeEventListener("click",cn),function(t){const e=Pn(Hn()),n=ci().tracks,i=T(t),o=n.filter(n=>e.includes(n.index)&&!P(t,n.name)).map(e=>Object.assign({},e,{playlistId:t}));$i(i,o,!0)}(i),K(),In())}function ln(t){const e=document.getElementById("js-move-to-list"),n=si();Bi(t),e?e.innerHTML=un(n):t.target.insertAdjacentHTML("beforebegin",dn(n))}function un(t){return Object.keys(x).map(T).reduce((e,n)=>(n.id!==t&&(e+=`\n                <li data-panel-item="${n.id}">\n                    <button class="btn move-to-list-item-btn">${n.title}</button>\n                </li>\n            `),e),"")}function dn(t){const e=un(t);return e?`<ul id="js-move-to-list" class="move-to-list">${e}</ul>`:""}function mn(t,{playlistId:e}){document.getElementById("js-move-to-panel-container").insertAdjacentHTML("beforeend",`\n        <div id="${t}" class="panel move-to-panel">\n            <h3 class="move-to-panel-title">Move to</h3>\n            ${dn(e)}\n            <button class="btn btn-icon move-to-new-pl-btn" data-panel-item="btn">\n                <svg viewBox="0 0 24 24">\n                    <use href="#plus"></use>\n                </svg>\n                <span>Create new playlist</span>\n            </button>\n        </div>\n    `)}document.getElementById("js-import-options").addEventListener("click",({currenTarget:t,target:e})=>{const n=s("data-item",e,t);if(!n||n.elementRef.disabled)return;const o=s("data-option",e,t).attrValue;"local"===o?ze(n.attrValue):"dropbox"===o?async function(){await i.load({src:"https://www.dropbox.com/static/api/2/dropins.js",id:"dropboxjs","data-app-key":"6ur73hspbv8o1z9"}),Dropbox.choose({success(t){const e="dropbox";Le(e,T(e)||$({id:e,title:"Dropbox",type:"grid",player:"native"}),t,Ie)},linkType:"direct",multiselect:!0,extensions:["audio"]})}():"youtube"===o&&Fe(n)});const fn={},pn={};let vn=null,yn=null,gn=null,bn={},hn=[],En=0,wn=!1,kn=!1;function Ln({id:t,tracks:e}){vn&&vn.removeEventListener("mousedown",Rn),e.length&&(vn=li(t)).addEventListener("mousedown",Rn)}function xn(){Hn().forEach(t=>{t.classList.remove("selected")})}function In(){xn(),Tn()}function jn(){kn||(kn=!0,function(){const t="js-move-to-panel-container";document.getElementById("js-playlist-type-btns").insertAdjacentHTML("beforebegin",`\n        <div id="${t}" class="playlist-tab-header-item" data-move-to>\n            <button class="btn btn-icon" data-item="move-to" title="Move to">\n                <svg viewBox="0 0 24 24">\n                    <path d="M2,16H10V14H2M18,14V10H16V14H12V16H16V20H18V16H22V14M14,6H2V8H14M14,10H2V12H14V10Z" />\n                </svg>\n            </button>\n        </div>\n    `),document.getElementById(t).addEventListener("click",cn)}(),setTimeout(()=>{window.addEventListener("click",_n,!0)},0),window.addEventListener("keypress",Vn))}function Tn(){kn&&(kn=!1,function(){const t=document.getElementById("js-move-to-panel-container");t.removeEventListener("click",cn),r(t)}(),window.removeEventListener("click",_n,!0),window.removeEventListener("keypress",Vn))}function $n(t,e){return t>e?e:t<0?0:t}function Bn(){clearInterval(En),En=0}function An(t){wn=!0,requestAnimationFrame(()=>{gn&&function(t,e,n,i){let o=t.x-e.x,r=t.y-e.y;if(o<0){const t=e.x+o;o*=-1,n.left=t,i.left=`${t}px`}else n.left!==e.x&&(n.left=e.x,i.left=`${e.x}px`);if(r<0){const t=e.y+r;r*=-1,n.top=t,i.top=`${t}px`}else n.top!==e.y&&(n.top=e.y,i.top=`${e.y}px`);n.right=n.left+o,n.bottom=n.top+r,i.width=`${o}px`,i.height=`${r}px`}(pn,fn,bn,gn.style),function(t,e,n){for(let i=0;i<t.length;i++){const o=t[i],r=o.ref.classList;e.right>o.left&&e.left<o.right&&e.bottom>o.top&&e.top<o.bottom?(n&&!o.selected&&r.contains("selected")&&(r.remove("selected"),o.removed=!0),o.removed||(r.add("selected"),o.selected=!0)):o.selected?(r.remove("selected"),o.selected=!1):o.removed&&(r.add("selected"),o.removed=!1)}}(hn,bn,t),wn=!1})}function Sn(t,e,{scrollHeight:n,height:i}){e.scrollTop+=36,pn.y=e.scrollTop+i,pn.y>=n&&(pn.y=n,Bn()),wn||An(t)}function Mn(t,e){e.scrollTop-=36,pn.y=e.scrollTop,pn.y<=0&&(pn.y=0,Bn()),wn||An(t)}function On(t){const e=yn,n=e.top,i=e.left,o=e.width,r=e.height,a=e.scrollHeight,s=t.clientY-n;if(pn.x=$n(t.clientX-i,o),pn.y=$n(vn.scrollTop+s,a),t.preventDefault(),!gn&&(l=fn,(c=pn).x>l.x+2||c.x<l.x-2||c.y>l.y+2||c.y<l.y-2))return hn=function(){const t=mi(si());return Array.from(t).map(t=>{const e=t.offsetTop,n=t.offsetLeft;return{ref:t,top:e,left:n,right:n+t.offsetWidth,bottom:e+t.offsetHeight}})}(),gn=function(t,e){const n=document.createElement("div");return bn.top=e.y,bn.left=e.x,n.setAttribute("id","js-selected-area"),n.setAttribute("class","selected-area"),n.style.top=`${e.y}px`,n.style.left=`${e.x}px`,t.insertBefore(n,t.firstElementChild),n}(vn,fn),document.activeElement.blur(),t.ctrlKey||xn(),void Tn();var c,l;if(wn||An(t.ctrlKey),En&&s>0&&s<r)Bn();else if(!En){let e=null;if(s>r&&pn.y<a)e=Sn;else{if(!(s<0&&pn.y>0))return;e=Mn}En=setInterval(e,40,t.ctrlKey,vn,yn)}}function Cn({target:t,ctrlKey:e}){if(En&&Bn(),gn){const t=Hn();r(gn),gn=null,bn={},hn.length=0,t.length?jn():Tn()}else{const n=s("data-index",t,vn);n?function(t,e){if(e||xn(),t.classList.toggle("selected"),t.classList.contains("selected"))jn();else{const e=Hn();t.blur(),e.length||Tn()}}(n.elementRef,e):e||In()}window.removeEventListener("mousemove",On),window.removeEventListener("mouseup",Cn)}function _n({target:t}){!s("data-move-to",t)&&c(t,vn)&&In()}function Rn({currentTarget:t,target:e,which:n,clientX:i,clientY:o}){var r;1===n&&(s("data-btn",e)?In():(yn={top:(r=t).offsetTop,left:r.offsetLeft,width:r.clientWidth,height:r.offsetHeight,scrollHeight:r.scrollHeight},fn.x=i-yn.left,fn.y=t.scrollTop+o-yn.top,fn.x<yn.width&&(window.addEventListener("mousemove",On),window.addEventListener("mouseup",Cn))))}function Vn({key:t,keyCode:e}){"Delete"!==t&&127!==e||(!function(){const t=Hn(),e=ci(),n=Pn(t),i=function(t,e){const n=[],i=[];return t.forEach(t=>{e.includes(t.index)?i.push(t):n.push(t)}),{tracksToRemove:i,tracksToKeep:z(n)}}(e.tracks,n),o=i.tracksToKeep,a=i.tracksToRemove;s=t,s.forEach(r),function(t,e,n){const i=Math.min(...n),o=Array.from(mi(t)).slice(i);var r,a;"list"===e?(a=i,o.forEach((t,e)=>{t.setAttribute("data-index",a+e),t.querySelector(".list-item-index").textContent=a+e+1})):(r=i,o.forEach((t,e)=>{t.setAttribute("data-index",r+e)}))}(e.id,e.type,n),B(e.id,{playbackOrder:q(o,b("shuffle")),tracks:o,duration:A(o)}),Ci({action:"remove-tracks",playlist:{_id:e._id,tracks:a}}),function(t,e){const n=H();if(n&&O(t)){const i=P(t,n.name);let o=n.index;e.includes(o)||!i?V({index:-1}):V({index:o=i.index}),U(o)}}(e.id,n),o.length||(Ln(e),Ei(e));var s}(),Tn())}function Hn(){return Array.from(vn.querySelectorAll(".track.selected"))}function Pn(t){return t.map(t=>parseInt(t.getAttribute("data-index"),10))}const Un=document.getElementById("js-filter-input"),qn=Un.parentElement;let Dn=0,zn="";function Nn(t,e,n){t.forEach(t=>{const i=e[t.index],o=new RegExp(n,"gi"),r=`\n            ${t.title}\n            ${t.artist}\n            ${t.album}\n        `;o.test(r)?i.classList.remove("hidden"):i.classList.add("hidden")})}function Wn(t,e=""){const n=T(t).tracks;if(!n.length)return;const i=mi(t);zn=e?t:"",Nn(n,i,e),function(t){const e=document.getElementById("js-clear-input-btn");t?e.classList.add("visible"):e.classList.remove("visible")}(e)}function Fn(){zn&&(Un.value="",Wn(zn))}function Kn(){Un.classList.remove("active"),Un.removeEventListener("keyup",Xn),window.removeEventListener("click",Yn)}function Yn({target:t}){c(t,qn)&&Kn()}function Xn({target:t}){const e=si(),n=t.value.trim().toLowerCase();clearTimeout(Dn),Dn=setTimeout(Wn,400,e,n)}function Jn(t){document.getElementById("js-order-toggle").querySelector(".js-icon").setAttribute("href",`#${1===t?"down":"up"}-arrow`)}function Zn(t,e){return"index"===t?e.primaryIndex:"duration"===t?e.durationInSeconds:e[t].toLowerCase()}function Gn(t,e,n){t.sort((t,i)=>{const o=Zn(e,t),r=Zn(e,i);return o<r?-n:o>r?n:0})}function Qn(t,e){const n=document.getElementById("js-filter-input").value,i=t.sortedBy===e&&1===t.order?-1:1;if(Gn(t.tracks,e,i),B(t.id,{order:i,sortedBy:e,tracks:z(t.tracks)}),Ci({action:"change-sorting",playlist:{order:i,_id:t._id,sortedBy:e}}),Ei(t),Ti(t),n){const e=mi(t.id);Nn(t.tracks,e,n)}}function ti({sortedBy:t,order:e}){var n;n=t,document.getElementById("js-sort-toggle").textContent=o(n),Jn(e)}function ei(t,e){var n;return`<ul id="${t}" class="panel sort-panel">${n=e,["index","name","title","artist","album","duration"].reduce((t,e)=>{const i=e===n?" active":"";return t+`\n            <li>\n                <button class="btn sort-option-btn${i}" data-sort="${e}">\n                    ${o(e)}\n                </button>\n            </li>\n        `},"")}</ul>`}function ni(t,{sortedBy:e}){document.getElementById("js-sort-panel-container").insertAdjacentHTML("beforeend",ei(t,e)),document.getElementById(t).addEventListener("click",ii)}function ii({currentTarget:t,target:e}){const n=e.getAttribute("data-sort"),i=ci();t.removeEventListener("click",ii),K(),n!==i.sortedBy&&(ti({sortedBy:n,order:1}),Qn(i,n))}Un.addEventListener("focus",({currentTarget:t})=>{t.classList.add("active"),t.addEventListener("keyup",Xn),window.addEventListener("click",Yn)}),qn.addEventListener("click",({target:t})=>{const e=s("data-filter-item",t);if(!e)return;const n=e.attrValue;"icon"===n?Un.focus():"button"===n&&(Fn(),Kn())});const oi=document.getElementById("js-tab-header"),ri=document.getElementById("js-playlist-tab-header");let ai="";function si(){return ai}function ci(){return T(si())}function li(t){return document.getElementById(`js-tab-${t}`)}function ui(t){const e=T(t);e.rendered||function(t){const e=function(t){const e=bi(t);return`<div id="js-tab-${t.id}" class="tab playlist-tab">${e}</div>`}(t),n=document.getElementById("js-tab-playlist-container");t.rendered=!0,n.insertAdjacentHTML("beforeend",e),hi(t.id)}(e),"list"===e.type&&window.innerWidth<=540?xi("grid",e):Li(e.type),ti(e),Ln(e),Fn()}var di;function mi(t){return document.getElementById(`js-${t}`).children}function fi(t,e){return mi(t)[e]}function pi(t){const e=T(t.playlistId);if(-1!==t.index&&e.rendered)return fi(t.playlistId,t.index).querySelector(".btn")}function vi(t){return`\n        <li class="list-item track" data-index="${t.index}" tabindex="0">\n            <span class="list-item-first-col">\n                <span class="list-item-index">${t.index+1}</span>\n                <button class="btn btn-icon track-play-pause-btn list-item-play-pause-btn" data-btn="play" title="Play">\n                    <svg viewBox="0 0 24 24">\n                        <use class="js-icon" href="#play"></use>\n                    </svg>\n                </button>\n            </span>\n            <span class="list-item-col">${t.title}</span>\n            <span class="list-item-col">${t.artist}</span>\n            <span class="list-item-col">${t.album}</span>\n            <span class="list-item-col">${t.duration}</span>\n        </li>\n    `}function yi(t){const e=d(t.thumbnail);let n=`<div class="grid-item-title">${t.title}</div>`;return t.artist&&(n+=`\n            <div class="grid-item-artist">${t.artist} ${t.album?`- ${t.album}`:""}</div>\n        `),`\n        <li class="grid-item track" data-index="${t.index}" tabindex="0">\n            <div class="grid-item-first-col" tabindex="-1">\n                <img src="${e}" class="artwork grid-item-thumbnail" alt="">\n                <button class="btn btn-icon track-play-pause-btn grid-item-play-pause-btn" data-btn="play" title="Play">\n                    <svg viewBox="0 0 24 24">\n                        <use class="js-icon" href="#play"></use>\n                    </svg>\n                </button>\n            </div>\n            <div class="grid-item-name">${n}</div>\n            <div class="grid-item-duration">${t.duration}</div>\n        </li>\n    `}function gi(t,e){return t.map(e).join("")}function bi(t){return t.tracks.length?function({id:t,type:e,tracks:n}){return"list"===e?(i=t,o=gi(n,vi),`\n        <ul class="list-view-header">\n            <li class="list-item-first-col">#</li>\n            <li class="list-item-col">Title</li>\n            <li class="list-item-col">Artist</li>\n            <li class="list-item-col">Album</li>\n            <li class="list-item-col">Duration</li>\n        </ul>\n        <ul id="js-${i}" class="playlist-view list-view">${o}</ul>\n    `):(r=t,a=gi(n,yi),`<ul id="js-${r}" class="playlist-view grid-view">${a}</ul>`);var i,o,r,a}(t):'<p class="playlist-message">This playlist is empty</p>'}function hi(t){const e=H();e&&e.playlistId===t&&-1!==e.index&&requestAnimationFrame(()=>{wi(t,e.index,{scrollToTrack:!0}),ki(e,se())})}function Ei(t){li(t.id).innerHTML=bi(t),hi(t.id)}function wi(t,e,{scrollToTrack:n}={}){const i=fi(t,e);a(".track.playing","playing"),i.classList.add("playing"),n&&function(t,e){const n=document.getElementById(`js-tab-${e}`),i=t.offsetHeight,o=t.offsetTop,r=n.scrollTop,a=n.clientHeight;(o-i<r||o>r+a)&&(n.scrollTop=o-a/2)}(i,t)}function ki(t,e){const n=pi(t);n&&ct(n,e)}function Li(t){const e=document.getElementById("js-list-toggle-btn"),n=document.getElementById("js-grid-toggle-btn");"list"===t?(e.classList.add("active"),n.classList.remove("active")):(n.classList.add("active"),e.classList.remove("active"))}function xi(t,e){B(e.id,{type:t}),Ci({action:"change-type",playlist:{_id:e._id,type:t}}),Ei(e),Ln(e),Li(t)}function Ii(t){D(t,b("shuffle")),Gn(t.tracks,t.sortedBy,t.order),t.tracks=z(t.tracks)}function ji(t){var e,n,i,o;t.initialized=!0,w(e=`playlist/${t.id}`)||E.push(e),n=t.title,i=t.id,document.getElementById("js-sidebar-entries").insertAdjacentHTML("beforeend",`\n        <li id="js-sidebar-entry-${i}" class="sidebar-entry">\n            <a href="./#/playlist/${i}" class="sidebar-link" data-link>${n}</a>\n        </li>\n    `),o=t,Ke().insertAdjacentHTML("beforeend",`\n        <li class="pl-entry" data-entry-id=${o.id}>\n            <div class="pl-entry-input-container" data-action="edit">\n                <input type="text" class="input pl-entry-input" value="${o.title}">\n                <svg viewBox="0 0 24 24" class="pl-entry-input-icon">\n                    <use href="#edit">\n                </svg>\n            </div>\n            <div class="pl-entry-content">\n                <div class="pl-entry-stats">\n                    ${o.isPrivate?'\n        <svg viewBox="0 0 24 24" class="pl-entry-stats-item">\n            <use href="#lock"></use>\n        </svg>\n    ':""}\n                    <span class="pl-entry-stats-item track-count">${o.tracks.length} tracks</span>\n                    <span class="pl-entry-stats-item playlist-duration">${Ge(o.duration)}</span>\n                </div>\n                ${o.url?'\n        <button class="btn btn-icon pl-entry-btn" data-action="sync" title="Synchronize playlist">\n            <svg viewBox="0 0 24 24">\n                <use href="#sync">\n            </svg>\n        </button>\n    ':""}\n                ${o.url?'\n        <button class="btn btn-icon pl-entry-btn" data-action="settings" title="Settings">\n            <svg viewBox="0 0 24 24">\n                <use href="#settings">\n            </svg>\n        </button>\n    ':""}\n                <button class="btn btn-icon pl-entry-btn" data-action="remove" title="Remove playlist">\n                    <svg viewBox="0 0 24 24">\n                        <use href="#trash">\n                    </svg>\n                </button>\n            </div>\n        </li>\n    `),Ii(t)}function Ti(t){const e=H();if(e&&O(t.id)){const n=P(t.id,e.name);let i=-1;n?i=n.index:a(".track.playing","playing"),V({index:i}),U(i)}}function $i(t,e,n){e.length&&(e=function(t,e=0){return t.map((t,n)=>(t.primaryIndex=e+n,t))}(e,t.lastTrackIndex),t.lastTrackIndex=e[e.length-1].primaryIndex+1,t.tracks=t.tracks.concat(e),t.duration=A(t.tracks)),t.initialized?(Mi(t.id),Ii(t),Ti(t),t.rendered&&Ei(t),Ci({action:"add-tracks",playlist:{_id:t._id,tracks:e}})):(ji(t),Ci({action:"add",playlist:t})),n&&k(`playlist/${t.id}`),Ze()}function Bi(t){const e=$({title:t.target.title.value,id:Math.random().toString(36).slice(2),type:"grid"});ji(e),Ci({action:"add",playlist:e}),t.preventDefault(),t.target.reset()}function Ai(t,e,n,i){e.insertAdjacentHTML(n,`\n        <form id="js-${t}-form" class="${t}-form">\n            <input type="text" name="title" class="input" autocomplete="off" placeholder="Playlist title" required>\n            <button class="btn">Create</button>\n        </form>\n    `);const o=document.getElementById(`js-${t}-form`);o.elements.title.focus(),o.addEventListener("submit",i)}function Si(t){f(N(t),`js-${t}-sidebar-spinner`,"sidebar-entry-spinner"),Je(t)}function Mi(t){const e=document.getElementById(`js-${t}-sidebar-spinner`);e&&r(e),Xe(t)}oi.addEventListener("click",({currentTarget:t,target:e})=>{const n=s("data-item",e,t);n&&"sidebar-toggle"===n.attrValue&&document.getElementById("js-sidebar-container").classList.remove("hidden")}),ri.addEventListener("click",({currentTarget:t,target:e})=>{const n=s("data-item",e,t);if(!n)return;const i=ci(),o=n.attrValue;"move-to"===o?X("js-move-to-panel",mn,{playlistId:i.id,element:n.elementRef}):"list"!==o&&"grid"!==o||o===i.type?"sorting"===o?X("js-sort-panel",ni,{sortedBy:i.sortedBy,element:n.elementRef}):"order"===o&&i.sortedBy&&(Qn(di=i,di.sortedBy),Jn(di.order)):xi(o,i)}),window.addEventListener("route-change",({detail:{isPlaylistTab:t,tabId:e}})=>{const n=document.getElementById("js-tab-container"),i=document.getElementById("js-tab-playlist-container");a(".sidebar-entry.active","active"),a(".tab.active","active"),function(t=""){ai=t}(t?e:""),t?(ui(e),i.classList.add("active"),n.classList.remove("active")):(Ze(),n.classList.add("active"),i.classList.remove("active")),li(e).classList.add("active"),N(e).classList.add("active")}),window.addEventListener("resize",({target:t})=>{const e=ci();e&&"list"===e.type&&t.innerWidth<=540&&xi("grid",e)});const Oi=new Worker("./ww.js");function Ci(t){Oi.postMessage(t)}Oi.onmessage=function({data:{action:t,payload:e}}){"init"===t?(e.forEach(t=>{ji($(t))}),en(e.filter(t=>t.syncOnInit)),document.getElementById("js-player").insertAdjacentHTML("afterbegin",'\n        <div id="js-media-container" class="media-container">\n            <div class="media-btn-container">\n                <a id="js-yt-player-watch" class="btn btn-icon hidden" data-item="yt-watch" title="Watch on YouTube" target="_blank">\n                    <svg viewBox="0 0 24 24">\n                        <use href="#youtube"></use>\n                    </svg>\n                </a>\n                <button class="btn btn-icon" data-item="close" title="Close">\n                    <svg viewBox="0 0 24 24">\n                        <use href="#close"></use>\n                    </svg>\n                </button>\n            </div>\n            <div id="js-yt-player" class="yt-player hidden"></div>\n            <img src="" id="js-media-image" class="media-image hidden" data-item="image" alt="">\n        </div>\n    '),document.getElementById("js-media-container").addEventListener("click",Xt),L(window.location.hash.slice(2)),ae.initTrack()):"update"===t&&B(e.id,e)},Oi.onerror=function(t){console.log(t)}},function(t,e,n){(function(){"use strict";!function(t){var e;function n(){e||(e=!0,t())}"complete"===document.readyState?t():(e=!1,document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1))}(function(){var t,e=!0,n={text:!0,search:!0,url:!0,tel:!0,email:!0,password:!0,number:!0,date:!0,month:!0,week:!0,time:!0,datetime:!0,"datetime-local":!0};function i(t){t.classList.contains("focus-ring")||(t.classList.add("focus-ring"),t.setAttribute("data-focus-ring-added",""))}function o(){document.addEventListener("mousemove",r),document.addEventListener("mousedown",r),document.addEventListener("mouseup",r),document.addEventListener("pointermove",r),document.addEventListener("pointerdown",r),document.addEventListener("pointerup",r),document.addEventListener("touchmove",r),document.addEventListener("touchstart",r),document.addEventListener("touchend",r)}function r(t){"html"!==t.target.nodeName.toLowerCase()&&(e=!1,document.removeEventListener("mousemove",r),document.removeEventListener("mousedown",r),document.removeEventListener("mouseup",r),document.removeEventListener("pointermove",r),document.removeEventListener("pointerdown",r),document.removeEventListener("pointerup",r),document.removeEventListener("touchmove",r),document.removeEventListener("touchstart",r),document.removeEventListener("touchend",r))}document.addEventListener("keydown",function(t){t.altKey||t.ctrlKey||t.metaKey||-1!==[9,37,38,39,40].indexOf(t.keyCode)&&(e=!0)},!0),document.addEventListener("focus",function(t){var o,r,a;t.target!=document&&(e||(o=t.target,r=o.type,"INPUT"==(a=o.tagName)&&n[r]&&!o.readonly||"TEXTAREA"==a&&!o.readonly||"true"==o.contentEditable))&&(i(t.target),e=!1)},!0),document.addEventListener("blur",function(t){var e;t.target!=document&&(e=t.target).hasAttribute("data-focus-ring-added")&&(e.classList.remove("focus-ring"),e.removeAttribute("data-focus-ring-added"))},!0),window.addEventListener("focus",function(){document.activeElement&&(document.activeElement==t&&i(t),t=null)},!0),window.addEventListener("blur",function(n){n.target===window&&document.activeElement&&(e=!0,o(),document.activeElement.classList.contains("focus-ring")&&(t=document.activeElement))},!0),o(),document.body.classList.add("js-focus-ring")})})()},function(t,e){},function(t,e,n){var i=n(1);t.exports=function(t){if(!i(t))throw TypeError(t+" is not an object!");return t}},function(t,e,n){t.exports=!n(2)&&!n(4)(function(){return 7!=Object.defineProperty(n(16)("div"),"a",{get:function(){return 7}}).a})},function(t,e,n){var i=n(1),o=n(3).document,r=i(o)&&i(o.createElement);t.exports=function(t){return r?o.createElement(t):{}}},function(t,e,n){var i=n(1);t.exports=function(t,e){if(!i(t))return t;var n,o;if(e&&"function"==typeof(n=t.toString)&&!i(o=n.call(t)))return o;if("function"==typeof(n=t.valueOf)&&!i(o=n.call(t)))return o;if(!e&&"function"==typeof(n=t.toString)&&!i(o=n.call(t)))return o;throw TypeError("Can't convert object to primitive value")}},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e,n){var i=n(3),o=n(6),r=n(20),a=n(8)("src"),s="toString",c=Function[s],l=(""+c).split(s);n(21).inspectSource=function(t){return c.call(t)},(t.exports=function(t,e,n,s){var c="function"==typeof n;c&&(r(n,"name")||o(n,"name",e)),t[e]!==n&&(c&&(r(n,a)||o(n,a,t[e]?""+t[e]:l.join(String(e)))),t===i?t[e]=n:s?t[e]?t[e]=n:o(t,e,n):(delete t[e],o(t,e,n)))})(Function.prototype,s,function(){return"function"==typeof this&&this[a]||c.call(this)})},function(t,e){var n={}.hasOwnProperty;t.exports=function(t,e){return n.call(t,e)}},function(t,e){var n=t.exports={version:"2.5.3"};"number"==typeof __e&&(__e=n)},function(t,e){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,e,n){var i=n(3),o="__core-js_shared__",r=i[o]||(i[o]={});t.exports=function(t){return r[t]||(r[t]={})}},function(t,e,n){var i=n(1),o=n(25),r=n(9)("match");t.exports=function(t){var e;return i(t)&&(void 0!==(e=t[r])?!!e:"RegExp"==o(t))}},function(t,e){var n={}.toString;t.exports=function(t){return n.call(t).slice(8,-1)}},function(t,e,n){n(5)("match",1,function(t,e,n){return[function(n){"use strict";var i=t(this),o=void 0==n?void 0:n[e];return void 0!==o?o.call(n,i):new RegExp(n)[e](String(i))},n]})}]);