!function(t){function e(e){for(var i,s,r=e[0],l=e[1],c=e[2],u=0,m=[];u<r.length;u++)s=r[u],Object.prototype.hasOwnProperty.call(o,s)&&o[s]&&m.push(o[s][0]),o[s]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(t[i]=l[i]);for(d&&d(e);m.length;)m.shift()();return a.push.apply(a,c||[]),n()}function n(){for(var t,e=0;e<a.length;e++){for(var n=a[e],i=!0,r=1;r<n.length;r++){var l=n[r];0!==o[l]&&(i=!1)}i&&(a.splice(e--,1),t=s(s.s=n[0]))}return t}var i={},o={0:0},a=[];function s(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=i,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)s.d(n,i,function(e){return t[e]}.bind(null,i));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="";var r=window.webpackJsonp=window.webpackJsonp||[],l=r.push.bind(r);r.push=e,r=r.slice();for(var c=0;c<r.length;c++)e(r[c]);var d=l;a.push([120,1]),n()}({120:function(t,e,n){"use strict";n.r(e);n(67),n(68),n(69),n(70),n(4);const i=function(){const t=[];return{load:function(e){return t.includes(e.src)?Promise.resolve():new Promise(n=>{const i=document.createElement("script");Object.keys(e).forEach(t=>{i.setAttribute(t,e[t])}),document.getElementsByTagName("body")[0].appendChild(i),t.push(e.src),i.onload=n})}}}();function o(t,e){const n=document.querySelector(t);n&&n.classList.remove(e)}function a(t,e,n=null){for(;e&&e!==n;){if(e.hasAttribute(t))return{elementRef:e,attrValue:e.getAttribute(t)};e=e.parentElement}}function s(t,e){return!!e&&!e.contains(t)}function r(t,e=!0){return e&&t<10?`0${t}`:t}function l(t,e=!1){const n=function(t){return Math.floor(t/3600)}(t),i=function(t){return Math.floor(t/60%60)}(t),o=function(t){return t%60}(t);return`${(e=e||n)?`${n}:`:""}${r(i,e)}:${r(o)}`}function c(t,e){const n=new CustomEvent(t,{detail:e});window.dispatchEvent(n)}function d(t,{id:e,title:n}){"svg"===t.nodeName?t.querySelector("title").textContent=n:t.setAttribute("title",n),t.querySelector("use").setAttribute("href",`#${e}`)}function u(t){let e=t.length;for(;e;){const n=Math.floor(Math.random()*e);e-=1,[t[e],t[n]]=[t[n],t[e]]}return t}function m(t){return`\n  <svg viewBox="0 0 24 24" ${t.elementId?`id=${t.elementId}`:""} ${t.className?`class="${t.className}"`:""}>\n  ${t.title?`<title>${t.title}</title>`:""}\n  <use href="#${t.iconId}"></use>\n  </svg>\n  `}const f=Object.assign({playback:"normal",shuffle:!1,mute:!1,volume:.4},JSON.parse(localStorage.getItem("settings"))||{});function p(t,e){f[t]=e,g(f)}function y(t){return f[t]}function v(t){delete f[t],g(f)}function g(t){localStorage.setItem("settings",JSON.stringify(t))}n(84);let b=[];function h(t){return b.some(e=>e===t)}function k(t){window.location.hash=`/${t}`}function w(){const t=window.location.hash.slice(2).replace(/\/+$/g,"");let e=!1,n="home";t&&!h(t)?n="not-found":(e=t.startsWith("playlist/"),n=e?t.split("playlist/")[1]:n),c("route-change",{tabId:n,isPlaylistTab:e})}window.addEventListener("hashchange",w);const E={},I={};let L="",$=null,j=-1,x=[];function T(){return Object.keys(E).map(B)}function B(t){return E[t]}function A(t){return I[t.id]={shuffled:!1,sortOrder:[]},E[t.id]={sortedBy:"index",order:1,tracks:[],...t},E[t.id]}function S(t){return I[t]}function M(t,e){Object.assign(I[t],e)}function O(t){return t.reduce((t,e)=>t+=e.durationInSeconds,0)}function P(t=""){L=t}function H(){return L}function R(t){return t===L}function C(t){$=t}function V(){return $}function q(t){const e=V();if(e&&R(t)){const n=D(t,e.name),i=n?n.index:-1;e.index=i,U(i,t)}}function D(t,e){const n=E[t];return n?n.tracks.find(t=>t.name===e):null}function U(t,e){const{sortOrder:n}=I[e],i=n.indexOf(t);j=x.indexOf(i),j=j<0?0:j}function N(){return x}function W(t){for(let e=0;e<x.length;e++)if(x[e]===t){[x[0],x[e]]=[t,x[0]];break}}function _(t,e,n=-1){const i=V(),{tracks:o}=E[t],a=o.map(({index:t})=>t);I[t].shuffled=e,x=e?u(a):a,e&&n>=0&&W(n),i&&U(i.index,t)}function K(t,e){const n=function(t){let e=j;return e+=t,!t||e>=x.length?e=0:-1===e&&(e=x.length-1),x[e]}(e),{tracks:i}=E[t],{sortOrder:o}=I[t];return i[o[n]]}function z(t){t.tracks=t.tracks.map((t,e)=>(t.index=e,t))}function Y(t,e){return"index"===t?e.index:"duration"===t?e.durationInSeconds:e[t].toLowerCase()}function F(t){var e,n,i;I[t.id].sortOrder=(e=t.tracks,n=t.sortedBy,i=t.order,[...e].sort((t,e)=>{const o=Y(n,t),a=Y(n,e);return o<a?-i:o>a?i:0}).map(({index:t})=>t))}let X=null;function J(){window.removeEventListener("click",Q,!0),X.element.remove(),X=null}function G(t,e,n={}){e(t,n),X={id:t,element:document.getElementById(t),removeOnClick:n.removeOnClick,initiator:n.element},window.addEventListener("click",Q,!0)}function Z(t,e,n){if(X){const i=X.id;J(),i!==t&&G(t,e,n)}else G(t,e,n)}function Q({target:t}){if(X.removeOnClick)return void J();const{element:e,initiator:n}=X,i=s(t,e),o=!!n&&s(t,n);i&&o&&J()}const tt=document.getElementById("js-sidebar-container");function et(t){return document.getElementById(`js-sidebar-entry-${t}`)}function nt(){const t=document.getElementById("js-active-playlist-icon");t&&t.remove()}function it(t,{element:e}){e.insertAdjacentHTML("afterend",`\n    <form id="${t}" class="panel sidebar-form">\n      <h3 class="panel-title">Create Playlist</h3>\n      <div class="sidebar-form-input-container">\n        <input type="text" name="title" class="input sidebar-form-input"\n          autocomplete="off" placeholder="Title" required>\n        <button class="btn">Create</button>\n      </div>\n    </form>\n  `);const n=document.getElementById(t);n.elements.title.focus(),n.addEventListener("submit",ot)}function ot(t){Mo(t),J()}tt.addEventListener("click",({currentTarget:t,target:e})=>{if(a("data-link",e,t)||s(e,t.firstElementChild))return void t.classList.add("hidden");const n=a("data-btn",e,t);n&&Z("js-sidebar-form-panel",it,{element:n.elementRef})}),tt.addEventListener("keyup",({currentTarget:t,target:e,key:n})=>{const i=a("data-link",e,t);i&&" "===n&&i.elementRef.click()}),window.addEventListener("connectivity-status",({detail:t})=>{document.getElementById("js-online-status").classList.toggle("visible",!t)});const at=document.getElementById("js-google-sign-in");let st=null,rt=!1,lt=!1,ct=!1;async function dt(){try{if(!lt)return void await ut(!0);const t=gapi.auth2.getAuthInstance();t.isSignedIn.get()?(await t.signOut(),rt=!1,st=null,document.getElementById("js-google-panel-toggle-btn").remove(),at.insertAdjacentHTML("beforeend",'\n    <button id="js-google-sign-in-btn" class="btn btn-text"\n      data-item="google-sign-in" data-disable>Sign In</button>\n  '),J(),c("google-sign-out")):(await t.signIn(),mt(t.currentUser.get()))}catch(t){console.log(t)}}async function ut(t=!1){if(lt||ct)return rt;ct=!0;try{await i.load({src:"https://apis.google.com/js/api.js"}),await new Promise(t=>gapi.load("client:auth2",t)),await gapi.client.init({apiKey:"AIzaSyD33Rxm4dA34Mh84oSxYTUUF_jyCLLOua4",clientId:"293076144560-r5cear7rprgo094u6ibcd6nl3bbg18te.apps.googleusercontent.com",discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest"],scope:"https://www.googleapis.com/auth/youtube.force-ssl"});const e=gapi.auth2.getAuthInstance();return e.isSignedIn.get()?mt(e.currentUser.get()):t&&(await e.signIn(),mt(e.currentUser.get())),lt=!0,rt}catch(t){console.log(t)}finally{ct=!1}}function mt(t){const e=document.getElementById("js-google-sign-in-btn");rt=!0,function(t){const e=t.getBasicProfile();st={name:e.getName(),email:e.getEmail(),image:e.getImageUrl()}}(t),e.remove(),at.insertAdjacentHTML("afterbegin",`\n    <button id="js-google-panel-toggle-btn" class="btn btn-icon google-panel-toggle-btn"\n    data-disable>\n      <img src="${st.image}" class="google-user-image" alt="">\n    </button>\n  `),document.getElementById("js-google-panel-toggle-btn").addEventListener("click",pt)}function ft(t,{element:e}){e.insertAdjacentHTML("afterend",`\n    <div id=${t} class="panel google-panel">\n      <div class="google-user">\n        <img src="${st.image}" class="google-user-image" alt="">\n        <div class="google-user-details">\n          <div class="google-user-name">${st.name}</div>\n          <div>${st.email}</div>\n        </div>\n      </div>\n      <button class="btn btn-text google-sign-out-btn"\n      data-item="google-sign-in">Sign Out</button>\n    </div>\n  `)}function pt({currentTarget:t}){Z("js-google-panel",ft,{element:t})}n(91),n(32);const yt={};function vt(){return yt}function gt(t,e){e.id=t,yt[t]=e}function bt(t){if(t){const e=yt[t];return e.url||(e.url=URL.createObjectURL(e.file)),e}return{url:"assets/images/album-art-placeholder.png"}}async function ht(t){const e=await crypto.subtle.digest("SHA-256",t);return[...new Uint8Array(e)].map(t=>t.toString(16).padStart(2,"0")).join("")}function kt(){return document.getElementById("js-player-messages")||function(){const t=document.createElement("div");return t.id="js-player-messages",t.classList.add("player-messages"),document.getElementById("js-player").appendChild(t),t}()}function wt(){const t=kt();if(t){const e=[...t.children].reverse();for(const n of e)if(!n.id){n.remove(),e.length-1==0&&t.remove();break}}}function Et({title:t,body:e,id:n}){kt().insertAdjacentHTML("afterBegin",`\n    <div ${n?`id=${n} `:""}class="player-message">\n      ${t?`<h3 class="player-message-title">${t}</h3>`:""}\n      <div class="player-message-body">${e}</div>\n    </div>\n  `),n||setTimeout(wt,6e3)}function It(){location.reload()}function Lt(){c("connectivity-status",navigator.onLine)}window.addEventListener("sw-state-change",({detail:t})=>{"update"===t&&(kt().insertAdjacentHTML("afterBegin",'\n    <div class="player-message service-worker-message">\n      <p class="player-message-body">Update is available, please refresh.</p>\n      <button id="js-player-message-btn" class="btn btn-icon player-message-btn">Refresh</button>\n    </div>\n  '),document.getElementById("js-player-message-btn").addEventListener("click",It),setTimeout(wt,6e3))}),window.addEventListener("online",Lt),window.addEventListener("offline",Lt),window.addEventListener("load",Lt);let $t=null;function jt(t){Et({title:"YouTube",body:t})}function xt(t){if(t.includes("H")||(t=`0H${t}`),!t.includes("M")){const e=t.indexOf("H")+1;t=`${t.slice(0,e)}0M${t.slice(e)}`}return t.includes("S")||(t=`${t}0`),t.match(/\d{1,}/g).reverse().reduce((t,e,n)=>t+=e*60**n,0)}function Tt(t,e,n,i,o){const a=function(){const t=gapi.auth2.getAuthInstance();return t.isSignedIn.get()?t.currentUser.get().getAuthResponse().access_token:null}();let s=`part=${e}&${n}=${i}&maxResults=50&key=AIzaSyD33Rxm4dA34Mh84oSxYTUUF_jyCLLOua4`;return o&&(s+=`&pageToken=${o}`),a&&(s+=`&access_token=${a}`),fetch(`https://www.googleapis.com/youtube/v3/${t}?${s}`).then(t=>t.json())}function Bt(t,e){return t.reduce((t,n)=>(e.some(t=>t.id===n.id)||t.push(n),t),[])}function At(t){return t.filter(t=>{const e=t.snippet.title;return"Deleted video"!==e&&"Private video"!==e})}function St(t){return t.map(t=>{const e=t.snippet.resourceId.videoId;return gt(e,{url:t.snippet.thumbnails.medium.url}),{id:e,durationInSeconds:t.durationInSeconds,duration:l(t.durationInSeconds),name:t.snippet.title,title:t.snippet.title,artist:"",album:"",artworkId:e,player:"youtube"}})}async function Mt(t,e){const{error:n,items:i,nextPageToken:o}=await Tt("playlistItems","snippet","playlistId",t,e);n&&function({code:t,message:e}){throw 403===t?e="You need to be sign in if you want to import private playlists":404===t&&(e="Playlist was not found"),jt(e),new Error(e)}(n);const a=St(await async function(t){const e=t.map(t=>t.snippet.resourceId.videoId).join(),n=await Tt("videos","contentDetails","id",e);return t.reduce((t,e)=>{const i=n.items.find(({id:t})=>t===e.snippet.resourceId.videoId);return i&&(e.durationInSeconds=xt(i.contentDetails.duration)-1,t.push(e)),t},[])}(At(i)));if(o){const e=await Mt(t,o);return a.concat(e)}return a}async function Ot(t){const{items:e}=await Tt("playlists","snippet,status","id",t),n="private"===e[0].status.privacyStatus,i={title:e[0].snippet.title,isPrivate:n};return n&&(i.user=st),i}function Pt(t,e){return B(t)||A({id:t,type:"grid",storePlaylist:!0,...e})}async function Ht(t,e){const n=Pt(t,{title:"YouTube"}),{items:i}=await Tt("videos","snippet,contentDetails","id",e);if(i.length){So(n,Bt(St(At(i).map(t=>(t.snippet.resourceId={videoId:t.id},t.durationInSeconds=xt(t.contentDetails.duration)-1,t))),n.tracks))}else jt("Video was not found")}async function Rt(t,e,n){const i=Pt(e,{url:t}),o=await Mt(e);"sync"===n&&function({id:t,tracks:e}){const{rendered:n}=S(t),i=uo(t);n&&i&&(i.innerHTML="");e.length=0}(i),i.title||function(t,e){Object.assign(E[t],e)}(i.id,await Ot(e)),So(i,Bt(o,i.tracks),{type:"sync"})}async function Ct(t,e){const{videoId:n,playlistId:i}=function(t){let e="",n="";try{const{searchParams:i}=new URL(t);e=i.get("v"),n=i.get("list")}catch(i){const o=t.match(/v=[a-zA-Z0-9\-_]+/),a=t.match(/list=[a-zA-Z0-9\-_]+/);o&&(e=o[0].slice(2)),a&&(n=a[0].slice(5))}return{videoId:e,playlistId:n}}(t),o=i||"youtube";if(n||i)if("WL"!==i){c("import",{importing:!0,option:"youtube",playlistId:o});try{n?await Ht(o,n):await Rt(t,o,e)}catch(t){console.log(t)}finally{c("import",{importing:!1,option:"youtube",playlistId:o})}}else jt("Importing <b>Watch Later</b> playlist is not allowed");else jt("Invalid url")}window.addEventListener("google-sign-out",()=>{$t=null});let Vt=null;function qt(){const t="js-pl-entries";return document.getElementById(t)||function(t){document.getElementById("js-tab-home").insertAdjacentHTML("beforeend",`\n    <div class="home-tab-section pl-entry-container">\n      <div class="home-tab-section-header">\n        <h2 class="home-tab-section-title">Playlists</h2>\n      </div>\n      <ul id="${t}"></ul>\n    </div>\n  `);const e=document.getElementById(t);return e.addEventListener("click",te),e.addEventListener("focus",ee,!0),e}(t)}function Dt({action:t,title:e,iconId:n,disabled:i}){return`\n    <button class="btn btn-icon pl-entry-btn" data-action="${t}"\n    title="${e}"${i?" disabled":""}>\n      ${m({iconId:n})}\n    </button>\n  `}function Ut(t){let e=Math.floor(t/3600),n=Math.ceil(t/60%60);return 60===n&&(n=0,e+=1),`${e} hr ${n} min`}function Nt(t){const e=function(t){const e="assets/images/album-art-placeholder.png";if(!t.length)return[e];const n=t.reduce((t,e)=>(e.artworkId&&t.push(e),t),[]);if(!n.length)return[e];const i=[];for(const t of u(n)){if(4===i.length)break;i.includes(t.artworkId)||i.push(t.artworkId)}return i.map(t=>bt(t).url)}(t);return`\n    <div class="pl-entry-thumbnail _${e.length}">\n      ${e.map(t=>`\n        <div class="pl-entry-thumb-image-container">\n          <img src="${t}" class="pl-entry-thumb-image" alt="">\n        </div>\n      `).join("")}\n    </div>\n  `}function Wt(t,e){const n=O(e);t.querySelector(".track-count").textContent=`${e.length} tracks`,t.querySelector(".playlist-duration").textContent=Ut(n)}function _t(t,e){t.querySelector(".pl-entry-thumbnail").remove(),t.insertAdjacentHTML("afterbegin",Nt(e))}function Kt(t,e,n=!0){const{children:i}=document.getElementById("js-pl-entries");for(const o of i)if(t===o.getAttribute("data-entry-id")){Wt(o,e),n&&_t(o,e);break}}function zt(t,{element:e,pl:n}){e.insertAdjacentHTML("afterend",`\n    <div id="${t}" class="panel pl-entry-panel">\n      <h3 class="panel-title">Playlist settings</h3>\n      <label class="checkbox-container">\n        <input type="checkbox" class="sr-only checkbox-input" ${n.syncOnInit?"checked":""}>\n        <div class="checkbox">\n          <div class="checkbox-tick"></div>\n        </div>\n        <span class="checkbox-label">Synchronize playlist on startup</span>\n      </label>\n    </div>\n  `),document.getElementById(t).addEventListener("change",ne)}function Yt(t){const{parentElement:e}=t;1===e.children.length?function(t){t.removeEventListener("click",te),t.removeEventListener("focus",ee,!0),t.parentElement.remove()}(e):t.remove()}async function Ft(t){t.length&&(t.forEach(({id:t})=>{c("import",{importing:!0,option:"youtube",playlistId:t})}),await ut(),t.forEach(({url:t})=>{Ct(t,"sync")}))}function Xt({currentTarget:t}){const{attrValue:e}=a("data-entry-id",t),n=B(e),i=t.value;var o;(t.removeEventListener("blur",Xt),t.removeEventListener("keyup",Jt),i)?i!==n.title&&(n.title=i,o=i,et(e).querySelector(".sidebar-link").textContent=o,n.storePlaylist&&Po({action:"change-title",playlist:{id:n.id,title:i}})):t.value=n.title}function Jt({currentTarget:t,which:e}){13===e&&t.blur()}function Gt(t){document.getElementById("js-player").insertAdjacentHTML("beforeend",`\n    <div id="${t}" class="modal">\n      <div class="panel">\n        <div class="panel-title-container">\n          ${m({iconId:"trash",className:"panel-icon"})}\n          <h3 class="panel-title">Remove playlist?</h3>\n        </div>\n        <p>Are you sure you want to remove this playlist?<br>If you remove this playlist all your tracks will be lost.</p>\n        <div class="panel-button-container">\n          <button class="btn btn-danger" data-type="remove">Remove</button>\n          <button class="btn btn-text" data-type="cancel">Cancel</button>\n        </div>\n      </div>\n    </div>\n  `),document.getElementById(t).addEventListener("click",Qt)}function Zt(t){document.getElementById("js-player").insertAdjacentHTML("beforeend",`\n    <div id="${t}" class="modal">\n      <div class="panel">\n        <div class="panel-title-container">\n          ${m({iconId:"sync",className:"panel-icon"})}\n          <h3 class="panel-title">Syncronize playlist?</h3>\n        </div>\n        <p>Are you sure you want to synchronize this playlist with the playlist on YouTube? If you choose to synchronize you will lose all previously imported tracks.</p>\n        <div class="panel-button-container">\n          <button class="btn btn-danger" data-type="sync">Synchronize</button>\n          <button class="btn btn-text" data-type="cancel">Cancel</button>\n        </div>\n      </div>\n    </div>\n  `),document.getElementById(t).addEventListener("click",Qt)}function Qt({target:t,currentTarget:e}){if(t===e)return J(),void(Vt=null);const n=a("data-type",t);n&&("remove"===n.attrValue?(Ao(Vt.playlist),Yt(Vt.entryElement)):"sync"===n.attrValue&&Ft([Vt.playlist]),J(),Vt=null)}function te({target:t}){const e=a("data-entry-id",t),n=a("data-action",t);if(!e||!n||n.elementRef.disabled)return;const{attrValue:i,elementRef:o}=n,s=B(e.attrValue);"remove"===i?s.tracks.length?(Vt={playlist:s,entryElement:e.elementRef},Z("js-pl-remove-panel",Gt)):(Ao(s),Yt(e.elementRef)):"sync"===i?(Vt={playlist:s},Z("js-pl-sync-panel",Zt)):"settings"===i?Z("js-pl-entry-panel",zt,{element:o,pl:s}):"edit"===i&&o.querySelector(".input").focus()}function ee({target:t}){const e=a("data-action",t);e&&"edit"===e.attrValue&&(t.addEventListener("blur",Xt),t.addEventListener("keyup",Jt))}function ne({target:t}){const{attrValue:e}=a("data-entry-id",t),n=B(e);n.syncOnInit=t.checked,n.storePlaylist&&Po({action:"change-sync",playlist:{id:n.id,syncOnInit:n.syncOnInit}})}function ie({currentTarget:t,target:e}){const n=a("data-panel-item",e,t);if(!n)return;const{attrValue:i,elementRef:o}=n;"btn"===i?(!function(t,e,n,i){e.insertAdjacentHTML(n,`\n  <form id="js-${t}-form" class="${t}-form">\n  <input type="text" name="title" class="input" autocomplete="off" placeholder="Title" required>\n  <button class="btn">Create</button>\n  </form>\n  `);const o=document.getElementById(`js-${t}-form`);o.elements.title.focus(),o.addEventListener("submit",i)}("move-to",o.parentElement,"beforeend",oe),o.remove()):(t.removeEventListener("click",ie),function(t){const e=Re(He()),{tracks:n}=no(),i=B(t),o=n.filter(n=>e.includes(n.index)&&!D(t,n.name)).map(t=>({...t}));So(i,o),k(`playlist/${i.id}`)}(i),J(),Ee())}function oe(t){const e=document.getElementById("js-move-to-list"),n=eo();Mo(t),e?e.innerHTML=ae(n):t.target.insertAdjacentHTML("beforebegin",se(n))}function ae(t){return T().reduce((e,n)=>(n.id!==t&&(e+=`\n      <li data-panel-item="${n.id}">\n      <button class="btn btn-icon move-to-list-item-btn">${n.title}</button>\n      </li>\n      `),e),"")}function se(t){const e=ae(t);return e?`<ul id="js-move-to-list" class="move-to-list">${e}</ul>`:""}function re(t,{playlistId:e}){document.getElementById("js-move-to-panel-container").insertAdjacentHTML("beforeend",`\n    <div id="${t}" class="panel move-to-panel">\n      <h3 class="panel-title move-to-panel-title">Move to</h3>\n      ${se(e)}\n      <button class="btn btn-icon move-to-new-pl-btn" data-panel-item="btn">\n        ${m({iconId:"plus"})}\n        <span>Create new playlist</span>\n      </button>\n    </div>\n  `)}window.addEventListener("connectivity-status",({detail:t})=>{const e=document.getElementById("js-pl-entries");if(e){e.querySelectorAll("[data-action=sync]").forEach(e=>{e.disabled=!t})}});const le={},ce={};let de=null,ue=null,me=null,fe={},pe=[],ye=0,ve=!1,ge=!1,be=-1;function he({id:t,tracks:e}){de&&ke(),e.length&&(be=-1,de=io(t),de.addEventListener("mousedown",Oe))}function ke(){de.removeEventListener("mousedown",Oe),de=null}function we(){He().forEach(t=>{t.classList.remove("selected")})}function Ee(){we(),Le()}function Ie(){ge||(ge=!0,function(){const t="js-move-to-panel-container";document.getElementById("js-playlist-tab-header-items").insertAdjacentHTML("afterbegin",`\n    <div id="${t}" class="playlist-tab-header-item" data-move-to>\n      <button class="btn btn-icon" data-item="move-to" title="Move to">\n        ${m({iconId:"move-to"})}\n      </button>\n    </div>\n  `),document.getElementById(t).addEventListener("click",ie)}(),setTimeout(()=>{window.addEventListener("click",Me,!0)},0),window.addEventListener("keydown",Pe))}function Le(){ge&&(ge=!1,function(){const t=document.getElementById("js-move-to-panel-container");t.removeEventListener("click",ie),t.remove()}(),window.removeEventListener("click",Me,!0),window.removeEventListener("keydown",Pe))}function $e(t,e){return t>e?e:t<0?0:t}function je(){clearInterval(ye),ye=0}function xe(t){ve=!0,requestAnimationFrame(()=>{me&&function(t,e,n,i){let o=t.x-e.x,a=t.y-e.y;if(o<0){const t=e.x+o;o*=-1,n.left=t,i.left=`${t}px`}else n.left!==e.x&&(n.left=e.x,i.left=`${e.x}px`);if(a<0){const t=e.y+a;a*=-1,n.top=t,i.top=`${t}px`}else n.top!==e.y&&(n.top=e.y,i.top=`${e.y}px`);n.right=n.left+o,n.bottom=n.top+a,i.width=`${o}px`,i.height=`${a}px`}(ce,le,fe,me.style),function(t,e,n){for(let i=0;i<t.length;i++){const o=t[i],a=o.ref.classList;e.right>o.left&&e.left<o.right&&e.bottom>o.top&&e.top<o.bottom?(n&&!o.selected&&a.contains("selected")&&(a.remove("selected"),o.removed=!0),o.removed||(a.add("selected"),o.selected=!0)):o.selected?(a.remove("selected"),o.selected=!1):o.removed&&(a.add("selected"),o.removed=!1)}}(pe,fe,t),ve=!1})}function Te(t){const{scrollHeight:e,height:n}=ue;de.scrollTop+=36,ce.y=de.scrollTop+n,ce.y>=e&&(ce.y=e,je()),ve||xe(t)}function Be(t){de.scrollTop-=36,ce.y=de.scrollTop,ce.y<=0&&(ce.y=0,je()),ve||xe(t)}function Ae(t){const{top:e,left:n,width:i,height:o,scrollHeight:a}=ue,s=t.clientY-e;if(ce.x=$e(t.clientX-n,i),ce.y=$e(de.scrollTop+s,a),t.preventDefault(),!me&&function(t,e){return t.x>e.x+2||t.x<e.x-2||t.y>e.y+2||t.y<e.y-2}(ce,le))return pe=function(){const{children:t}=uo(eo());return Array.from(t).map(t=>{const e=t.offsetTop,n=t.offsetLeft;return{ref:t,top:e,left:n,right:n+t.offsetWidth,bottom:e+t.offsetHeight}})}(),me=function(t,{x:e,y:n}){return fe.top=n,fe.left=e,t.insertAdjacentHTML("afterbegin",`\n  <div class="selection-area" style="top: ${n}px; left: ${e}px"></div>\n  `),t.firstElementChild}(de,le),document.activeElement.blur(),t.ctrlKey||we(),void Le();if(ve||xe(t.ctrlKey),ye&&s>0&&s<o)je();else if(!ye){let e=null;if(s>o&&ce.y<a)e=Te;else{if(!(s<0&&ce.y>0))return;e=Be}ye=setInterval(e,40,t.ctrlKey)}}function Se({target:t,ctrlKey:e,shiftKey:n}){if(ye&&je(),me){const t=He();be=-1,me.remove(),me=null,fe={},pe.length=0,t.length?Ie():Le()}else{const i=a("data-index",t,de);if(i){const t=parseInt(i.attrValue,10);n&&-1!==be?be>=0&&be!==t&&function(t,e,n){const{children:i}=uo(eo());t>e&&([t,e]=[e,t]);const o=[...i].slice(t,e+1);n||we();for(const t of o)t.classList.add("selected")}(be,t,e):(be=t,function(t,e){if(e||we(),t.classList.toggle("selected"),t.classList.contains("selected"))Ie();else{const e=He();t.blur(),e.length||Le()}}(i.elementRef,e))}else e||(be=-1,Ee())}window.removeEventListener("mousemove",Ae),window.removeEventListener("mouseup",Se)}function Me({target:t}){!a("data-move-to",t)&&s(t,de)&&Ee()}function Oe({currentTarget:t,target:e,which:n,clientX:i,clientY:o}){var s;1===n&&(a("data-btn",e)?Ee():(ue={top:(s=t).offsetTop,left:s.offsetLeft,width:s.clientWidth,height:s.offsetHeight,scrollHeight:s.scrollHeight},le.x=i-ue.left,le.y=t.scrollTop+o-ue.top,le.x<ue.width&&(window.addEventListener("mousemove",Ae),window.addEventListener("mouseup",Se))))}function Pe({key:t,keyCode:e}){"Delete"!==t&&127!==e||(!function(){const t=He(),e=no(),n=Re(t),{tracksToKeep:i,tracksToRemove:o}=function(t,e){const n=[],i=[];return t.forEach(t=>{e.includes(t.index)?i.push(t):n.push(t)}),{tracksToRemove:i,tracksToKeep:n}}(e.tracks,n);e.tracks=i,be=-1,t.forEach(t=>t.remove()),z(e),F(e),function(t){const{sortOrder:e}=S(t);[...uo(t).children].forEach((t,n)=>{const i=t.querySelector(".list-item-index");i&&(i.textContent=n+1),t.setAttribute("data-index",e[n])})}(e.id),_(e.id,y("shuffle")),q(e.id),Kt(e.id,i),i.length||(ke(),ko(e));e.storePlaylist&&Po({action:"remove-tracks",playlist:{id:e.id,tracks:o}})}(),Le())}function He(){return Array.from(de.querySelectorAll(".track.selected"))}function Re(t){return t.map(t=>parseInt(t.getAttribute("data-index"),10))}window.addEventListener("keydown",t=>{const e=t.shiftKey||t.altKey||t.metaKey,n=eo();if(t.target instanceof HTMLInputElement||e||!n)return;const i=uo(n);if(i&&i.children.length&&t.ctrlKey&&"a"===t.key){t.preventDefault(),Ie();for(const t of i.children)t.classList.add("selected")}});const Ce=document.getElementById("js-filter-input"),Ve=Ce.parentElement;let qe=0,De="";function Ue(t,e,n,i){const o=new RegExp(i,"i"),{sortOrder:a}=S(t);e.forEach(t=>{const e=n[a.indexOf(t.index)],i=`${t.title}\n${t.artist}\n${t.album}`;e.classList.toggle("hidden",!o.test(i))})}function Ne(t,e=""){const{tracks:n}=B(t);if(!n.length)return;const{children:i}=uo(t);var o;De=e?t:"",Ue(t,n,i,e),o=e,document.getElementById("js-clear-input-btn").classList.toggle("visible",o)}function We(){De&&(Ce.value="",Ne(De))}function _e(){Ve.classList.remove("active"),Ce.removeEventListener("keyup",Ke),Ce.removeEventListener("blur",_e)}function Ke({target:t}){const e=eo();clearTimeout(qe),qe=setTimeout(Ne,400,e,t.value)}function ze(t){document.getElementById("js-order-toggle").querySelector("use").setAttribute("href",`#${1===t?"down":"up"}-arrow`)}function Ye(t,e){const{value:n}=document.getElementById("js-filter-input");if(t.order=t.sortedBy===e&&1===t.order?-1:1,t.sortedBy=e,F(t),q(t.id),ko(t),n){const{children:e}=uo(t.id);Ue(t.id,t.tracks,e,n)}t.storePlaylist&&Po({action:"change-sorting",playlist:{order:t.order,id:t.id,sortedBy:e}})}function Fe({sortedBy:t,order:e}){var n;n=t,document.getElementById("js-sort-toggle").textContent=n,ze(e)}function Xe(t,{sortedBy:e}){document.getElementById("js-sort-panel-container").insertAdjacentHTML("beforeend",function(t,e){return`<ul id="${t}" class="panel sort-panel">${function(t){return["index","title","artist","album","duration"].reduce((e,n)=>`\n      ${e}\n      <li>\n        <button class="btn btn-icon sort-option-btn${n===t?" active":""}" data-sort="${n}">\n          ${n}\n        </button>\n      </li>\n    `,"")}(e)}</ul>`}(t,e)),document.getElementById(t).addEventListener("click",Je)}function Je({currentTarget:t,target:e}){const n=e.getAttribute("data-sort"),i=no();t.removeEventListener("click",Je),J(),n!==i.sortedBy&&(Fe({sortedBy:n,order:1}),Ye(i,n))}Ce.addEventListener("focus",({currentTarget:t})=>{Ve.classList.add("active"),t.addEventListener("keyup",Ke),t.addEventListener("blur",_e)}),Ve.addEventListener("click",({target:t})=>{const e=a("data-filter-item",t);if(!e)return;const n=e.attrValue;"icon"===n?Ce.focus():"button"===n&&(We(),_e())});const Ge=document.getElementById("js-volume-slider"),Ze=document.getElementById("js-track-slider"),Qe=document.getElementById("js-player-controls");let tn=!1,en=null,nn=0;const on=function(){let t=0;function e(){clearTimeout(t)}function n(e,i,o){const a=performance.now()-i-o;tn||gn(e,e.currentTime),Hi.updateTrack({currentTime:e.currentTime}),e.currentTime<=e.durationInSeconds?(e.currentTime+=1,o+=1e3,t=setTimeout(n,1e3-a,e,i,o)):c("track-end")}return{stop:e,start:function(t){const i=performance.now();e(),n(t,i,0)}}}();function an(){const t=mo();t&&(en=t,t.classList.add("show-spinner")),document.getElementById("js-play-btn").classList.add("show-spinner")}function sn(){const t=mo();en&&(en.classList.remove("show-spinner"),en=null),t&&t.classList.remove("show-spinner"),document.getElementById("js-play-btn").classList.remove("show-spinner")}function rn(t){return t?{id:"play",title:"Play"}:{id:"pause",title:"Pause"}}function ln(t,e){d(t,rn(e))}function cn(t){const e={on:{id:"volume-off",title:"Unmute"},off:{id:"volume",title:"Mute"}};d(document.getElementById("js-volume-icon"),t?e.on:e.off)}function dn(t,e){const{left:n,width:i}=document.getElementById(`js-${t}-slider`).getBoundingClientRect();let o=(e-n)/i*100;return o<0?o=0:o>100&&(o=100),o}function un(){on.stop(),gn()}function mn(t){p("volume",t),bn(t),function(t){const e=V()||{};"native"===e.player?wi(t):"youtube"===e.player&&Oi(t)}(t)}function fn(t,e){const n=e/2;return t+n+8>window.innerWidth||t-n-8<0}function pn(t,e){return`calc(${t}% - ${e}px)`}function yn(t,e){const n=document.getElementById("js-volume-slider-label");n.textContent=`${Math.floor(t)}%`;const i=n.offsetWidth;fn(e,i)||(n.style.left=pn(t,i/2))}function vn(t,e){document.getElementById(`js-${t}-slider-thumb`).style.left=`${100*e}%`,document.getElementById(`js-${t}-slider-elapsed`).style.transform=`scaleX(${e})`}function gn(t,e=0){let n=1,i="0:00";t&&(n=t.durationInSeconds,i=t.duration);const o=l(e,n>=3600);tn||(document.getElementById("js-track-current").textContent=o),vn("track",e/n),Ze.setAttribute("aria-valuenow",e),Ze.setAttribute("aria-valuetext",`${o} of ${i}`)}function bn(t){const e=Math.floor(100*t);vn("volume",t),Ge.setAttribute("aria-valuenow",e),Ge.setAttribute("aria-valuetext",`${e}% volume`)}function hn(t="0:00",e=0){document.getElementById("js-track-duration").textContent=t,Ze.setAttribute("aria-valuemax",e)}function kn(t,e){const n=dn("track",t);return{percent:n,currentTime:Math.floor(e*n/100)}}function wn(t,e,n){const i=document.getElementById("js-track-slider-label");i.textContent=l(e);const o=i.offsetWidth;fn(n,o)||(i.style.left=pn(t,o/2))}function En({pageX:t}){const e=V(),{percent:n,currentTime:i}=kn(t,e.durationInSeconds);gn(e,i),wn(n,i,t)}function In({pageX:t}){const e=V();if(!e)return;const{percent:n,currentTime:i}=kn(t,e.durationInSeconds);wn(n,i,t)}function Ln({pageX:t}){const e=V();if(tn=!1,e){const{currentTime:n}=kn(t,e.durationInSeconds);gn(e,n),Ji(e.player,n),Hi.updateTrack({currentTime:n})}window.removeEventListener("pointermove",En),window.removeEventListener("pointerup",Ln),Ze.addEventListener("pointermove",In)}function $n({pageX:t}){const e=dn("volume",t),n=e/100;n!==y("volume")&&(yn(e,t),n?(Bn(),mn(n)):An(!0))}function jn({pageX:t}){yn(dn("volume",t),t)}function xn(){window.removeEventListener("pointermove",$n),window.removeEventListener("pointerup",xn),Ge.addEventListener("pointermove",jn)}function Tn(t,e){let n=t.getAttribute("data-mode");const i={normal:{name:"repeat",nextTitle:"Play track once",currentTitle:"Repeat track",iconId:"repeat"},repeat:{name:"track-once",nextTitle:"Play playlist once",currentTitle:"Play track once",iconId:"repeat-once"},"track-once":{name:"playlist-once",nextTitle:"Repeat playlist",currentTitle:"Play playlist once",iconId:"repeat-once"},"playlist-once":{name:"normal",nextTitle:"Repeat track",currentTitle:"Repeat playlist",iconId:"repeat"}};if(e){for(const[t,o]of Object.entries(i))if(e===o.name){n=t;break}}else{const e=document.getElementById("js-control-btn-label");e&&e.remove(),t.parentElement.insertAdjacentHTML("afterbegin",`\n    <div id="js-control-btn-label" class="control-btn-label">${i[n].currentTitle}</div>\n    `),clearTimeout(nn),nn=setTimeout(()=>{document.getElementById("js-control-btn-label").remove()},1e3)}const{name:o,nextTitle:a,iconId:s}=i[n];"normal"===o?t.classList.remove("active"):t.classList.add("active"),t.setAttribute("data-mode",o),t.setAttribute("title",a),t.querySelector("use").setAttribute("href",`#${s}`),p("playback",o)}function Bn(){const t=y("mute");t&&(v("volumeBeforeMute"),p("mute",!t),cn(!t))}function An(t=!y("mute")){!function(t){const e=t?0:y("volumeBeforeMute");t?p("volumeBeforeMute",y("volume")):v("volumeBeforeMute"),mn(e)}(t),p("mute",t),cn(t)}function Sn({attrValue:t,elementRef:e}){switch(t){case"play":Ni();break;case"next":_i();break;case"previous":Ki();break;case"playback":Tn(e);break;case"mute":An();break;case"shuffle":n=e,p("shuffle",!y("shuffle")),n.parentElement.classList.toggle("active")}var n}function Mn(t){let e=y("volume");if(e<1&&"ArrowUp"===t)e||Bn(),e+=.05,e>1&&(e=1);else if(e&&"ArrowDown"===t&&(e-=.05,e<=0))return e=0,void An(!0);mn(e)}function On(t){const e=V();if(!e)return;const n=e.durationInSeconds;let{currentTime:i}=Hi.getTrack();"ArrowRight"===t||"ArrowUp"===t?(i+=5,i>n&&(i=n)):"ArrowLeft"!==t&&"ArrowDown"!==t||(i-=5,i<0&&(i=0)),gn(e,i),Ji(e.player,i),Hi.updateTrack({currentTime:i})}function Pn(t){return function({pageX:e}){const n=document.getElementById(`js-${t}-slider-label`),i=window.innerWidth,o=n.offsetWidth/2;if(e+o+8>i){const e=dn(t,i-o-8);n.style.left=pn(e,o)}else if(e-o-8<0){const e=dn(t,o+8);n.style.left=pn(e,o)}}}window.addEventListener("keydown",t=>{const e=t.ctrlKey||t.shiftKey||t.altKey||t.metaKey;if(t.target instanceof HTMLInputElement||e)return;const{key:n}=t;"p"===n?Ni():"m"===n?An():"["===n?_i():"o"===n?Ki():n.startsWith("Arrow")&&"slider"!==t.target.getAttribute("role")&&!function t(e){if(e)return e.scrollHeight>e.clientHeight?e:t(e.parentElement)}(t.target)&&("ArrowUp"===n||"ArrowDown"===n?Mn(n):"ArrowRight"!==n&&"ArrowLeft"!==n||On(n))}),Ze.addEventListener("pointerdown",t=>{1===t.which&&V()&&(tn=!0,En(t),Ze.removeEventListener("pointermove",In),window.addEventListener("pointermove",En),window.addEventListener("pointerup",Ln))}),Ze.addEventListener("pointermove",In),Ze.addEventListener("pointerenter",Pn("track")),Ze.addEventListener("keydown",({key:t})=>{t.startsWith("Arrow")&&On(t)}),Ge.addEventListener("pointerdown",t=>{1===t.which&&($n(t),Ge.removeEventListener("pointermove",jn),window.addEventListener("pointermove",$n),window.addEventListener("pointerup",xn))}),Ge.addEventListener("pointermove",jn),Ge.addEventListener("pointerenter",Pn("volume")),Ge.addEventListener("keydown",({key:t})=>{t.startsWith("Arrow")&&Mn(t)}),Qe.addEventListener("click",({target:t})=>{const e=a("data-item",t);e&&Sn(e)}),Qe.addEventListener("keyup",({target:t,key:e})=>{const n=a("data-item",t);"INPUT"===(null==n?void 0:n.elementRef.nodeName)&&"Enter"===e&&Sn(n)}),document.getElementById("js-volume-toggle-btn").addEventListener("click",({currentTarget:t})=>{t.classList.toggle("active"),document.getElementById("js-volume-controls").classList.toggle("visible")}),bn(y("volume")),Array.from(Qe.querySelectorAll("[data-item]")).forEach(t=>{const e=t.getAttribute("data-item"),n=y(e);n&&("playback"===e?Tn(t,n):"mute"===e?cn(n):"shuffle"===e&&t.parentElement.classList.add("active"))});const Hn=document.getElementById("js-now-playing"),Rn=document.getElementById("js-media-container");let Cn=!1,Vn=0;function qn({currentTarget:t,target:e}){const n=a("data-item",e);if(n&&"image"===n.attrValue){const e=document.getElementById("js-media-state-icon");Di(V()),e&&e.remove(),t.insertAdjacentHTML("beforeend",`\n      <svg viewBox="0 0 24 24" id="js-media-state-icon" class="media-state-icon">\n        <use href="#${Ri()?"pause":"play"}"/>\n      </svg>\n    `),clearTimeout(Vn),Vn=setTimeout(()=>{document.getElementById("js-media-state-icon").remove()},1e3)}}function Dn(){const t=document.activeElement;t instanceof HTMLIFrameElement&&requestAnimationFrame(()=>{t.blur()})}function Un(t){27===t.which&&(Cn=!1,Rn.classList.remove("visible"),window.removeEventListener("keydown",Un),d(document.getElementById("js-media-toggle-btn"),{title:"Expand",id:"expand"}))}function Nn(t){const e=document.getElementById("js-yt-player");if(Rn.classList.toggle("visible"),Cn=!Cn,Cn){const n=V();Rn.addEventListener("click",qn),window.addEventListener("keydown",Un),window.addEventListener("blur",Dn),d(t,{title:"Collapse",id:"collapse"}),e.removeAttribute("tabindex"),"native"===n.player&&(document.getElementById("js-player-controls").classList.add("transparent"),Rn.classList.add("image"))}else Rn.removeEventListener("click",qn),window.removeEventListener("keydown",Un),window.removeEventListener("blur",Dn),d(t,{title:"Expand",id:"expand"}),e.setAttribute("tabindex","-1"),document.getElementById("js-player-controls").classList.remove("transparent"),Rn.classList.remove("image")}function Wn(){const t=document.getElementById("js-track-info");t&&t.remove()}function _n(t="./assets/images/album-art-placeholder.png"){document.getElementById("js-artwork").src=t}function Kn(t){const{url:e,type:n}=bt(t.artworkId),i=e.includes("placeholder");!function(t,e){Wn(),_n(e),Hn.classList.remove("inactive"),Hn.insertAdjacentHTML("beforeend",function(t){let e=t.name,n=null;t.artist&&t.title?(e=`${t.artist} - ${t.title}${t.album?` - ${t.album}`:""}`,n=`\n      <div class="track-info-item track-title" data-action="reveal-track">${t.title}</div>\n      <div class="track-info-item">${t.artist}${t.album?` - ${t.album}`:""}</div>\n    `):n=`<div class="track-info-item track-name" data-action="reveal-track">${t.name}</div>`;return`<div id="js-track-info" class="track-info" title="${e}">${n}</div> `}(t))}(t,e),function(t,e){const n=document.getElementById("js-media-image-container");if("native"===t){const[t,i]=n.children;if(e!==i.src){const o=e.includes("placeholder"),a=i.cloneNode();a.onload=function(){t.classList.toggle("hidden",o),a.classList.toggle("shadow",!o),n.replaceChild(a,i),t.style.backgroundImage=`url(${e})`,a.onload=null},a.src=e}n.classList.remove("hidden")}else n.classList.add("hidden")}(t.player,e),"mediaSession"in navigator&&"youtube"!==t.player&&(navigator.mediaSession.metadata=new MediaMetadata({title:t.title,artist:t.artist,album:t.album,artwork:[i?{src:"./android-chrome-512x512.png",sizes:"512x512",type:"image/png"}:{src:e,sizes:"512x512",type:n}]}))}Hn.addEventListener("click",t=>{const e=a("data-action",t.target);e&&("toggle-media"===e.attrValue?Nn(e.elementRef):"reveal-track"===e.attrValue&&function(){const t=H();t&&(t!==eo()?k(`playlist/${t}`):Lo(t),Cn&&Nn(document.getElementById("js-media-toggle-btn")))}())});n(115);var zn=n(33);async function Yn(t,e=[]){const n=t[e.length],i=await(o=n.audioTrack.link,fetch(o).then(t=>t.blob()));var o;const{duration:a}=await Object(zn.a)(i);return e.push({audioTrack:i,durationInSeconds:a,title:n.name,artist:"",album:"",name:n.name,duration:l(a),player:"native"}),e.length===t.length?e:Yn(t,e)}document.getElementById("js-dropbox-option").addEventListener("mouseenter",(function t({currentTarget:e}){i.load({src:"https://www.dropbox.com/static/api/2/dropins.js",id:"dropboxjs","data-app-key":"6ur73hspbv8o1z9"}),e.removeEventListener("mouseenter",t)}));const Fn=document.getElementById("js-import-options"),Xn=function(){const t={"local-files":{storePlaylist:!1},dropbox:{storePlaylist:!1},...JSON.parse(localStorage.getItem("import-settings"))};return{setSetting:function(e,n,i){t[e][n]=i,localStorage.setItem("import-settings",JSON.stringify(t))},getSetting:function(e,n){return t[e]?t[e][n]:null},getSettings:function(){return t}}}();function Jn({children:t},e){Array.from(t).forEach(t=>{let n=null;t.hasAttribute("data-item")?n=t:t.querySelector("[data-item]")&&(n=t.querySelector("[data-item]")),n&&(n.classList.toggle("spinner",e),n.disabled=e)})}function Gn(t,e){const n=et(t),i=function(t){const e=document.querySelector(`[data-entry-id="${t}"]`);return e?e.querySelector("[data-action='sync']"):null}(t);n&&n.classList.toggle("show-spinner",e),i&&(i.disabled=e,i.classList.toggle("spinner",e))}function Zn(t){document.getElementById("js-import-form").removeEventListener("submit",ii),t.removeEventListener("click",Qn),t.remove()}function Qn({target:t,currentTarget:e}){if(t===e||a("data-cancel-btn",t,e))return void Zn(e);const n=a("data-id",t,e);if(n)return Ct(`https://youtube.com/playlist?list=${n.attrValue}`),void Zn(e);const i=a("data-info-btn",t,e);if(i){const{elementRef:t}=i;Z("js-youtube-info-panel",oi,{element:t})}}function ti(){const t=function(){const t=$t;if(!t)return"";return`\n    <h4 class="youtube-modal-section-title">Your Playlists</h4>\n    <ul class="youtube-modal-playlists">${t.reduce((t,e)=>`\n      ${t}\n      <li class="youtube-modal-playlist">\n        <button class="youtube-modal-playlist-btn" data-id="${e.id}">\n          <div class="youtube-modal-playlist-thumb-container">\n            <img src="${e.thumbnail}" alt="" class="youtube-modal-playlist-thumb">\n          </div>\n          <div class="youtube-modal-playlist-content">\n            <div>${e.title}</div>\n            <div class="youtube-modal-playlist-info">${e.itemCount} item${1===e.itemCount?"":"s"}</div>\n          </div>\n          <span class="youtube-modal-playlist-action">Import</span>\n        </button>\n      </li>\n    `,"")}</ul>\n  `}();Fn.insertAdjacentHTML("beforeend",`\n    <div id="js-youtube-modal" class="youtube-modal-container">\n      <div class="youtube-modal">\n        <h3 class="youtube-modal-title">YouTube Import</h3>\n        <form id="js-import-form" class="youtube-modal-form">\n          <div class="youtube-modal-form-input-container">\n            <input type="text" name="url" class="input youtube-modal-form-input" placeholder="URL" required>\n            <button type="button"\n              class="btn btn-icon youtube-modal-form-info-btn" data-info-btn>\n              <svg viewBox="0 0 24 24">\n              <use href="#info"></use>\n              </svg>\n            </button>\n          </div>\n          <button class="btn youtube-modal-form-submit-btn">Import</button>\n        </form>\n        ${t}\n        <div class="youtube-modal-footer">\n          <button class="btn btn-text" data-cancel-btn>Cancel</button>\n        </div>\n      </div>\n    </div>\n  `),document.getElementById("js-youtube-modal").addEventListener("click",Qn),document.getElementById("js-import-form").addEventListener("submit",ii)}function ei({target:t}){yi([...t.files]),t.value="",t.removeEventListener("change",ei),t.remove()}function ni(t){const e=document.getElementById("js-file-picker")||function(){const t=document.createElement("input");return t.setAttribute("type","file"),t.setAttribute("id","js-file-picker"),t.setAttribute("accept","audio/*"),t.classList.add("file-picker"),t.addEventListener("change",ei),document.body.appendChild(t),t}();"file"===t?(e.removeAttribute("webkitdirectory"),e.removeAttribute("directory"),e.removeAttribute("allowdirs"),e.setAttribute("multiple","")):"folder"===t&&(e.removeAttribute("multiple"),e.setAttribute("webkitdirectory",""),e.setAttribute("directory",""),e.setAttribute("allowdirs","")),e.click()}function ii(t){const e=t.target.elements.url.value.trim();e&&(Ct(e),Zn(document.getElementById("js-youtube-modal"))),t.preventDefault()}function oi(t,{element:e}){e.insertAdjacentHTML("afterend",`\n    <div id="${t}" class="panel info-panel">\n    <h3 class="panel-title">Accepted formats:</h3>\n      <ul>\n        <li class="info-panel-content-item">youtube.com/playlist?list={playlistId}</li>\n        <li class="info-panel-content-item">youtube.com/watch?v={videoId}</li>\n      </ul>\n    </div>\n  `)}function ai(t,{element:e}){const n=Xn.getSettings();e.insertAdjacentHTML("afterend",`\n    <div id="${t}" class="panel import-settings-panel">\n      <h3 class="panel-title">Settings</h3>\n      <label class="checkbox-container import-setting">\n        <input type="checkbox" class="sr-only checkbox-input"\n          ${n["local-files"].storePlaylist?"checked":""} data-id="local-files">\n        <div class="checkbox">\n          <div class="checkbox-tick"></div>\n        </div>\n        <span class="checkbox-label">Store <b>Local files</b> playlist</span>\n      </label>\n      <label class="checkbox-container import-setting">\n        <input type="checkbox" class="sr-only checkbox-input"\n          ${n.dropbox.storePlaylist?"checked":""} data-id="dropbox">\n        <div class="checkbox">\n          <div class="checkbox-tick"></div>\n        </div>\n        <span class="checkbox-label">Store <b>Dropbox</b> playlist</span>\n      </label>\n      <div class="import-setting-message">\n        <svg viewBox="0 0 24 24">\n        <use href="#info"></use>\n        </svg>\n        <span>Stored playlists will persist through reload</span>\n      </div>\n    </div>\n  `),document.getElementById(t).addEventListener("change",si)}function si({target:t}){const e=t.getAttribute("data-id");Xn.setSetting(e,"storePlaylist",t.checked)}async function ri(t,e){Jn(e,!0),"modal-toggle"===t?(await async function(){var t;if(await ut()&&!$t)try{const e=await Tt("playlists","snippet,contentDetails","mine",!0);t=e.items,$t=t.map(t=>({id:t.id,itemCount:t.contentDetails.itemCount,title:t.snippet.title,thumbnail:t.snippet.thumbnails.medium.url}))}catch(t){console.log(t)}}(),ti()):"google-sign-in"===t&&await dt(),Jn(e,!1)}async function li(t){var e;if(!t.album||!t.artworkId)try{const n="https://ws.audioscrobbler.com/2.0/",i=`?method=track.getInfo&api_key=${"3e8d48b3277c21bc77965345f5faf18c"}&artist=${t.artist}&track=${t.title}&format=json`,o=await fetch(n+i).then(t=>t.json());if(o.track&&o.track.album){const{title:n,image:i}=o.track.album;if(!t.album&&n&&(t.album=n),!t.artworkId&&i){const n=i[i.length-1]["#text"];if(n){const{origin:i,pathname:o}=new URL(n),[a]=o.split("/").slice(-1),s=await(e=`${i}/i/u/${a}`,ht(new TextEncoder("utf-8").encode(e).buffer));t.artworkId=s,gt(s,{url:`${i}/i/u/${a}`,type:ci(a)})}}}}catch(t){console.log(t)}}function ci(t){const e=t.split(".")[1];return"jpg"===e?"image/jpeg":`image/${e}`}function di(t){return t.map(t=>({needsMetadata:!0,audioTrack:t.audioTrack,name:t.name,title:t.name,artist:"",album:"",durationInSeconds:0,duration:"",player:"native"}))}async function ui(t,e,n,i){if(!n.length)return void Et({title:`${t} files`,body:"No valid audio file found"});const o=(a=n,s=e.tracks,a.reduce((t,e)=>{const n=(i=e.name.trim()).slice(0,i.lastIndexOf("."));var i;return s.some(t=>t.name===n)||t.push({audioTrack:e,name:n}),t},[]));var a,s;if(o.length){c("import",{importing:!0,option:t,playlistId:e.id});try{So(e,await i(o)),requestIdleCallback&&requestIdleCallback(fi)}catch(t){console.log(t)}finally{c("import",{importing:!1,option:t,playlistId:e.id})}}else Et({title:`${t} files`,body:`Track${n.length>1?"s":""} already exist`})}async function mi(t){const{artist:e,title:n,album:i,duration:o,picture:a}=await Object(zn.a)(t.audioTrack),s=await async function(t){if(!t)return;return ht(await t.arrayBuffer())}(a);t.title=n||t.name,t.artist=e||"",t.album=i||"",t.durationInSeconds=o,t.duration=l(o),s&&(t.artworkId=s,gt(s,{file:a,type:a.type})),await li(t)}async function fi(){const t=B("local-files");if(!t)return;const e=t.tracks.find(t=>t.needsMetadata);if(e)try{await pi(e,t)}catch(t){console.log(t)}finally{requestIdleCallback(fi)}else t.storePlaylist&&Po({action:"update-tracks",artworks:vt(),playlist:{id:t.id,tracks:t.tracks}})}async function pi(t,{id:e,type:n,tracks:i}){if(delete t.needsMetadata,await mi(t),e===eo()){const i=wo(t.index,e);i&&(i.innerHTML=po(t,e,n))}Kt(e,i,!1)}function yi(t){const e=function(t){const e=new Audio,n=[];return t=t.reduce((t,i)=>{if(e.canPlayType(i.type))t.push(i);else if(i.type.startsWith("audio")){const{name:t}=i;n.push(t.slice(t.lastIndexOf(".")))}return t},[]),n.length&&Et({title:"Local files",body:`Can't play audio files with type: ${n.join(", ")}`}),t}(t),n="local-files";ui("local",B(n)||A({id:n,title:"Local files",type:"list",storePlaylist:Xn.getSetting(n,"storePlaylist")}),e,di)}function vi(t){return new Promise(e=>{t.file(e)})}function gi(t){return new Promise(e=>{const n=t.createReader(),i=[];!function t(){n.readEntries(async n=>{if(n.length>0){for(const t of n)if(t.isFile){const e=await vi(t);i.push(e)}else if(t.isDirectory){const e=await gi(t);i.push(...e)}t()}else e(i)})}()})}Fn.addEventListener("click",({currenTarget:t,target:e})=>{const n=a("data-item",e,t);if(!n||n.elementRef.disabled)return;const{attrValue:i,elementRef:o}=a("data-option",e,t);"local"===i?ni(n.attrValue):"dropbox"===i?Dropbox.choose({success(t){const e="dropbox";ui(e,B(e)||A({id:e,title:"Dropbox",type:"grid",storePlaylist:Xn.getSetting(e,"storePlaylist")}),t,Yn)},linkType:"direct",multiselect:!0,extensions:["audio"]}):"youtube"===i&&ri(n.attrValue,o)}),document.getElementById("js-import-settings-btn").addEventListener("click",({currentTarget:t})=>{Z("js-import-settings-panel",ai,{element:t})}),window.addEventListener("import",({detail:t})=>{const{importing:e,option:n,playlistId:i}=t;Jn(document.querySelector(`[data-option=${n}]`),e),Gn(i,e)}),window.addEventListener("connectivity-status",({detail:t})=>{if(!t){const t=document.getElementById("js-youtube-modal");t&&Zn(t)}Fn.querySelectorAll("[data-disable]").forEach(e=>{e.disabled=!t})}),window.addEventListener("drop",t=>{const{files:e,items:n}=t.dataTransfer;if(t.preventDefault(),e.length)if(n&&n.length&&n[0].webkitGetAsEntry){const t=[],e=[];Et({id:"js-upload-notice",body:'\n        <div class="upload-notice">\n        <img src="./assets/images/spinner.svg" alt="">\n        <span>Uploading...</span>\n        </div>\n        '});for(const i of n){const n=i.webkitGetAsEntry();n.isDirectory?e.push(gi(n)):n.isFile&&t.push(i.getAsFile())}Promise.all(e).then(e=>{yi([...e.flat().concat(t)])}).catch(t=>{console.log(t)}).finally(()=>{document.getElementById("js-upload-notice").remove()})}else yi([...e])}),window.addEventListener("dragover",t=>{t.preventDefault()});const bi=[];let hi,ki;function wi(t){ki.volume=t}function Ei(t){ki.currentTime=t}let Ii=!1,Li=null,$i=!1,ji=null,xi=!1;function Ti({data:t}){const e=V();e&&"youtube"===e.player&&(1===t?(xi||Ci(!1),xi=!1,c("track-start",Li.getCurrentTime())):2===t?(xi||Ci(!0),xi=!1,sn()):3===t?(on.stop(),an()):sn())}function Bi(){const{id:t,volume:e,startTime:n}=ji;Ii=!0,"number"==typeof n?(Oi(e),Li.cueVideoById(t,n),$i=!0):Mi(t,e)}function Ai(t){let e="";if(100===t.data?e="Video is either removed or marked as private":101!==t.data&&150!==t.data||(e="The owner of the requested video does not allow it to be played in embedded players"),console.log(t),e){const t=H(),n=V(),{name:i}=K(t,1);n.name===i?Fi(n):_i(),Et({title:`Cannot play ${n.name}`,body:e})}}function Si(){Li=new YT.Player("js-yt-player",{playerVars:{autoplay:0,disablekb:1,controls:0,fs:0,iv_load_policy:3},events:{onReady:Bi,onStateChange:Ti,onError:Ai}})}function Mi(t,e,n){if(Ii)return Oi(e),void Li.loadVideoById(t,n);ji={id:t,volume:e,startTime:n},window.onYouTubeIframeAPIReady=Si,i.load({src:"https://www.youtube.com/iframe_api"})}function Oi(t){Ii&&Li.setVolume(100*t)}let Pi=!0;const Hi=function(){function t(){return JSON.parse(localStorage.getItem("track"))||{}}function e(t){localStorage.setItem("track",JSON.stringify(t))}function n(){localStorage.removeItem("track")}return{getTrack:t,removeTrack:n,saveTrack:e,updateTrack:function(n){e(Object.assign(t(),n))},initTrack:function(){const e=t();if(!e)return;const{playlistId:i,currentTime:o,name:a}=e,s=D(i,a);s?(_(i,y("shuffle"),s.index),Ui(s,i,{startTime:o}),gn(s,o)):n()}}}();function Ri(){return Pi}function Ci(t){Pi="boolean"==typeof t?t:!Pi,Pi&&(nt(),on.stop()),qi(Pi),Gi()}async function Vi(t,e,{scrollToTrack:n,startTime:i}){const{rendered:o}=S(e);if(t.needsMetadata){const n=B(e);an(),await pi(t,n),n.storePlaylist&&Po({action:"update-tracks",artworks:vt(),playlist:{id:n.id,tracks:n.tracks}})}Kn(t),hn(t.duration,t.durationInSeconds),Ze.classList.add("visible"),P(e),U(t.index,e),C(t),o&&-1!==t.index&&(Eo(t.index,e),n&&$o(e)),void 0===i?(Pi=!1,Gi(),an(),qi(Pi)):Pi=!0}function qi(t){ln(document.getElementById("js-play-btn"),t),jo(t)}function Di({player:t}){"native"===t?Pi?ki.play():ki.pause():"youtube"===t&&function(t){Ii&&(xi=!0,$i=!1,t?Li.playVideo():Li.pauseVideo())}(Pi),Ci()}async function Ui(t,e,n={}){const i=y("volume");await Vi(t,e,n),"native"===t.player?function(t,e,n){hi=URL.createObjectURL(t.audioTrack),ki=new Audio(hi),ki.onplaying=function(){c("track-start",ki.currentTime)},ki.onerror=function(t){const e=V();bi.includes(e.name)?(Fi(e),bi.length=0):(sn(),bi.push(e.name),_i()),Et({title:`Cannot play ${e.name}`,body:"Its path or name might have changed"}),console.log(t)},wi(e),"number"!=typeof n?ki.play():Ei(n)}(t,i,n.startTime):"youtube"===t.player&&Mi(t.id,i,n.startTime)}function Ni(){const t=V();t?Di(t):Wi("direction",0,eo())}function Wi(t,e,n,i){if(!n)return;const o=y("shuffle"),a=V(),{shuffled:s}=S(n);if(a&&(jo(!0),Io(),un(),Yi(a)),"index"===t){const{tracks:t}=B(n),i=t[e];_(n,o,i.index),Ui(i,n)}else if("direction"===t){let t=null,r=!1;if(N().length&&s===o||(_(n,o),o&&(r=!0)),navigator.onLine)t=K(n,e);else{const i=[];for(;;){const o=K(n,0===e?1:e);if(i.includes(o.index)){Et({body:"Can't play tracks from YouTube white offline"});break}if("youtube"!==o.player){t=o;break}i.push(o.index),U(o.index,n)}}t?(r&&W(t.index),Ui(t,n,{scrollToTrack:"auto"!==i&&!Cn})):Xi(a)}}function _i(t){Wi("direction",1,H(),t)}function Ki(){Wi("direction",-1,H())}function zi({currentTarget:t,detail:e,target:n}){const i=eo(),o=a("data-btn",n,t),s=a("data-index",n,t);if(!s||!s.elementRef.classList.contains("disabled"))if(2===e&&s&&!o)Wi("index",s.attrValue,i);else if(o){const t=parseInt(s.attrValue,10),e=V(),n=H();e&&n===i&&t===e.index?Di(e):Wi("index",t,i)}}function Yi({player:t}){"native"===t?(ki.pause(),ki.onplaying=null,ki.onerror=null,ki.currentTime=0,ki=null,hi&&(URL.revokeObjectURL(hi),hi=null)):"youtube"===t&&Ii&&(sn(),Li.stopVideo(),$i=!1)}function Fi(t){t&&Yi(t),Xi(t)}function Xi(t){Pi=!0,Hi.removeTrack(),hn(),Ze.classList.remove("visible"),document.title="Veery",_n(),Wn(),Hn.classList.add("inactive"),Rn.classList.remove("visible"),C(),P(),nt(),t&&(qi(Pi),Io(),un(),sn())}function Ji(t,e){on.stop(),"native"===t?Ei(e):"youtube"===t&&function(t){Ii&&($i?Li.cueVideoById(ji.id,t):Li.seekTo(t,!0))}(e)}function Gi(t=eo()){const e=Ri(),n=B(t);let i="Veery";if(e)n&&(i=`${n.title} | ${i}`);else{const{artist:t,name:e,title:n}=V();i=`${t&&n?`${t} - ${n}`:e} | ${i}`}document.title=i}window.addEventListener("track-start",({detail:t})=>{const e=H(),{name:n,duration:i,durationInSeconds:o}=V();!function(t){const e=et(t);nt(),e.insertAdjacentHTML("beforeend",m({iconId:"volume",elementId:"js-active-playlist-icon",className:"active-playlist-icon"}))}(e),Hi.saveTrack({name:n,playlistId:e}),on.start({currentTime:Math.floor(t),duration:i,durationInSeconds:o}),sn()}),window.addEventListener("track-end",()=>{const t=V(),e=y("playback");"track-once"!==e&&("playlist-once"!==e||j!==N().length-1)?(Hi.removeTrack(),"repeat"!==e?_i("auto"):Ui(t,H())):Fi(t)}),"mediaSession"in navigator&&(navigator.mediaSession.setActionHandler("play",Ni),navigator.mediaSession.setActionHandler("pause",Ni),navigator.mediaSession.setActionHandler("previoustrack",Ki),navigator.mediaSession.setActionHandler("nexttrack",_i));const Zi=document.getElementById("js-tab-header"),Qi=matchMedia("(max-width: 540px)");let to="";function eo(){return to}function no(){return B(to)}function io(t){return document.getElementById(`js-tab-${t}`)}function oo(t){const e=B(t),{rendered:n}=S(t);n||function(t){const e=function(t){const e=bo(t);return`<div id="js-tab-${t.id}" class="tab">${e}</div>`}(t);document.getElementById("js-tabs").insertAdjacentHTML("beforeend",e),M(t.id,{rendered:!0}),t.tracks.length&&(ho(t.id),ro(t.id))}(e),Lo(t),"list"===e.type&&Qi.matches?To(e,"grid"):xo(e.type),Fe(e),he(e),We(),e.tracks.length&&io(t).addEventListener("click",zi)}Zi.addEventListener("click",({currentTarget:t,target:e})=>{const n=a("data-item",e,t);if(!n)return;const i=no(),o=n.attrValue;"move-to"===o?Z("js-move-to-panel",re,{playlistId:i.id,element:n.elementRef}):"list"!==o&&"grid"!==o||o===i.type?"sorting"===o?Z("js-sort-panel",Xe,{sortedBy:i.sortedBy,element:n.elementRef}):"order"===o&&i.sortedBy?function(t){Ye(t,t.sortedBy),ze(t.order)}(i):"sidebar"===o&&document.getElementById("js-sidebar-container").classList.remove("hidden"):To(i,o)}),window.addEventListener("route-change",({detail:{isPlaylistTab:t,tabId:e}})=>{const n=io(to);o(".sidebar-entry.active","active"),o(".tab.active","active"),function(t=""){to=t}(t?e:""),n&&n.removeEventListener("click",zi),t?(oo(e),Zi.classList.add("playlist-tab-active")):Zi.classList.remove("playlist-tab-active"),Gi(e),io(e).classList.add("active"),"not-found"!==e&&et(e).classList.add("active")}),Qi.onchange=function({matches:t}){const e=no();t&&e&&"list"===e.type&&To(e,"grid")};const ao={};function so(t){t.forEach(({isIntersecting:t,target:e})=>{const n=!e.childElementCount;t&&n?function(t){const{id:e,tracks:n,type:i}=no(),o=n[t.getAttribute("data-index")];t.innerHTML=po(o,e,i)}(e):t||n||e.contains(document.activeElement)||(e.innerHTML="")})}function ro(t){if(!IntersectionObserver||ao[t])return;ao[t]=new IntersectionObserver(so,{root:io(t),rootMargin:"120px 0px"});const{children:e}=uo(t);!function(t,e){e.forEach(e=>{ao[t].observe(e)})}(t,Array.from(e))}function lo(t){ao[t]&&(ao[t].disconnect(),delete ao[t])}let co=null;function uo(t){return document.getElementById(`js-${t}`)}function mo(){if(co)return co.querySelector(".btn-icon")}function fo(t){if(eo()!==H())return rn(!0);const e=V(),n=Ri();return e&&e.index===t?rn(n):rn(!0)}function po(t,e,n){return"list"===n?function(t,e){const{sortOrder:n}=S(e),i=n.indexOf(t.index),{title:o,id:a}=fo(t.index);return`\n    <span class="list-item-first-col">\n    <span class="list-item-index">${i+1}</span>\n    <button class="btn btn-icon track-play-pause-btn" data-btn="play" title="${o}">\n      ${m({iconId:a})}\n    </button>\n    </span>\n    <span class="list-item-col">${t.title}</span>\n    <span class="list-item-col">${t.artist}</span>\n    <span class="list-item-col">${t.album}</span>\n    <span class="list-item-last-col">${t.duration}</span>\n  `}(t,e):function(t){const{title:e,id:n}=fo(t.index);return`\n  <div class="artwork-container grid-item-thumbnail">\n    <button class="btn btn-icon track-play-pause-btn artwork-container-btn" data-btn="play" title="${e}">\n      ${m({iconId:n})}\n    </button>\n    <img src="${bt(t.artworkId).url}" class="artwork" alt="">\n  </div>\n  ${function(t){let e=null;e=t.artist&&t.title?`\n      <div class="track-info-item track-title">${t.title}</div>\n      <div class="track-info-item">${t.artist} ${t.album?`- ${t.album}`:""}</div>\n    `:`<div class="track-info-item track-name">${t.name}</div>`;return`<div class="track-info">${e}</div> `}(t)}\n  <div class="grid-item-duration">${t.duration}</div>\n  `}(t)}function yo({index:t,player:e}){return`<li class="list-item track${"youtube"!==e||navigator.onLine?"":" disabled"}" data-index="${t}"></li>`}function vo({index:t,player:e}){return`<li class="grid-item track${"youtube"!==e||navigator.onLine?"":" disabled"}" data-index="${t}"></li>`}function go(t,e,n){return e.reduce((e,i)=>e+n(t[i]),"")}function bo(t){return t.tracks.length?function({id:t,type:e,tracks:n}){const{sortOrder:i}=S(t);return"list"===e?function(t,e){return`\n  <ul class="list-view-header">\n    <li class="list-item-first-col">#</li>\n    <li>Title</li>\n    <li>Artist</li>\n    <li>Album</li>\n    <li class="list-item-last-col">Duration</li>\n  </ul>\n  <ul id="js-${t}" class="playlist-view">${e}</ul>\n  `}(t,go(n,i,yo)):function(t,e){return`<ul id="js-${t}" class="playlist-view grid-view">${e}</ul>`}(t,go(n,i,vo))}(t):'<p class="playlist-message">This playlist is empty</p>'}function ho(t){if(H()!==t)return;const e=V();e&&-1!==e.index&&Eo(e.index,t)}function ko(t){var e;io(t.id).innerHTML=bo(t),t.tracks.length?(ho(t.id),e=t.id,ao[e]&&lo(e),ro(e),he(t)):lo(t.id)}function wo(t,e){const{sortOrder:n}=S(e),i=n.indexOf(t);return document.getElementById(`js-${e}`).children[i]}function Eo(t,e){co=wo(t,e),co.classList.add("playing")}function Io(){co&&(co.classList.remove("playing"),co=null)}function Lo(t){H()===t&&co&&$o(t)}function $o(t){requestAnimationFrame(()=>{const e=io(t),{offsetHeight:n,offsetTop:i}=co,{clientHeight:o,scrollTop:a}=e;(i-n<a||i>a+o)&&(e.scrollTop=i-o/2)})}function jo(t){const e=mo();e&&ln(e,t)}function xo(t){const e=document.getElementById("js-list-toggle-btn"),n=document.getElementById("js-grid-toggle-btn");"list"===t?(e.classList.add("active"),n.classList.remove("active")):(n.classList.add("active"),e.classList.remove("active"))}function To(t,e){t.type=e,ko(t),xo(e),t.storePlaylist&&Po({action:"change-type",playlist:{id:t.id,type:e}})}function Bo(t){var e,n,i;M(t.id,{initialized:!0}),e=t.title,n=t.id,document.getElementById("js-sidebar-entries").insertAdjacentHTML("beforeend",`\n    <li id="js-sidebar-entry-${n}" class="sidebar-entry">\n      <a href="./#/playlist/${n}" class="sidebar-link" data-link>${e}</a>\n    </li>\n  `),function(t){const e=qt(),n=O(t.tracks),i=m({iconId:"link"}),o=t.url?`<a href="${t.url}"\n    class="btn btn-icon pl-entry-btn" target="_blank"\n    title="Open playlist on YouTube">\n      ${i}\n    </a>\n  `:"",a=t.url?Dt({disabled:!navigator.onLine,action:"sync",title:"Synchronize playlist",iconId:"sync"}):"",s=t.url?`\n    <div class="pl-entry-panel-container">\n      ${Dt({action:"settings",title:"Settings",iconId:"settings"})}\n    </div>\n  `:"",r=Dt({action:"remove",title:"Remove playlist",iconId:"trash"}),l=m({iconId:"edit",className:"pl-entry-input-icon"}),c=t.storePlaylist?"":m({iconId:"alert",className:"pl-entry-stats-item",title:"This playlist will not be stored"}),d=t.isPrivate?m({iconId:"lock",className:"pl-entry-stats-item",title:t.user?`Private to ${t.user.name}`:"Private"}):"";e.insertAdjacentHTML("beforeend",`\n    <li class="pl-entry" data-entry-id=${t.id}>\n      ${Nt(t.tracks)}\n      <div class="pl-entry-content">\n        <div class="pl-entry-input-container" data-action="edit">\n          <input type="text" class="input pl-entry-input" value="${t.title}">\n          ${l}\n        </div>\n        <div class="pl-entry-footer">\n          <div class="pl-entry-stats">\n          ${c}\n          ${d}\n          <span class="pl-entry-stats-item track-count">${t.tracks.length} tracks</span>\n          <span class="pl-entry-stats-item playlist-duration">${Ut(n)}</span>\n        </div>\n        ${o}\n        ${a}\n        ${s}\n        ${r}\n        </div>\n      </div>\n    </li>\n  `)}(t),z(t),F(t),h(i=`playlist/${t.id}`)||b.push(i)}function Ao({id:t,storePlaylist:e}){R(t)&&Fi(V()),function(t){const e=io(t);e&&(lo(t),e.remove())}(t),function(t){delete E[t],delete I[t]}(t),function(t){et(t).remove()}(t),function(t){b=b.filter(e=>!e.includes(t))}(t),e&&Po({action:"delete-playlist",playlist:{id:t}})}function So(t,e,{type:n}={}){const{initialized:i,rendered:o}=S(t.id);var a;e.length&&(t.tracks=t.tracks.concat(e)),i?(z(t),R(t.id)&&_(t.id,y("shuffle")),F(t),q(t.id),Kt(t.id,t.tracks),o&&ko(t),t.storePlaylist&&Po({action:"sync"===n?"update-tracks":"add-tracks",artworks:vt(),playlist:{id:t.id,tracks:e}})):(Bo(t),a="local-files",window.location.hash.includes(a)&&!o&&w(),t.storePlaylist&&Po({action:"create-playlist",artworks:vt(),playlist:t}))}function Mo(t){const e=A({title:t.target.title.value,id:Math.random().toString(36).slice(2),storePlaylist:!0,type:"grid"});Bo(e),Po({action:"create-playlist",playlist:e}),t.preventDefault(),t.target.reset()}window.addEventListener("connectivity-status",({detail:t})=>{T().forEach(e=>{const n=uo(e.id),{sortOrder:i}=S(e.id);n&&e.tracks.forEach(e=>{if("youtube"===e.player){const o=i.indexOf(e.index);n.children[o].classList.toggle("disabled",!t)}})})});const Oo=new Worker("./ww.js");function Po(t){Oo.postMessage(t)}Oo.onmessage=function({data:{artworks:t,playlists:e}}){!function(t){for(const e of t)yt[e.id]=e}(t),e.forEach(t=>{Bo(A(t))}),Ft(e.filter(t=>t.syncOnInit)),Hi.initTrack(),w()},Oo.onerror=function(t){console.log(t)},"serviceWorker"in navigator&&navigator.serviceWorker.register("./sw.js").then(t=>{t.onupdatefound=()=>{const e=t.installing;e.onstatechange=()=>{"installed"===e.state&&navigator.serviceWorker.controller&&c("sw-state-change","update")}}}).catch(console.log)},69:function(t,e,n){},70:function(t,e,n){}});