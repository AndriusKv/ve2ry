!function(t){function e(e){for(var i,s,a=e[0],c=e[1],l=e[2],u=0,m=[];u<a.length;u++)s=a[u],o[s]&&m.push(o[s][0]),o[s]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(t[i]=c[i]);for(d&&d(e);m.length;)m.shift()();return r.push.apply(r,l||[]),n()}function n(){for(var t,e=0;e<r.length;e++){for(var n=r[e],i=!0,a=1;a<n.length;a++){var c=n[a];0!==o[c]&&(i=!1)}i&&(r.splice(e--,1),t=s(s.s=n[0]))}return t}var i={},o={0:0},r=[];function s(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.e=function(t){var e=[],n=o[t];if(0!==n)if(n)e.push(n[2]);else{var i=new Promise(function(e,i){n=o[t]=[e,i]});e.push(n[2]=i);var r,a=document.getElementsByTagName("head")[0],c=document.createElement("script");c.charset="utf-8",c.timeout=120,s.nc&&c.setAttribute("nonce",s.nc),c.src=function(t){return s.p+""+({}[t]||t)+".js"}(t),r=function(e){c.onerror=c.onload=null,clearTimeout(l);var n=o[t];if(0!==n){if(n){var i=e&&("load"===e.type?"missing":e.type),r=e&&e.target&&e.target.src,s=new Error("Loading chunk "+t+" failed.\n("+i+": "+r+")");s.type=i,s.request=r,n[1](s)}o[t]=void 0}};var l=setTimeout(function(){r({type:"timeout",target:c})},12e4);c.onerror=c.onload=r,a.appendChild(c)}return Promise.all(e)},s.m=t,s.c=i,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)s.d(n,i,function(e){return t[e]}.bind(null,i));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s.oe=function(t){throw console.error(t),t};var a=window.webpackJsonp=window.webpackJsonp||[],c=a.push.bind(a);a.push=e,a=a.slice();for(var l=0;l<a.length;l++)e(a[l]);var d=c;r.push([64,5]),n()}({35:function(t,e,n){},36:function(t,e,n){},64:function(t,e,n){"use strict";n.r(e);n(34),n(35),n(36),n(0);const i=function(){const t=[];return{load:function(e){return t.includes(e.src)?Promise.resolve():new Promise(n=>{const i=document.createElement("script");Object.keys(e).forEach(t=>{i.setAttribute(t,e[t])}),document.getElementsByTagName("body")[0].appendChild(i),t.push(e.src),i.onload=n})}}}();function o(t){t.parentElement.removeChild(t)}function r(t,e){const n=document.querySelector(t);n&&n.classList.remove(e)}function s(t,e,n=null){for(;e&&e!==n;){if(e.hasAttribute(t))return{elementRef:e,attrValue:e.getAttribute(t)};e=e.parentElement}}function a(t,e){return!!e&&!e.contains(t)}function c(t){const e=function(t){const e=t%60;return e<10?`0${e}`:e}(t),n=function(t){const e=Math.floor(t/60%60);return t>=3600&&e<10?`0${e}`:e}(t);return`${function(t){const e=Math.floor(t/3600);return e?`${e}:`:""}(t)}${n}:${e}`}function l(t,e){const n=new CustomEvent(t,{detail:e});window.dispatchEvent(n)}function d(t){return"object"==typeof t?URL.createObjectURL(t):t}function u(t,{id:e,title:n}){t.setAttribute("title",n),t.querySelector("use").setAttribute("href",`#${e}`)}function m(t){let e=t.length;for(;e;){const i=Math.floor(Math.random()*e);e-=1;var n=[t[i],t[e]];t[e]=n[0],t[i]=n[1]}return t}function f(t){return`\n        <svg viewBox="0 0 24 24" ${t.elementId?`id=${t.elementId}`:""} ${t.className?`class="${t.className}"`:""}>\n            ${t.title?`<title>${t.title}</title>`:""}\n            <use href="#${t.iconId}"></use>\n        </svg>\n    `}const p=Object.assign({repeat:!1,shuffle:!1,once:!1,mute:!1,volume:.4},JSON.parse(localStorage.getItem("settings"))||{});function y(t,e){p[t]=e,b(p)}function g(t){return p[t]}function v(t){delete p[t],b(p)}function b(t){localStorage.setItem("settings",JSON.stringify(t))}n(21),n(53);let h=[];function k(t){return h.some(e=>e===t)}function w(){const t=window.location.hash.slice(2).replace(/\/+$/g,"");let e=!1,n="home";l("route-change",{tabId:n=t&&!k(t)?"not-found":(e=t.startsWith("playlist/"))?t.split("playlist/")[1]:n,isPlaylistTab:e})}window.addEventListener("hashchange",w);const I={},E={};let L="",$=null;function j(t){return I[t]}function T(t){return E[t.id]={},I[t.id]=Object.assign({sortedBy:"index",order:1,tracks:[],playbackIndex:0,lastTrackIndex:0,playbackOrder:[]},t),I[t.id]}function x(t,e){Object.assign(I[t],e)}function B(t){return E[t]}function A(t,e){return E[t]=Object.assign({},E[t],e),E[t]}function S(t){return t.reduce((t,e)=>t+=e.durationInSeconds,0)}function O(t=""){L=t}function M(){return L}function R(t){return t===L}function C(t){return t?Object.assign({},t):null}function H(t){$=t}function P(){return $}function _(t){const e=P();if(e&&R(t)){const i=V(t,e.name);let o=-1;i&&(o=i.index),n={index:o},Object.assign($,n),D(o)}var n}function V(t,e){const n=j(t);return n?n.tracks.find(t=>t.name===e):null}function D(t){const e=I[L],n=e.id,i=e.playbackOrder.indexOf(parseInt(t,10));I[n].playbackIndex=i<0?0:i}function U(t,e){const n=t.map((t,e)=>e);return e?m(n):n}function q({id:t,tracks:e},n){E[t].shuffled=n,I[t].playbackOrder=U(e,n),function(){const t=P();t&&D(t.index)}()}function W(t){return t.map((t,e)=>(t.index=e,t))}n(54);let N=null;function X(){window.removeEventListener("click",J,!0),o(N.element),N=null}function z(t,e,n){e(t,n),N={id:t,element:document.getElementById(t),removeOnClick:n.removeOnClick,initiator:n.element},window.addEventListener("click",J,!0)}function Y(t,e,n){if(N){const i=N.id;X(),i!==t&&z(t,e,n)}else z(t,e,n)}function J({target:t}){if(N.removeOnClick)return void X();const e=a(t,N.element),n=a(t,N.initiator);e&&n&&X()}function K(t){return document.getElementById(`js-sidebar-entry-${t}`)}function F(){const t=document.getElementById("js-active-playlist-icon");t&&o(t)}function Z(t,{element:e}){e.insertAdjacentHTML("afterend",`\n        <div id="${t}" class="panel sidebar-form-panel"></div>\n    `),Fi("sidebar",document.getElementById(t),"beforeend",Ki)}document.getElementById("js-sidebar-container").addEventListener("click",({currentTarget:t,target:e})=>{if(s("data-link",e,t)||a(e,t.firstElementChild))return void t.classList.add("hidden");const n=s("data-btn",e,t);n&&Y("js-sidebar-form-panel",Z,{element:n.elementRef})}),window.addEventListener("connectivity-status",({detail:t})=>{document.getElementById("js-online-status").classList.toggle("visible",!t)});let G=!1,Q=!1;async function tt(){if(G||Q)return;const t=document.getElementById("js-google-sign-in-or-out-btn");Q=!0,t.disabled=!0;try{await i.load({src:"https://apis.google.com/js/api.js"}),await new Promise(t=>gapi.load("client:auth2",t)),await gapi.client.init({apiKey:"AIzaSyD33Rxm4dA34Mh84oSxYTUUF_jyCLLOua4",clientId:"293076144560-r5cear7rprgo094u6ibcd6nl3bbg18te.apps.googleusercontent.com",discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest"],scope:"https://www.googleapis.com/auth/youtube.force-ssl"}),gapi.auth2.getAuthInstance().isSignedIn.get()&&(t.textContent="Sign Out"),G=!0,Q=!1,l("google-api-initialized")}catch(t){Q=!1,console.log(t)}finally{t.disabled=!1}}function et(){return(t,{element:e})=>{e.insertAdjacentHTML("beforeend",`\n            <div id="${t}" class="panel player-message service-worker-message">\n                <p class="player-message-body">Update is available, please refresh.</p>\n                <button id="js-player-message-btn" class="btn-icon player-message-btn">Refresh</button>\n            </div>\n        `),document.getElementById("js-player-message-btn").addEventListener("click",it,{once:!0})}}function nt({title:t,body:e,callback:n=function(t,e=""){return(n,{element:i})=>{i.insertAdjacentHTML("beforeend",`\n            <div id="${n}" class="panel player-message">\n                <h3 class="panel-title">${t}</h3>\n                ${e&&`<p class="player-message-body">${e}</p>`}\n            </div>\n        `)}}}){Y("js-player-message",n(t,e),{element:document.getElementById("js-player"),removeOnClick:!0})}function it(){location.reload()}function ot(){l("connectivity-status",navigator.onLine)}function rt(t){return new Promise(e=>{let n=URL.createObjectURL(t),i=new Audio(n);i.preload="metadata",i.addEventListener("loadedmetadata",function t(){e(Math.floor(i.duration)),i.removeEventListener("loadedmetadata",t),i=null,n=URL.revokeObjectURL(n)})})}async function st(t){if("audio/flac"===t.type){return(0,(await n.e(1).then(n.bind(null,65))).default)(t)}if("audio/ogg"===t.type||"video/ogg"===t.type){return(0,(await n.e(2).then(n.bind(null,66))).default)(t)}if("audio/mp3"===t.type||"audio/mpeg"===t.type){return(0,(await n.e(3).then(n.bind(null,67))).default)(t)}if("audio/x-m4a"===t.type||"audio/mp4"===t.type){return(0,(await n.e(4).then(n.bind(null,68))).default)(t)}return async function(t){return await i.load({src:"libs/metadata-audio-parser.min.js"}),Promise.all([new Promise(e=>{parse_audio_metadata(t,e)}),rt(t)]).then(([t,e])=>Object.assign({},t,{duration:e}))}(t)}async function at(t,e,n=[]){const i=n.length,o=t[i],r=o.audioTrack,s=o.name;var a,l,d;a=`Processing: ${s}`,l=i+1,d=t.length,function(t=""){document.getElementById("js-import-progress-label").textContent=t}(a),document.getElementById("js-import-progress-bar-inner").style.transform=`scaleX(${l/d})`,document.getElementById("js-import-progress-bar-label").textContent=`${l}/${d}`;let u=await st(r),m=u.artist,f=u.title,p=u.album,y=u.duration,g=u.picture;if(navigator.onLine&&m&&f){var v=await async function(t,e,n,i){if(n&&i)return{album:n,picture:i};const o=`?method=track.getInfo&api_key=3e8d48b3277c21bc77965345f5faf18c&artist=${t}&track=${e}&format=json`,r=await fetch("https://ws.audioscrobbler.com/2.0/"+o).then(t=>t.json());if(r.track&&r.track.album){const t=r.track.album,e=t.title,o=t.image;if(!n&&e&&(n=e),!i&&o){const t=o[o.length-1]["#text"];if(t){const e=new URL(t);i=`${e.origin}/i/u/${e.pathname.split("/").slice(-1)[0]}`}}}return{album:n,picture:i}}(m,f,p,g);p=v.album,g=v.picture}return n.push({audioTrack:r,name:s,title:m?f:s,artist:m||"",album:p||"",thumbnail:g||"assets/images/album-art-placeholder.png",durationInSeconds:y,duration:c(y),player:"native",playlistId:e}),i+1===t.length?n:at(t,e,n)}async function ct(t,e,n,i){l("import",{importing:!0,option:t,playlistId:e.id});try{if(!n.length)throw new Error("No valid audio file found");const o=function(t,e){return t.reduce((t,n)=>{const i=function(t){return t.slice(0,t.lastIndexOf("."))}(n.name.trim());return e.some(t=>t.name===i)||t.push({audioTrack:n,name:i}),t},[])}(n,e.tracks);if(!o.length)throw new Error(`Track${n.length>1?"s":""} already exist`);Ji(e,await i(o,e.id))}catch(e){nt({title:`${t} files`,body:e.message}),console.log(e)}finally{l("import",{importing:!1,option:t,playlistId:e.id})}}function lt(t){const e=function(t){const e=new Audio,n=[];return t=t.reduce((t,i)=>{if(e.canPlayType(i.type))t.push(i);else{const t=i.name;n.push(t.slice(t.lastIndexOf(".")))}return t},[]),n.length&&nt({title:"Local files",body:`Can't play audio files with type: ${n.join(", ")}`}),t}(t),n="local-files";ct("local",j(n)||T({id:n,title:"Local files",type:"list",cacheId:"local-files-artwork-cache",storageDisabled:$t.getSetting(n,"storageDisabled")}),e,at)}async function dt(t,e,n=[]){const i=t[n.length],o=await(r=i.audioTrack.link,fetch(r).then(t=>t.blob()));var r;const s=await rt(o);return n.push({audioTrack:o,durationInSeconds:s,title:i.name,artist:"",album:"",name:i.name,duration:c(s),thumbnail:"assets/images/album-art-placeholder.png",player:"native",playlistId:e}),n.length===t.length?n:dt(t,e,n)}window.addEventListener("sw-state-change",({detail:t})=>{"update"===t&&nt({callback:et})}),window.addEventListener("online",ot),window.addEventListener("offline",ot),window.addEventListener("load",ot),document.getElementById("js-dropbox-option").addEventListener("mouseenter",function t({currentTarget:e}){i.load({src:"https://www.dropbox.com/static/api/2/dropins.js",id:"dropboxjs","data-app-key":"6ur73hspbv8o1z9"}),e.removeEventListener("mouseenter",t)});n(56);const ut=[];let mt=null;function ft(t){if(t.includes("H")||(t=`0H${t}`),!t.includes("M")){const e=t.indexOf("H")+1;t=`${t.slice(0,e)}0M${t.slice(e)}`}return t.includes("S")||(t=`${t}0`),t.match(/\d{1,}/g).reverse().reduce((t,e,n)=>t+=e*60**n,0)}function pt(t,e,n,i,o){let r=`part=${e}&${n}=${i}&maxResults=50&key=AIzaSyD33Rxm4dA34Mh84oSxYTUUF_jyCLLOua4`;return o&&(r+=`&pageToken=${o}`),mt&&(r+=`&access_token=${mt}`),fetch(`https://www.googleapis.com/youtube/v3/${t}?${r}`).then(t=>t.json())}function yt(t,e){return t.reduce((t,n)=>{return e.some(t=>t.id===n.id)||t.push(n),t},[])}function gt(t){return t.filter(t=>{const e=t.snippet.title;return"Deleted video"!==e&&"Private video"!==e})}function vt(t,e){return t.map(t=>({id:t.snippet.resourceId.videoId,durationInSeconds:t.durationInSeconds,duration:c(t.durationInSeconds),name:t.snippet.title,title:t.snippet.title,artist:"",album:"",thumbnail:t.snippet.thumbnails.medium.url,player:"youtube",playlistId:e}))}async function bt(t,e){const n=await pt("playlistItems","snippet","playlistId",t,e),i=n.error,o=n.items,r=n.nextPageToken;i&&function({code:t,message:e}){throw 403===t?e="You need to be sign in if you want to import private playlist":404===t&&(e="Playlist was not found"),new Error(e)}(i);const s=vt(await async function(t){const e=t.map(t=>t.snippet.resourceId.videoId).join(),n=await pt("videos","contentDetails","id",e);return t.reduce((t,e)=>{const i=n.items.find(({id:t})=>t===e.snippet.resourceId.videoId);return i&&(e.durationInSeconds=ft(i.contentDetails.duration)-1,t.push(e)),t},[])}(gt(o)),t);if(r){const e=await bt(t,r);return s.concat(e)}return s}function ht(t,e){return j(t)||T(Object.assign({id:t,type:"grid",cacheId:"youtube-thumbnail-cache"},e))}async function kt(t,e){const n=ht(t,{title:"YouTube"}),i=(await pt("videos","snippet,contentDetails","id",e)).items;if(!i.length)throw new Error("Video was not found");Ji(n,yt(vt(gt(i).map(t=>(t.snippet.resourceId={videoId:t.id},t.durationInSeconds=ft(t.contentDetails.duration)-1,t)),"youtube"),n.tracks))}async function wt(t,e,n){const i=ht(e,{url:t}),o=await bt(e);"sync"===n&&function({id:t,_id:e,tracks:n}){const i=B(t).rendered,o=Ti(t);i&&o&&(o.innerHTML="");Gi({action:"remove-tracks",playlist:{_id:e,tracks:n}}),n.length=0}(i),i.title||x(i.id,await async function(t){const e=(await pt("playlists","snippet,status","id",t)).items;return{title:e[0].snippet.title,isPrivate:"private"===e[0].status.privacyStatus}}(e)),Ji(i,yt(o,i.tracks))}async function It(t,e){if(Q)return void function(t,e){ut.some(e=>e.url===t)||ut.push({url:t,type:e})}(t,e);const n=function(t){let e="",n="";try{const i=new URL(t).searchParams;e=i.get("v"),n=i.get("list")}catch(i){const o=t.match(/v=[a-zA-Z0-9\-_]+/),r=t.match(/list=[a-zA-Z0-9\-_]+/);o&&(e=o[0].slice(2)),r&&(n=r[0].slice(5))}return{videoId:e,playlistId:n}}(t),i=n.videoId,o=n.playlistId,r=o||"youtube";!function(){const t=gapi.auth2.getAuthInstance();mt=t.isSignedIn.get()?t.currentUser.get().getAuthResponse().access_token:null}(),l("import",{importing:!0,option:"youtube",playlistId:r});try{if(i)return void await kt(r,i);if(!o)throw new Error("Invalid url");if("WL"===o)throw new Error("Importing Watch Later playlist is not allowed");await wt(t,r,e)}catch(t){nt({title:"YouTube",body:t.message}),console.log(t)}finally{l("import",{importing:!1,option:"youtube",playlistId:r})}}window.addEventListener("google-api-initialized",()=>{ut.forEach(({url:t,type:e})=>{It(t,e)}),ut.length=0});const Et=document.getElementById("js-import-options");let Lt="";const $t=function(){const t=Object.assign({"local-files":{storageDisabled:!1},dropbox:{storageDisabled:!1}},JSON.parse(localStorage.getItem("import-settings")));return{setSetting:function(e,n,i){t[e][n]=i,localStorage.setItem("import-settings",JSON.stringify(t))},getSetting:function(e,n){return t[e]?t[e][n]:null},getSettings:function(){return t}}}();function jt(t=""){Lt=t}function Tt(){jt(),function(){const t=document.getElementById("js-import-form");t&&(t.removeEventListener("submit",Ot),o(t),r(".import-option-btn.active","active"))}()}function xt(t,e){const n=K(t),i=function(t){const e=document.querySelector(`[data-entry-id="${t}"]`);if(e)return e.querySelector("[data-action='sync']");return null}(t);n&&n.classList.toggle("show-spinner",e),i&&(i.disabled=e)}function Bt(t,{url:e,type:n}){"youtube"===t&&It(e,n)}function At({target:t}){lt([...t.files]),t.value="",t.removeEventListener("change",At),o(t)}function St(t){const e=document.getElementById("js-file-picker")||function(){const t=document.createElement("input");return t.setAttribute("type","file"),t.setAttribute("id","js-file-picker"),t.setAttribute("accept","audio/*"),t.classList.add("file-picker"),t.addEventListener("change",At),document.body.appendChild(t),t}();"file"===t?(e.removeAttribute("webkitdirectory"),e.removeAttribute("directory"),e.removeAttribute("allowdirs"),e.setAttribute("multiple","")):"folder"===t&&(e.removeAttribute("multiple"),e.setAttribute("webkitdirectory",""),e.setAttribute("directory",""),e.setAttribute("allowdirs","")),e.click()}function Ot(t){const e=t.target.elements.url.value.trim();if(e){const n=t.target.getAttribute("data-for");Tt(),Bt(n,{url:e})}t.preventDefault()}function Mt(t,{element:e}){e.insertAdjacentHTML("afterend",`\n        <div id="${t}" class="panel info-panel">\n            <h3 class="panel-title">Accepted formats</h3>\n            <ul>\n                <li class="info-panel-content-item">youtube.com/playlist?list={playlistId}</li>\n                <li class="info-panel-content-item">youtube.com/watch?v={videoId}</li>\n            </ul>\n        </div>\n    `)}function Rt(t,{element:e}){const n=$t.getSettings();e.insertAdjacentHTML("afterend",`\n        <div id="${t}" class="panel import-settings-panel">\n            <h3 class="panel-title">Settings</h3>\n            <label class="import-setting">\n                <input type="checkbox" class="checkbox-input"\n                    ${n["local-files"].storageDisabled?"checked":""} data-id="local-files">\n                <div class="checkbox"></div>\n                <span class="import-setting-label">Don't store <b>Local files</b> playlist</span>\n            </label>\n            <label class="import-setting">\n                <input type="checkbox" class="checkbox-input"\n                    ${n.dropbox.storageDisabled?"checked":""} data-id="dropbox">\n                <div class="checkbox"></div>\n                <span class="import-setting-label">Don't store <b>Dropbox</b> playlist</span>\n            </label>\n        </div>\n    `),document.getElementById(t).addEventListener("change",Ct)}function Ct({target:t}){const e=t.getAttribute("data-id");$t.setSetting(e,"storageDisabled",t.checked)}function Ht({attrValue:t,elementRef:e}){if("form-toggle"===t){const t="youtube";!function(t){return Lt!==t}(t)?Tt():(e.classList.add("active"),function(t,e){const n="js-import-form",i=`\n        <form id=${n} class="import-form" data-for="${e}">\n            <input type="text" name="url" class="input" placeholder="URL" required>\n            <button class="btn">Import</button>\n        </form>\n    `;t.insertAdjacentHTML("afterend",i);const o=document.getElementById(n);o.elements.url.focus(),o.addEventListener("submit",Ot)}(e,t),jt(t),G||tt())}else"google-sign-in-or-out"===t?async function(t){if(!t.disabled){t.disabled=!0;try{const e=gapi.auth2.getAuthInstance();e.isSignedIn.get()?(await e.signOut(),t.textContent="Sign In"):(await e.signIn(),t.textContent="Sign Out")}catch(t){console.log(t)}t.disabled=!1}}(e):"youtube-info"===t&&Y(`js-${t}-panel`,Mt,{element:e})}function Pt(){const t="js-pl-entries";return document.getElementById(t)||function(t){document.getElementById("js-tab-home").insertAdjacentHTML("beforeend",`\n        <div class="home-tab-section pl-entry-container">\n            <div class="home-tab-section-header">\n                <h2 class="home-tab-section-title">Playlists</h2>\n            </div>\n            <ul id="${t}"></ul>\n        </div>\n    `);const e=document.getElementById(t);return e.addEventListener("click",Kt),e.addEventListener("focus",Ft,!0),e}(t)}function _t({action:t,title:e,iconId:n}){return`\n        <button class="btn-icon pl-entry-btn" data-action="${t}" title="${e}">\n            ${f({iconId:n})}\n        </button>\n    `}function Vt(t){let e=Math.floor(t/3600),n=Math.ceil(t/60%60);return 60===n&&(n=0,e+=1),`${e} hr ${n} min`}function Dt(t){return function(t){const e="assets/images/album-art-placeholder.png",n=m(t.map(t=>t.thumbnail)),i=[];for(const t of n){if(4===i.length)break;t!==e&&i.push(t)}for(;i.length<4;)i.push(e);return i}(t).map(t=>`\n        <div class="pl-entry-thumb-image-container">\n            <img src="${d(t)}" class="pl-entry-thumb-image" alt="">\n        </div>\n    `).join("")}function Ut(t,e){const n=S(e);t.querySelector(".track-count").textContent=`${e.length} tracks`,t.querySelector(".playlist-duration").textContent=Vt(n)}function qt(t,e){t.querySelector(".pl-entry-thumbnail").innerHTML=Dt(e)}function Wt(t,e){const n=document.getElementById("js-pl-entries").children;for(const i of n)if(t===i.getAttribute("data-entry-id")){Ut(i,e),qt(i,e);break}}function Nt(t,{element:e,pl:n}){e.insertAdjacentHTML("afterend",`\n        <div id="${t}" class="panel pl-entry-panel">\n            <h3 class="panel-title">Playlist settings</h3>\n            <label class="pl-entry-setting">\n                <input type="checkbox" class="checkbox-input" ${n.syncOnInit?"checked":""}>\n                <div class="checkbox"></div>\n                <span>Synchronize playlist on startup</span>\n            </label>\n        </div>\n    `),document.getElementById(t).addEventListener("change",Zt)}function Xt(t){const e=t.parentElement;var n;o(t),e.children.length||((n=e).removeEventListener("click",Kt),n.removeEventListener("focus",Ft,!0),o(n.parentElement))}async function zt(t){t.length&&(Tt(),t.forEach(({id:t})=>{l("import",{importing:!0,option:"youtube",playlistId:t})}),await tt(),t.forEach(({url:t})=>{Bt("youtube",{url:t,type:"sync"})}))}function Yt({currentTarget:t}){const e=s("data-entry-id",t).attrValue,n=j(e),i=n._id,o=n.title,r=t.value;t.removeEventListener("blur",Yt),t.removeEventListener("keyup",Jt),r?r!==o&&(!function(t,e){K(t).querySelector(".sidebar-link").textContent=e}(e,r),x(e,{title:r}),Gi({action:"change-title",playlist:{_id:i,title:r}})):t.value=o}function Jt({currentTarget:t,which:e}){13===e&&t.blur()}function Kt({target:t}){const e=s("data-entry-id",t),n=s("data-action",t);if(!e||!n||n.elementRef.disabled)return;const i=n.attrValue,r=n.elementRef,a=j(e.attrValue);"remove"===i?(!function({id:t,_id:e,cacheId:n}){R(t)&&di(P());(function(t){const e=hi(t);e&&(ji(t),o(e))})(t),function(t){delete I[t],delete E[t]}(t),function(t){o(K(t))}(t),function(t){h=h.filter(e=>!e.includes(t))}(t),function(t){if(!t)return;caches.keys().then(e=>{e.forEach(e=>{e===t&&caches.delete(e)})})}(n),Gi({action:"remove",playlist:{_id:e}})}(a),Xt(e.elementRef)):"sync"===i?zt([a]):"settings"===i?Y("js-pl-entry-panel",Nt,{element:r,pl:a}):"edit"===i&&r.querySelector(".input").focus()}function Ft({target:t}){const e=s("data-action",t);e&&"edit"===e.attrValue&&(t.addEventListener("blur",Yt),t.addEventListener("keyup",Jt))}function Zt({target:t}){const e=j(s("data-entry-id",t).attrValue);e.syncOnInit=t.checked,Gi({action:"change-sync",playlist:{_id:e._id,syncOnInit:e.syncOnInit}})}function Gt({currentTarget:t,target:e}){const n=s("data-panel-item",e,t);if(!n)return;const i=n.attrValue,r=n.elementRef;"btn"===i?(Fi("move-to",r.parentElement,"beforeend",Qt),o(r)):(t.removeEventListener("click",Gt),function(t){const e=Be(xe()),n=bi().tracks,i=j(t),o=n.filter(n=>e.includes(n.index)&&!V(t,n.name)).map(e=>Object.assign({},e,{playlistId:t}));Ji(i,o),r=`playlist/${i.id}`,window.location.hash=`/${r}`;var r}(i),X(),ye())}function Qt(t){const e=document.getElementById("js-move-to-list"),n=vi();Ki(t),e?e.innerHTML=te(n):t.target.insertAdjacentHTML("beforebegin",ee(n))}function te(t){return Object.keys(I).map(j).reduce((e,n)=>(n.id!==t&&(e+=`\n                <li data-panel-item="${n.id}">\n                    <button class="btn-icon move-to-list-item-btn">${n.title}</button>\n                </li>\n            `),e),"")}function ee(t){const e=te(t);return e?`<ul id="js-move-to-list" class="move-to-list">${e}</ul>`:""}function ne(t,{playlistId:e}){document.getElementById("js-move-to-panel-container").insertAdjacentHTML("beforeend",`\n        <div id="${t}" class="panel move-to-panel">\n            <h3 class="panel-title move-to-panel-title">Move to</h3>\n            ${ee(e)}\n            <button class="btn-icon move-to-new-pl-btn" data-panel-item="btn">\n                ${f({iconId:"plus"})}\n                <span>Create new playlist</span>\n            </button>\n        </div>\n    `)}Et.addEventListener("click",({currenTarget:t,target:e})=>{const n=s("data-item",e,t);if(!n||n.elementRef.disabled)return;const i=s("data-option",e,t).attrValue;"local"===i?St(n.attrValue):"dropbox"===i?Dropbox.choose({success(t){const e="dropbox";ct(e,j(e)||T({id:e,title:"Dropbox",type:"grid",storageDisabled:$t.getSetting(e,"storageDisabled")}),t,dt)},linkType:"direct",multiselect:!0,extensions:["audio"]}):"youtube"===i&&Ht(n)}),document.getElementById("js-import-settings-btn").addEventListener("click",({currentTarget:t})=>{Y("js-import-settings-panel",Rt,{element:t})}),window.addEventListener("import",({detail:t})=>{const e=t.importing,n=t.option,i=t.playlistId;!function({children:t},e){Array.from(t).forEach(t=>{t.hasAttribute("data-item")&&(t.disabled=e)})}(document.querySelector(`[data-option=${n}]`),e),xt(i,e),"local"===n&&(e?Et.insertAdjacentHTML("afterend",'\n        <div id="js-import-progress" class="import-progress">\n            <p id="js-import-progress-label" class="import-progress-label"></p>\n            <div class="import-progress-bar">\n                <div id="js-import-progress-bar-inner" class="import-progress-bar-inner"></div>\n                <div id="js-import-progress-bar-label" class="import-progress-bar-label"></div>\n            </div>\n        </div>\n    '):o(document.getElementById("js-import-progress")))});const ie={},oe={};let re=null,se=null,ae=null,ce={},le=[],de=0,ue=!1,me=!1;function fe(){re.removeEventListener("mousedown",je),re=null}function pe(){xe().forEach(t=>{t.classList.remove("selected")})}function ye(){pe(),ve()}function ge(){me||(me=!0,function(){const t="js-move-to-panel-container";document.getElementById("js-playlist-tab-header-items").insertAdjacentHTML("afterbegin",`\n        <div id="${t}" class="playlist-tab-header-item" data-move-to>\n            <button class="btn-icon" data-item="move-to" title="Move to">\n                ${f({iconId:"move-to"})}\n            </button>\n        </div>\n    `),document.getElementById(t).addEventListener("click",Gt)}(),setTimeout(()=>{window.addEventListener("click",$e,!0)},0),window.addEventListener("keypress",Te))}function ve(){me&&(me=!1,function(){const t=document.getElementById("js-move-to-panel-container");t.removeEventListener("click",Gt),o(t)}(),window.removeEventListener("click",$e,!0),window.removeEventListener("keypress",Te))}function be(t,e){return t>e?e:t<0?0:t}function he(){clearInterval(de),de=0}function ke(t){ue=!0,requestAnimationFrame(()=>{ae&&function(t,e,n,i){let o=t.x-e.x,r=t.y-e.y;if(o<0){const t=e.x+o;o*=-1,n.left=t,i.left=`${t}px`}else n.left!==e.x&&(n.left=e.x,i.left=`${e.x}px`);if(r<0){const t=e.y+r;r*=-1,n.top=t,i.top=`${t}px`}else n.top!==e.y&&(n.top=e.y,i.top=`${e.y}px`);n.right=n.left+o,n.bottom=n.top+r,i.width=`${o}px`,i.height=`${r}px`}(oe,ie,ce,ae.style),function(t,e,n){for(let i=0;i<t.length;i++){const o=t[i],r=o.ref.classList;e.right>o.left&&e.left<o.right&&e.bottom>o.top&&e.top<o.bottom?(n&&!o.selected&&r.contains("selected")&&(r.remove("selected"),o.removed=!0),o.removed||(r.add("selected"),o.selected=!0)):o.selected?(r.remove("selected"),o.selected=!1):o.removed&&(r.add("selected"),o.removed=!1)}}(le,ce,t),ue=!1})}function we(t,e,{scrollHeight:n,height:i}){e.scrollTop+=36,oe.y=e.scrollTop+i,oe.y>=n&&(oe.y=n,he()),ue||ke(t)}function Ie(t,e){e.scrollTop-=36,oe.y=e.scrollTop,oe.y<=0&&(oe.y=0,he()),ue||ke(t)}function Ee(t){const e=se,n=e.top,i=e.left,o=e.width,r=e.height,s=e.scrollHeight,a=t.clientY-n;if(oe.x=be(t.clientX-i,o),oe.y=be(re.scrollTop+a,s),t.preventDefault(),!ae&&function(t,e){return t.x>e.x+2||t.x<e.x-2||t.y>e.y+2||t.y<e.y-2}(oe,ie))return le=function(){const t=Ti(vi()).children;return Array.from(t).map(t=>{const e=t.offsetTop,n=t.offsetLeft;return{ref:t,top:e,left:n,right:n+t.offsetWidth,bottom:e+t.offsetHeight}})}(),ae=function(t,{x:e,y:n}){return ce.top=n,ce.left=e,t.insertAdjacentHTML("afterbegin",`\n        <div class="selection-area" style="top: ${n}px; left: ${e}px"></div>\n    `),t.firstElementChild}(re,ie),document.activeElement.blur(),t.ctrlKey||pe(),void ve();if(ue||ke(t.ctrlKey),de&&a>0&&a<r)he();else if(!de){let e=null;if(a>r&&oe.y<s)e=we;else{if(!(a<0&&oe.y>0))return;e=Ie}de=setInterval(e,40,t.ctrlKey,re,se)}}function Le({target:t,ctrlKey:e}){if(de&&he(),ae){const t=xe();o(ae),ae=null,ce={},le.length=0,t.length?ge():ve()}else{const n=s("data-index",t,re);n?function(t,e){if(e||pe(),t.classList.toggle("selected"),t.classList.contains("selected"))ge();else{const e=xe();t.blur(),e.length||ve()}}(n.elementRef,e):e||ye()}window.removeEventListener("mousemove",Ee),window.removeEventListener("mouseup",Le)}function $e({target:t}){!s("data-move-to",t)&&a(t,re)&&ye()}function je({currentTarget:t,target:e,which:n,clientX:i,clientY:o}){var r;1===n&&(s("data-btn",e)?ye():(se={top:(r=t).offsetTop,left:r.offsetLeft,width:r.clientWidth,height:r.offsetHeight,scrollHeight:r.scrollHeight},ie.x=i-se.left,ie.y=t.scrollTop+o-se.top,ie.x<se.width&&(window.addEventListener("mousemove",Ee),window.addEventListener("mouseup",Le))))}function Te({key:t,keyCode:e}){"Delete"!==t&&127!==e||(!function(){const t=xe(),e=bi(),n=Be(t),i=function(t,e){const n=[],i=[];return t.forEach(t=>{e.includes(t.index)?i.push(t):n.push(t)}),{tracksToRemove:i,tracksToKeep:W(n)}}(e.tracks,n),r=i.tracksToKeep,s=i.tracksToRemove;(function(t){t.forEach(o)})(t),a=e.id,c=n[0],Array.from(Ti(a).children).slice(c).forEach((t,e)=>{const n=t.querySelector(".list-item-index"),i=c+e;n&&(n.textContent=i+1),t.setAttribute("data-index",i)}),x(e.id,{playbackOrder:U(r,g("shuffle")),tracks:r}),_(e.id),Wt(e.id,r),r.length||(fe(),Vi(e));var a,c;Gi({action:"remove-tracks",playlist:{_id:e._id,tracks:s}})}(),ve())}function xe(){return Array.from(re.querySelectorAll(".track.selected"))}function Be(t){return t.map(t=>parseInt(t.getAttribute("data-index"),10))}n(57);const Ae=document.getElementById("js-filter-input"),Se=Ae.parentElement;let Oe=0,Me="";function Re(t,e,n){const i=new RegExp(n,"i");t.forEach(t=>{const n=e[t.index],o=`\n            ${t.title}\n            ${t.artist}\n            ${t.album}\n        `;n.classList.toggle("hidden",!i.test(o))})}function Ce(t,e=""){const n=j(t).tracks;if(!n.length)return;const i=Ti(t).children;var o;Me=e?t:"",Re(n,i,e),o=e,document.getElementById("js-clear-input-btn").classList.toggle("visible",o)}function He(){Me&&(Ae.value="",Ce(Me))}function Pe(){Se.classList.remove("active"),Ae.removeEventListener("keyup",_e),Ae.removeEventListener("blur",Pe)}function _e({target:t}){const e=vi();clearTimeout(Oe),Oe=setTimeout(Ce,400,e,t.value)}function Ve(t){document.getElementById("js-order-toggle").querySelector("use").setAttribute("href",`#${1===t?"down":"up"}-arrow`)}function De(t,e){return"index"===t?e.primaryIndex:"duration"===t?e.durationInSeconds:e[t].toLowerCase()}function Ue(t,e,n){t.sort((t,i)=>{const o=De(e,t),r=De(e,i);return o<r?-n:o>r?n:0})}function qe(t,e){const n=document.getElementById("js-filter-input").value,i=t.sortedBy===e&&1===t.order?-1:1;if(Ue(t.tracks,e,i),x(t.id,{order:i,sortedBy:e,tracks:W(t.tracks)}),Gi({action:"change-sorting",playlist:{order:i,_id:t._id,sortedBy:e}}),_(t.id),Vi(t),n){const e=Ti(t.id).children;Re(t.tracks,e,n)}}function We({sortedBy:t,order:e}){var n;n=t,document.getElementById("js-sort-toggle").textContent=n,Ve(e)}function Ne(t,{sortedBy:e}){document.getElementById("js-sort-panel-container").insertAdjacentHTML("beforeend",function(t,e){return`<ul id="${t}" class="panel sort-panel">${function(t){return["index","name","title","artist","album","duration"].reduce((e,n)=>{const i=n===t?" active":"";return`\n            ${e}\n            <li>\n                <button class="btn-icon sort-option-btn${i}" data-sort="${n}">\n                    ${n}\n                </button>\n            </li>\n        `},"")}(e)}</ul>`}(t,e)),document.getElementById(t).addEventListener("click",Xe)}function Xe({currentTarget:t,target:e}){const n=e.getAttribute("data-sort"),i=bi();t.removeEventListener("click",Xe),X(),n!==i.sortedBy&&(We({sortedBy:n,order:1}),qe(i,n))}Ae.addEventListener("focus",({currentTarget:t})=>{Se.classList.add("active"),t.addEventListener("keyup",_e),t.addEventListener("blur",Pe)}),Se.addEventListener("click",({target:t})=>{const e=s("data-filter-item",t);if(!e)return;const n=e.attrValue;"icon"===n?Ae.focus():"button"===n&&(He(),Pe())});const ze=document.getElementById("js-volume-slider"),Ye=document.getElementById("js-track-slider"),Je=document.getElementById("js-controls");let Ke=!1;const Fe=function(){let t=0;function e(){clearTimeout(t)}function n(e,i,o){const r=performance.now()-i-o;Ke||dn(e,e.currentTime),Qn.updateTrack({currentTime:e.currentTime}),e.currentTime<=e.durationInSeconds?(e.currentTime+=1,o+=1e3,t=setTimeout(n,1e3-r,e,i,o)):l("track-end")}return{stop:e,start:function(t){const i=performance.now();e(),n(t,i,0)}}}();function Ze(t){const e=xi(t);e&&e.classList.add("show-spinner"),document.getElementById("js-play-btn").classList.add("show-spinner")}function Ge(t){const e=xi(t);e&&e.classList.remove("show-spinner"),document.getElementById("js-play-btn").classList.remove("show-spinner")}function Qe(t){return t?{id:"play",title:"Play"}:{id:"pause",title:"Pause"}}function tn(t,e){u(t,Qe(e))}function en(t,e){const n={on:{id:"volume-off",title:"Unmute"},off:{id:"volume",title:"Mute"}};u(t,e?n.on:n.off)}function nn(t,e){const n=document.getElementById(`js-${t}-slider`).getBoundingClientRect();let i=(e-n.left)/n.width*100;return i<0?i=0:i>100&&(i=100),i}function on(){Fe.stop(),dn()}function rn(t){y("volume",t),un(t),function(t){const e=P()||{};"native"===e.player?_n(t):"youtube"===e.player&&Zn(t)}(t)}function sn(t,e){const n=e/2;return t+n+8>window.innerWidth||t-n-8<0}function an(t,e){return`calc(${t}% - ${e}px)`}function cn(t,e){const n=document.getElementById("js-volume-slider-label");n.textContent=`${Math.floor(t)}%`;const i=n.offsetWidth;sn(e,i)||(n.style.left=an(t,i/2))}function ln(t,e){document.getElementById(`js-${t}-slider-thumb`).style.left=`${100*e}%`,document.getElementById(`js-${t}-slider-elapsed`).style.transform=`scaleX(${e})`}function dn(t,e=0){const n=c(e),i=t?t.durationInSeconds:1,o=t?t.duration:n;Ke||(document.getElementById("js-track-current").textContent=n),ln("track",e/i),Ye.setAttribute("aria-valuenow",e),Ye.setAttribute("aria-valuetext",`${n} of ${o}`)}function un(t){const e=Math.floor(100*t);ln("volume",t),ze.setAttribute("aria-valuenow",e),ze.setAttribute("aria-valuetext",`${e}% volume`)}function mn(t="0:00",e=0){document.getElementById("js-track-duration").textContent=t,Ye.setAttribute("aria-valuemax",e)}function fn(t,e){const n=nn("track",t);return{percent:n,currentTime:Math.floor(e*n/100)}}function pn(t,e,n){const i=document.getElementById("js-track-slider-label");i.textContent=c(e);const o=i.offsetWidth;sn(n,o)||(i.style.left=an(t,o/2))}function yn({pageX:t}){const e=P(),n=fn(t,e.durationInSeconds),i=n.percent,o=n.currentTime;dn(e,o),pn(i,o,t)}function gn({pageX:t}){const e=P();if(!e)return;const n=fn(t,e.durationInSeconds);pn(n.percent,n.currentTime,t)}function vn({pageX:t}){const e=P();if(Ke=!1,e){const n=fn(t,e.durationInSeconds).currentTime;dn(e,n),mi(e.player,n),Qn.updateTrack({currentTime:n})}window.removeEventListener("mousemove",yn),window.removeEventListener("mouseup",vn),Ye.addEventListener("mousemove",gn)}function bn({pageX:t}){const e=nn("volume",t),n=e/100;n!==g("volume")&&(cn(e,t),n?(In(),rn(n)):wn({attrValue:"mute",elementRef:document.getElementById("js-volume-btn")}))}function hn({pageX:t}){cn(nn("volume",t),t)}function kn(){window.removeEventListener("mousemove",bn),window.removeEventListener("mouseup",kn),ze.addEventListener("mousemove",hn)}function wn({attrValue:t,elementRef:e}){const n=!g(t);e.classList.toggle("active"),e.setAttribute("aria-checked",n),y(t,n),"mute"===t&&(!function(t){const e=t?0:g("volumeBeforeMute");t?y("volumeBeforeMute",g("volume")):v("volumeBeforeMute");rn(e)}(n),en(e,n))}function In(){const t=g("mute");if(t){const e=document.getElementById("js-volume-btn");v("volumeBeforeMute"),y("mute",!t),en(e,!t),e.classList.remove("active")}}function En(t){return function({pageX:e}){const n=document.getElementById(`js-${t}-slider-label`),i=window.innerWidth,o=n.offsetWidth/2;if(e+o+8>i){const e=nn(t,i-o-8);n.style.left=an(e,o)}else if(e-o-8<0){const e=nn(t,o+8);n.style.left=an(e,o)}}}Ye.addEventListener("mousedown",t=>{1===t.which&&P()&&(Ke=!0,yn(t),Ye.removeEventListener("mousemove",gn),window.addEventListener("mousemove",yn),window.addEventListener("mouseup",vn))}),Ye.addEventListener("mousemove",gn),Ye.addEventListener("mouseenter",En("track")),Ye.addEventListener("keydown",({which:t})=>{const e=P();if(!e||t<37||t>40)return;const n=e.durationInSeconds;let i=Qn.getTrack().currentTime;38===t||39===t?(i+=5)>n&&(i=n):37!==t&&40!==t||(i-=5)<0&&(i=0),dn(e,i),mi(e.player,i),Qn.updateTrack({currentTime:i})}),ze.addEventListener("mousedown",t=>{1===t.which&&(bn(t),ze.removeEventListener("mousemove",hn),window.addEventListener("mousemove",bn),window.addEventListener("mouseup",kn))}),ze.addEventListener("mousemove",hn),ze.addEventListener("mouseenter",En("volume")),ze.addEventListener("keydown",({which:t})=>{let e=g("volume");if(38===t||39===t)(e+=.05)>1&&(e=1),In();else if(e&&(37===t||40===t)&&(e-=.05)<=0)return e=0,void wn({attrValue:"mute",elementRef:document.getElementById("js-volume-btn")});rn(e)}),document.getElementById("js-main-controls").addEventListener("click",({target:t})=>{const e=s("data-item",t);if(e)switch(e.attrValue){case"previous":si("direction",-1,M());break;case"play":!function(){const t=P();if(!t)return void si("direction",0,vi());oi(t)}();break;case"next":ai()}}),Je.addEventListener("click",({target:t})=>{const e=s("data-item",t);e&&wn(e)}),Je.addEventListener("keyup",({which:t,target:e})=>{const n=s("data-item",e);!n||32!==t&&13!==t||wn(n)}),document.getElementById("js-control-toggle-btn").addEventListener("click",()=>{Je.classList.toggle("visible")}),un(g("volume")),Array.from(document.querySelectorAll(".control-btn")).forEach(t=>{const e=t.getAttribute("data-item"),n=g(e);n&&(t.classList.add("active"),t.setAttribute("aria-checked",!0),"mute"===e&&en(t,n))});const Ln=document.getElementById("js-now-playing"),$n=document.getElementById("js-media-container"),jn={};let Tn,xn,Bn=null;function An({target:t}){const e=t.getAttribute("data-element");if(!e)return;jn[e]=jn[e]||{};const n=jn[e];if(n.target)return n.loopedOnce=!1,n.isHovering=!0,void t.classList.add("moving");n.timeoutId&&clearTimeout(n.timeoutId);const i=t.scrollWidth,o=t.offsetWidth;i>o&&(n.timeoutId=setTimeout(()=>{t.classList.add("moving"),n.target=t,n.isHovering=!0,function t(e,n,i,o=0){const r=jn[e];if(Math.abs(o)<n+10){if(0==(o-=1)&&!r.isHovering&&r.loopedOnce)return r.target.style.transform="translateX(0)",r.target.removeEventListener("mouseleave",Sn),void delete jn[e]}else o=i,r.loopedOnce=!0,r.target.classList.remove("moving");r.target.style.transform=`translateX(${o}px)`,requestAnimationFrame(()=>{t(e,n,i,o)})}(e,i,o)},500),n.mouseLeaveAdded||(n.mouseLeaveAdded=!0,t.addEventListener("mouseleave",Sn)))}function Sn({currentTarget:t}){const e=jn[t.getAttribute("data-element")];e.target?e.isHovering=!1:(clearTimeout(e.timeoutId),e.mouseLeaveAdded=!1,t.removeEventListener("mouseleave",Sn))}function On(t){27===t.which&&($n.classList.remove("visible"),window.removeEventListener("keydown",On))}function Mn(){const t=document.getElementById("js-track-info");t&&(t.removeEventListener("mousemove",An),o(t))}function Rn(t="./assets/images/album-art-placeholder.png"){document.getElementById("js-artwork").src=t}function Cn(t,e){Rn(),Mn(),function(t,e){Rn(e),Ln.classList.remove("inactive"),Ln.insertAdjacentHTML("beforeend",function(t,e){let n=`<div class="track-info-item" data-element="name">${t.name}</div>`;return t.artist&&t.title&&(n=`\n            <div class="track-info-item track-title" data-element="title">${t.title}</div>\n            <div class="track-info-item" data-element="artist">${t.artist} ${t.album?`- ${t.album}`:""}</div>\n        `),`<div id="${e}" class="track-info fade-left fade-right">${n}</div> `}(t,"js-track-info")),document.getElementById("js-track-info").addEventListener("mousemove",An)}(t,e)}function Hn(t){Bn&&URL.revokeObjectURL(Bn),Cn(t,Bn=d(t.thumbnail)),function(t,e){const n=document.getElementById("js-yt-player");if("youtube"===t.player)n.classList.remove("hidden");else{const t=document.getElementById("js-media-image");n.classList.add("hidden"),t.src=e}}(t,Bn)}function Pn(){document.title="Veery",Rn(),Mn(),Ln.classList.add("inactive"),$n.classList.remove("visible"),Bn&&(URL.revokeObjectURL(Bn),Bn=null)}function _n(t){xn.volume=t}function Vn(t){xn.currentTime=t}$n.addEventListener("click",function({target:t}){const e=s("data-item",t);e&&"image"===e.attrValue&&oi(P())}),document.getElementById("js-expand-media-btn").addEventListener("click",function(){$n.classList.toggle("visible"),$n.classList.contains("visible")?window.addEventListener("keydown",On):window.removeEventListener("keydown",On)});const Dn=1,Un=2,qn=3,Wn=-1;let Nn=!1,Xn=null,zn=null;function Yn({data:t}){const e=P();if(!e||"youtube"!==e.player)return;const n=document.getElementById("js-yt-player"),i=ti()?Un:Dn;if(document.activeElement===n&&(t===Dn&&i===Un||t===Un&&i===Dn))return n.blur(),i===Un&&l("track-start",Xn.getCurrentTime()),void ei(e);if(t===Dn){if(i===Un)return void Xn.pauseVideo();l("track-start",Xn.getCurrentTime())}else t===Un&&i===Dn?Xn.playVideo():t===qn?(Fe.stop(),Ze(e)):Ge(e)}function Jn(){Nn=!0,Fn(...zn),zn=null}function Kn(t){if(console.log(t),t.data>=100){const t=P();di(t),nt({title:`Cannot play ${t.name}`,body:"It is either removed or marked as private"})}}function Fn(t,e,n){if(Nn)return Zn(e),void Xn.loadVideoById(t.id,n);zn=[t,e,n],i.load({src:"https://www.youtube.com/iframe_api"})}function Zn(t){Xn.setVolume(100*t)}window.onYouTubeIframeAPIReady=function(){Xn=new YT.Player("js-yt-player",{playerVars:{autoplay:0,disablekb:1,controls:0,fs:0,iv_load_policy:3},events:{onReady:Jn,onStateChange:Yn,onError:Kn}})};let Gn=!0;const Qn=function(){function t(){return JSON.parse(localStorage.getItem("track"))||{}}function e(t){localStorage.setItem("track",JSON.stringify(t))}function n(){localStorage.removeItem("track")}return{getTrack:t,removeTrack:n,saveTrack:e,updateTrack:function(n){e(Object.assign(t(),n))},initTrack:function(){const e=t();if(!e)return;const i=C(V(e.playlistId,e.name));i?(ri(i,{startTime:e.currentTime}),dn(i,e.currentTime)):n()}}}();function ti(){return Gn}function ei(t,e){(Gn="boolean"==typeof e?e:!Gn)&&(F(),Fe.stop()),ii(t,Gn),fi()}function ni(t,{scrollToTrack:e,startTime:n}){const i=B(t.playlistId).rendered;Hn(t),mn(t.duration,t.durationInSeconds),Ye.classList.add("visible"),O(t.playlistId),D(t.index),H(t),i&&-1!==t.index&&qi(t,e),void 0===n?(Gn=!1,fi(),Ze(t),ii(t,Gn)):Gn=!0}function ii(t,e){tn(document.getElementById("js-play-btn"),e),Wi(t,e)}function oi(t){"native"===t.player?Gn?xn.play():xn.pause():"youtube"===t.player&&function(t){if(!Nn)return;const e=Xn.getPlayerState();e!==qn&&e!==Wn&&(t?Xn.playVideo():Xn.pauseVideo())}(Gn),ei(t)}function ri(t,e={}){const n=g("volume");ni(t,e),"native"===t.player?function(t,e,n){Tn=URL.createObjectURL(t),(xn=new Audio(Tn)).onplaying=function(){l("track-start",xn.currentTime)},_n(e),"number"!=typeof n?xn.play():Vn(n)}(t.audioTrack,n,e.startTime):"youtube"===t.player&&Fn(t,n,e.startTime)}function si(t,e,n){const i=j(n);if(!i)return;const o=g("shuffle"),r=P(),s=B(n).shuffled;let a=!1;if(r&&(Ui(r.element),on(),Wi(r,!0),li(r)),s!==o&&(a=!0,q(i,o)),"index"===t)!a&&o&&q(i,o),ri(C(i.tracks[e]));else if("direction"===t){const t=function(t,e){const n=function({playbackIndex:t,playbackOrder:e},n){return t+=n,!n||t>=e.length?t=0:-1===t&&(t=e.length-1),e[t]}(t,e);return C(t.tracks[n])}(i,e);t?ri(t,{scrollToTrack:!0}):ui(r)}}function ai(){si("direction",1,M())}function ci({currentTarget:t,detail:e,target:n}){const i=vi(),o=s("data-btn",n,t),r=s("data-index",n,t);if(2===e&&r&&!o)si("index",r.attrValue,i);else if(o){const t=parseInt(r.attrValue,10),e=P();e&&e.playlistId===i&&t===e.index?oi(e):si("index",t,i)}}function li(t){"native"===t.player?(xn.pause(),xn.currentTime=0,xn=null,Tn&&(URL.revokeObjectURL(Tn),Tn=null)):"youtube"===t.player&&function(t){Nn&&(Ge(t),Xn.stopVideo())}(t)}function di(t){t&&li(t),ui(t)}function ui(t){Gn=!0,Qn.removeTrack(),mn(),Ye.classList.remove("visible"),Pn(),H(),O(),F(),t&&(Ui(t.element),on(),Ge(t),ii(t,Gn))}function mi(t,e){Fe.stop(),"native"===t?Vn(e):"youtube"===t&&function(t){Xn.seekTo(t,!0)}(e)}function fi(t=vi()){const e=ti(),n=j(t);let i="Veery";if(e)n&&(i=`${n.title} | ${i}`);else{const t=P(),e=t.artist,n=t.name,o=t.title;i=`${e&&o?`${e} - ${o}`:n} | ${i}`}document.title=i}window.addEventListener("track-start",({detail:t})=>{const e=P();!function(t){const e=K(t);F(),e.insertAdjacentHTML("beforeend",f({iconId:"volume",elementId:"js-active-playlist-icon",className:"active-playlist-icon"}))}(e.playlistId),Qn.saveTrack({name:e.name,playlistId:e.playlistId}),Fe.start({currentTime:Math.floor(t),duration:e.duration,durationInSeconds:e.durationInSeconds}),Ge(e)}),window.addEventListener("track-end",()=>{const t=P();g("once")?di(t):(Qn.removeTrack(),g("repeat")?ri(t):ai())});const pi=document.getElementById("js-tab-header"),yi=matchMedia("(max-width: 540px)");let gi="";function vi(){return gi}function bi(){return j(gi)}function hi(t){return document.getElementById(`js-tab-${t}`)}function ki(t){const e=j(t);B(t).rendered||function(t){const e=function(t){const e=Pi(t);return`<div id="js-tab-${t.id}" class="tab">${e}</div>`}(t);document.getElementById("js-tabs").insertAdjacentHTML("beforeend",e),A(t.id,{rendered:!0}),t.tracks.length&&(_i(t.id),Ei(t.id))}(e),"list"===e.type&&yi.matches?Xi("grid",e):Ni(e.type),We(e),function({id:t,tracks:e}){re&&fe(),e.length&&(re=hi(t)).addEventListener("mousedown",je)}(e),He(),e.tracks.length&&hi(t).addEventListener("click",ci)}pi.addEventListener("click",({currentTarget:t,target:e})=>{const n=s("data-item",e,t);if(!n)return;const i=bi(),o=n.attrValue;"move-to"===o?Y("js-move-to-panel",ne,{playlistId:i.id,element:n.elementRef}):"list"!==o&&"grid"!==o||o===i.type?"sorting"===o?Y("js-sort-panel",Ne,{sortedBy:i.sortedBy,element:n.elementRef}):"order"===o&&i.sortedBy?function(t){qe(t,t.sortedBy),Ve(t.order)}(i):"sidebar"===o&&document.getElementById("js-sidebar-container").classList.remove("hidden"):Xi(o,i)}),window.addEventListener("route-change",({detail:{isPlaylistTab:t,tabId:e}})=>{const n=hi(gi);r(".sidebar-entry.active","active"),r(".tab.active","active"),function(t=""){gi=t}(t?e:""),n&&n.removeEventListener("click",ci),t?(ki(e),pi.classList.add("playlist-tab-active")):pi.classList.remove("playlist-tab-active"),fi(e),hi(e).classList.add("active"),"not-found"!==e&&K(e).classList.add("active")}),yi.onchange=function({matches:t}){const e=bi();t&&e&&"list"===e.type&&Xi("grid",e)};const wi={};function Ii(t){t.forEach(({isIntersecting:t,target:e})=>{t?function(t){const e=bi(),n=e.tracks,i=e.type,o=n[t.getAttribute("data-index")],r=P(),s=ti(),a=r&&r.index===o.index?Qe(s):Qe(!0);t.innerHTML="list"===i?Si(o,a):Ri(o,a)}(e):e.childElementCount&&function(t){const e=t.querySelector(".artwork");e&&URL.revokeObjectURL(e.src),t.innerHTML=""}(e)})}function Ei(t){if(!IntersectionObserver||wi[t])return;wi[t]=new IntersectionObserver(Ii,{root:hi(t)});const e=Ti(t).children;$i(t,Array.from(e))}function Li(t){wi[t]&&ji(t),Ei(t)}function $i(t,e){e.forEach(e=>{wi[t].observe(e)})}function ji(t){wi[t]&&(wi[t].disconnect(),delete wi[t])}function Ti(t){return document.getElementById(`js-${t}`)}function xi({element:t,index:e}){if(-1!==e&&t)return t.querySelector(".btn-icon")}function Bi(t){return Ai(t,Si(t,{id:"play",title:"Play"}))}function Ai({index:t},e=""){return`<li class="list-item track" data-index="${t}" tabindex="0">${e}</li>`}function Si(t,{title:e,id:n}){return`\n        <span class="list-item-first-col">\n            <span class="list-item-index">${t.index+1}</span>\n            <button class="btn-icon track-play-pause-btn" data-btn="play" title="${e}">\n                ${f({iconId:n})}\n            </button>\n        </span>\n        <span class="list-item-col fade-right">${t.title}</span>\n        <span class="list-item-col fade-right">${t.artist}</span>\n        <span class="list-item-col fade-right">${t.album}</span>\n        <span class="list-item-last-col">${t.duration}</span>\n    `}function Oi(t){return Mi(t,Ri(t,{id:"play",title:"Play"}))}function Mi({index:t},e=""){return`<li class="grid-item track" data-index="${t}" tabindex="0">${e}</li>`}function Ri(t,{title:e,id:n}){return`\n        <div class="artwork-container grid-item-thumbnail" tabindex="-1">\n            <button class="btn-icon track-play-pause-btn artwork-container-btn" data-btn="play" title="${e}">\n                ${f({iconId:n})}\n            </button>\n            <img src="${d(t.thumbnail)}" class="artwork" alt="">\n        </div>\n        ${function(t){let e=t.name;t.artist&&t.title&&(e=`\n            <div class="track-title">${t.title}</div>\n            <div>${t.artist} ${t.album?`- ${t.album}`:""}</div>\n        `);return`<div class="track-info fade-right">${e}</div> `}(t)}\n        <div class="grid-item-duration">${t.duration}</div>\n    `}function Ci(){let t=Bi,e=Oi;return"IntersectionObserver"in window&&(t=Ai,e=Mi),{listItemCb:t,gridItemCb:e}}function Hi(t,e){return t.reduce((t,n)=>t+e(n),"")}function Pi(t){return t.tracks.length?function({id:t,type:e,tracks:n}){const i=Ci(),o=i.listItemCb,r=i.gridItemCb;return"list"===e?function(t,e){return`\n        <ul class="list-view-header">\n            <li class="list-item-first-col">#</li>\n            <li>Title</li>\n            <li>Artist</li>\n            <li>Album</li>\n            <li class="list-item-last-col">Duration</li>\n        </ul>\n        <ul id="js-${t}" class="playlist-view">${e}</ul>\n    `}(t,Hi(n,o)):function(t,e){return`<ul id="js-${t}" class="playlist-view grid-view">${e}</ul>`}(t,Hi(n,r))}(t):'<p class="playlist-message">This playlist is empty</p>'}function _i(t){const e=P();e&&e.playlistId===t&&-1!==e.index&&qi(e,!0)}function Vi(t){hi(t.id).innerHTML=Pi(t),t.tracks.length?(_i(t.id),Li(t.id)):ji(t.id)}function Di(t){t.element=document.getElementById(`js-${t.playlistId}`).children[t.index],t.element.classList.add("playing")}function Ui(t){t&&t.classList.remove("playing")}function qi(t,e){Di(t),e&&function(t,e){const n=hi(e),i=t.offsetHeight,o=t.offsetTop,r=n.clientHeight,s=n.scrollTop,a=s+r;(o-i<s||o>a)&&(n.scrollTop=o-r/2)}(t.element,t.playlistId)}function Wi(t,e){const n=xi(t);n&&tn(n,e)}function Ni(t){const e=document.getElementById("js-list-toggle-btn"),n=document.getElementById("js-grid-toggle-btn");"list"===t?(e.classList.add("active"),n.classList.remove("active")):(n.classList.add("active"),e.classList.remove("active"))}function Xi(t,e){x(e.id,{type:t}),Gi({action:"change-type",playlist:{_id:e._id,type:t}}),Vi(e),Ni(t)}function zi(t){q(t,g("shuffle")),Ue(t.tracks,t.sortedBy,t.order),t.tracks=W(t.tracks)}function Yi(t){var e,n,i;A(t.id,{initialized:!0}),e=t.title,n=t.id,document.getElementById("js-sidebar-entries").insertAdjacentHTML("beforeend",`\n        <li id="js-sidebar-entry-${n}" class="sidebar-entry">\n            <a href="./#/playlist/${n}" class="sidebar-link" data-link>\n                <div class="fade-right">${e}</div>\n            </a>\n        </li>\n    `),function(t){const e=Pt(),n=S(t.tracks),i=t.url?_t({action:"sync",title:"Synchronize playlist",iconId:"sync"}):"",o=t.url?`\n        <div class="pl-entry-panel-container">\n            ${_t({action:"settings",title:"Settings",iconId:"settings"})}\n        </div>\n    `:"",r=_t({action:"remove",title:"Remove playlist",iconId:"trash"}),s=f({iconId:"edit",className:"pl-entry-input-icon"}),a=t.storageDisabled?f({iconId:"alert",className:"pl-entry-stats-item",title:"This playlist will not persist through reload"}):"",c=t.isPrivate?f({iconId:"lock",className:"pl-entry-stats-item",title:"Private"}):"";e.insertAdjacentHTML("beforeend",`\n        <li class="pl-entry" data-entry-id=${t.id}>\n            <div class="pl-entry-thumbnail">${Dt(t.tracks)}</div>\n            <div class="pl-entry-content">\n                <div class="pl-entry-input-container" data-action="edit">\n                    <input type="text" class="input pl-entry-input" value="${t.title}">\n                    ${s}\n                </div>\n                <div class="pl-entry-footer">\n                    <div class="pl-entry-stats">\n                        ${a}\n                        ${c}\n                        <span class="pl-entry-stats-item track-count">${t.tracks.length} tracks</span>\n                        <span class="pl-entry-stats-item playlist-duration">${Vt(n)}</span>\n                    </div>\n                    ${i}\n                    ${o}\n                    ${r}\n                </div>\n            </div>\n        </li>\n    `)}(t),zi(t),k(i=`playlist/${t.id}`)||h.push(i)}function Ji(t,e){const n=B(t.id),i=n.initialized,o=n.rendered;e.length&&(e=function(t,e=0){return t.map((t,n)=>(t.primaryIndex=e+n,t))}(e,t.lastTrackIndex),t.lastTrackIndex=e[e.length-1].primaryIndex+1,t.tracks=t.tracks.concat(e)),i?(zi(t),_(t.id),Wt(t.id,t.tracks),o&&(e.length?function(t,e){const n=P(),i=Ti(t.id);if(i){const n=Ci(),o=n.listItemCb,r=n.gridItemCb,s=Hi(e,"list"===t.type?o:r);i.insertAdjacentHTML("beforeend",s),$i(t.id,[...i.children].slice(-e.length))}else hi(t.id).innerHTML=Pi(t),Li(t.id);n&&n.playlistId===t.id&&(Ui(n.element),Di(n))}(t,e):Vi(t)),Gi({action:"add-tracks",playlist:{_id:t._id,lastTrackIndex:t.lastTrackIndex,tracks:e}})):(Yi(t),Gi({action:"add",playlist:t}))}function Ki(t){const e=T({title:t.target.title.value,id:Math.random().toString(36).slice(2),type:"grid"});Yi(e),Gi({action:"add",playlist:e}),t.preventDefault(),t.target.reset()}function Fi(t,e,n,i){e.insertAdjacentHTML(n,`\n        <form id="js-${t}-form" class="${t}-form">\n            <input type="text" name="title" class="input" autocomplete="off" placeholder="Playlist title" required>\n            <button class="btn">Create</button>\n        </form>\n    `);const o=document.getElementById(`js-${t}-form`);o.elements.title.focus(),o.addEventListener("submit",i)}"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("./sw.js").then(t=>{t.onupdatefound=(()=>{const e=t.installing;e.onstatechange=(()=>{"installed"===e.state&&navigator.serviceWorker.controller&&l("sw-state-change","update")})})}).catch(console.log)});const Zi=new Worker("./ww.js");function Gi(t){t.playlist.storageDisabled||("add"===t.action||t.playlist._id)&&Zi.postMessage(t)}Zi.onmessage=function({data:{action:t,payload:e}}){"init"===t?(e.forEach(t=>{Yi(T(t))}),zt(e.filter(t=>t.syncOnInit)),Qn.initTrack(),w()):"update"===t&&x(e.id,e)},Zi.onerror=function(t){console.log(t)}}});