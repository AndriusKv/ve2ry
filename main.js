!function(t){function e(e){for(var i,r,a=e[0],l=e[1],c=e[2],u=0,m=[];u<a.length;u++)r=a[u],o[r]&&m.push(o[r][0]),o[r]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(t[i]=l[i]);for(d&&d(e);m.length;)m.shift()();return s.push.apply(s,c||[]),n()}function n(){for(var t,e=0;e<s.length;e++){for(var n=s[e],i=!0,a=1;a<n.length;a++){var l=n[a];0!==o[l]&&(i=!1)}i&&(s.splice(e--,1),t=r(r.s=n[0]))}return t}var i={},o={0:0},s=[];function r(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.e=function(t){var e=[],n=o[t];if(0!==n)if(n)e.push(n[2]);else{var i=new Promise(function(e,i){n=o[t]=[e,i]});e.push(n[2]=i);var s,a=document.getElementsByTagName("head")[0],l=document.createElement("script");l.charset="utf-8",l.timeout=120,r.nc&&l.setAttribute("nonce",r.nc),l.src=function(t){return r.p+""+({}[t]||t)+".js"}(t),s=function(e){l.onerror=l.onload=null,clearTimeout(c);var n=o[t];if(0!==n){if(n){var i=e&&("load"===e.type?"missing":e.type),s=e&&e.target&&e.target.src,r=new Error("Loading chunk "+t+" failed.\n("+i+": "+s+")");r.type=i,r.request=s,n[1](r)}o[t]=void 0}};var c=setTimeout(function(){s({type:"timeout",target:l})},12e4);l.onerror=l.onload=s,a.appendChild(l)}return Promise.all(e)},r.m=t,r.c=i,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r.oe=function(t){throw console.error(t),t};var a=window.webpackJsonp=window.webpackJsonp||[],l=a.push.bind(a);a.push=e,a=a.slice();for(var c=0;c<a.length;c++)e(a[c]);var d=l;s.push([64,1]),n()}({35:function(t,e,n){},36:function(t,e,n){},64:function(t,e,n){"use strict";n.r(e);n(34),n(35),n(36),n(0);const i=function(){const t=[];return{load:function(e){return t.includes(e.src)?Promise.resolve():new Promise(n=>{const i=document.createElement("script");Object.keys(e).forEach(t=>{i.setAttribute(t,e[t])}),document.getElementsByTagName("body")[0].appendChild(i),t.push(e.src),i.onload=n})}}}();function o(t){t.parentElement.removeChild(t)}function s(t,e){const n=document.querySelector(t);n&&n.classList.remove(e)}function r(t,e,n){for(void 0===n&&(n=null);e&&e!==n;){if(e.hasAttribute(t))return{elementRef:e,attrValue:e.getAttribute(t)};e=e.parentElement}}function a(t,e){return!!e&&!e.contains(t)}function l(t,e){return void 0===e&&(e=!0),e&&t<10?`0${t}`:t}function c(t,e){void 0===e&&(e=!1);const n=function(t){return Math.floor(t/3600)}(t),i=function(t){return Math.floor(t/60%60)}(t),o=function(t){return t%60}(t);return`${(e=e||n)?`${n}:`:""}${l(i,e)}:${l(o)}`}function d(t,e){const n=new CustomEvent(t,{detail:e});window.dispatchEvent(n)}function u(t){return"object"==typeof t?URL.createObjectURL(t):t}function m(t,e){let n=e.id,i=e.title;t.setAttribute("title",i),t.querySelector("use").setAttribute("href",`#${n}`)}function f(t){let e=t.length;for(;e;){const i=Math.floor(Math.random()*e);e-=1;var n=[t[i],t[e]];t[e]=n[0],t[i]=n[1]}return t}function p(t){return`\n        <svg viewBox="0 0 24 24" ${t.elementId?`id=${t.elementId}`:""} ${t.className?`class="${t.className}"`:""}>\n            ${t.title?`<title>${t.title}</title>`:""}\n            <use href="#${t.iconId}"></use>\n        </svg>\n    `}const y=Object.assign({repeat:!1,shuffle:!1,once:!1,mute:!1,volume:.4},JSON.parse(localStorage.getItem("settings"))||{});function v(t,e){y[t]=e,h(y)}function g(t){return y[t]}function b(t){delete y[t],h(y)}function h(t){localStorage.setItem("settings",JSON.stringify(t))}n(21),n(53);let w=[];function k(t){return w.some(e=>e===t)}function I(){const t=window.location.hash.slice(2).replace(/\/+$/g,"");let e=!1,n="home";d("route-change",{tabId:n=t&&!k(t)?"not-found":(e=t.startsWith("playlist/"))?t.split("playlist/")[1]:n,isPlaylistTab:e})}window.addEventListener("hashchange",I);const E={},L={};let $="",j=null,T=-1,x=[];function B(t){return E[t]}function A(t){return L[t.id]={},E[t.id]=Object.assign({sortedBy:"index",order:1,tracks:[],lastTrackIndex:0},t),E[t.id]}function S(t,e){Object.assign(E[t],e)}function M(t){return L[t]}function O(t,e){return L[t]=Object.assign({},L[t],e),L[t]}function R(t){return t.reduce((t,e)=>t+=e.durationInSeconds,0)}function C(t){void 0===t&&(t=""),$=t}function H(){return $}function P(t){return t===$}function _(t){return t?Object.assign({},t):null}function D(t){j=t}function V(){return j}function U(t){const e=V();if(e&&P(t)){const i=q(t,e.name);let o=-1;i&&(o=i.index),n={index:o},Object.assign(j,n),W(o)}var n}function q(t,e){const n=E[t];return n?n.tracks.find(t=>t.name===e):null}function W(t){T=(T=x.indexOf(t))<0?0:T}function N(t,e){const n=E[t].tracks;L[t].shuffled=e,x=function(t,e){const n=t.map((t,e)=>e);return e?f(n):n}(n,e),function(){const t=V();t&&W(t.index)}()}function z(t,e){const n=function(t){let e=T;return e+=t,!t||e>=x.length?e=0:-1===e&&(e=x.length-1),x[e]}(e);return _(E[t].tracks[n])}function X(t){return t.map((t,e)=>(t.index=e,t))}n(54);let Y=null;function J(){window.removeEventListener("click",Z,!0),o(Y.element),Y=null}function K(t,e,n){e(t,n),Y={id:t,element:document.getElementById(t),removeOnClick:n.removeOnClick,initiator:n.element},window.addEventListener("click",Z,!0)}function F(t,e,n){if(Y){const i=Y.id;J(),i!==t&&K(t,e,n)}else K(t,e,n)}function Z(t){let e=t.target;if(Y.removeOnClick)return void J();const n=a(e,Y.element),i=a(e,Y.initiator);n&&i&&J()}function G(t){return document.getElementById(`js-sidebar-entry-${t}`)}function Q(){const t=document.getElementById("js-active-playlist-icon");t&&o(t)}function tt(t,e){e.element.insertAdjacentHTML("afterend",`\n        <div id="${t}" class="panel sidebar-form-panel"></div>\n    `),Gi("sidebar",document.getElementById(t),"beforeend",Zi)}document.getElementById("js-sidebar-container").addEventListener("click",t=>{let e=t.currentTarget,n=t.target;if(r("data-link",n,e)||a(n,e.firstElementChild))return void e.classList.add("hidden");const i=r("data-btn",n,e);i&&F("js-sidebar-form-panel",tt,{element:i.elementRef})}),window.addEventListener("connectivity-status",t=>{let e=t.detail;document.getElementById("js-online-status").classList.toggle("visible",!e)});let et=!1,nt=!1;async function it(){if(et||nt)return;const t=document.getElementById("js-google-sign-in-or-out-btn");nt=!0,t.disabled=!0;try{await i.load({src:"https://apis.google.com/js/api.js"}),await new Promise(t=>gapi.load("client:auth2",t)),await gapi.client.init({apiKey:"AIzaSyD33Rxm4dA34Mh84oSxYTUUF_jyCLLOua4",clientId:"293076144560-r5cear7rprgo094u6ibcd6nl3bbg18te.apps.googleusercontent.com",discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest"],scope:"https://www.googleapis.com/auth/youtube.force-ssl"}),gapi.auth2.getAuthInstance().isSignedIn.get()&&(t.textContent="Sign Out"),et=!0,nt=!1,d("google-api-initialized")}catch(t){nt=!1,console.log(t)}finally{t.disabled=!1}}function ot(){return document.getElementById("js-player-messages")||function(){const t=document.createElement("div");return t.id="js-player-messages",t.classList.add("player-messages"),document.getElementById("js-player").appendChild(t),t}()}function st(){const t=ot();o(t.lastElementChild),t.childElementCount||o(t)}function rt(t){let e=t.title,n=t.body;ot().insertAdjacentHTML("afterBegin",`\n        <div class="player-message">\n            <h3 class="player-message-title">${e}</h3>\n            <p class="player-message-body">${n}</p>\n        </div>\n    `),setTimeout(st,6e3)}function at(){location.reload()}function lt(){d("connectivity-status",navigator.onLine)}function ct(t){return new Promise(e=>{let n=URL.createObjectURL(t),i=new Audio(n);i.preload="metadata",i.addEventListener("loadedmetadata",function t(){e(Math.floor(i.duration)),i.removeEventListener("loadedmetadata",t),i=null,n=URL.revokeObjectURL(n)})})}async function dt(t){if("audio/flac"===t.type){return(0,(await n.e(2).then(n.bind(null,65))).default)(t)}if("audio/ogg"===t.type||"video/ogg"===t.type){return(0,(await n.e(5).then(n.bind(null,66))).default)(t)}if("audio/mp3"===t.type||"audio/mpeg"===t.type){return(0,(await n.e(4).then(n.bind(null,67))).default)(t)}if("audio/x-m4a"===t.type||"audio/mp4"===t.type){return(0,(await n.e(3).then(n.bind(null,68))).default)(t)}return async function(t){return await i.load({src:"libs/metadata-audio-parser.min.js"}),Promise.all([new Promise(e=>{parse_audio_metadata(t,e)}),ct(t)]).then(t=>{let e=t[0],n=t[1];return Object.assign({},e,{duration:n})})}(t)}async function ut(t,e,n){void 0===n&&(n=[]);const i=n.length,o=t[i],s=o.audioTrack,r=o.name;var a,l,d;a=`Processing: ${r}`,l=i+1,d=t.length,function(t){void 0===t&&(t=""),document.getElementById("js-import-progress-label").textContent=t}(a),document.getElementById("js-import-progress-bar-inner").style.transform=`scaleX(${l/d})`,document.getElementById("js-import-progress-bar-label").textContent=`${l}/${d}`;let u=await dt(s),m=u.artist,f=u.title,p=u.album,y=u.duration,v=u.picture;if(navigator.onLine&&m&&f){var g=await async function(t,e,n,i){if(n&&i)return{album:n,picture:i};const o=`?method=track.getInfo&api_key=3e8d48b3277c21bc77965345f5faf18c&artist=${t}&track=${e}&format=json`,s=await fetch("https://ws.audioscrobbler.com/2.0/"+o).then(t=>t.json());if(s.track&&s.track.album){const t=s.track.album,e=t.title,o=t.image;if(!n&&e&&(n=e),!i&&o){const t=o[o.length-1]["#text"];if(t){const e=new URL(t);i=`${e.origin}/i/u/${e.pathname.split("/").slice(-1)[0]}`}}}return{album:n,picture:i}}(m,f,p,v);p=g.album,v=g.picture}return n.push({audioTrack:s,name:r,title:m?f:r,artist:m||"",album:p||"",thumbnail:v||"assets/images/album-art-placeholder.png",durationInSeconds:y,duration:c(y),player:"native",playlistId:e}),i+1===t.length?n:ut(t,e,n)}async function mt(t,e,n,i){if(!n.length)return void rt({title:`${t} files`,body:"No valid audio file found"});const o=(s=n,r=e.tracks,s.reduce((t,e)=>{const n=function(t){return t.slice(0,t.lastIndexOf("."))}(e.name.trim());return r.some(t=>t.name===n)||t.push({audioTrack:e,name:n}),t},[]));var s,r;if(o.length){d("import",{importing:!0,option:t,playlistId:e.id});try{Fi(e,await i(o,e.id))}catch(t){console.log(t)}finally{d("import",{importing:!1,option:t,playlistId:e.id})}}else rt({title:`${t} files`,body:`Track${n.length>1?"s":""} already exist`})}function ft(t){const e=function(t){const e=new Audio,n=[];return t=t.reduce((t,i)=>{if(e.canPlayType(i.type))t.push(i);else{const t=i.name;n.push(t.slice(t.lastIndexOf(".")))}return t},[]),n.length&&rt({title:"Local files",body:`Can't play audio files with type: ${n.join(", ")}`}),t}(t),n="local-files";mt("local",B(n)||A({id:n,title:"Local files",type:"list",storageDisabled:At.getSetting(n,"storageDisabled")}),e,ut)}async function pt(t,e,n){void 0===n&&(n=[]);const i=t[n.length],o=await(s=i.audioTrack.link,fetch(s).then(t=>t.blob()));var s;const r=await ct(o);return n.push({audioTrack:o,durationInSeconds:r,title:i.name,artist:"",album:"",name:i.name,duration:c(r),thumbnail:"assets/images/album-art-placeholder.png",player:"native",playlistId:e}),n.length===t.length?n:pt(t,e,n)}window.addEventListener("sw-state-change",t=>{"update"===t.detail&&(ot().insertAdjacentHTML("afterBegin",'\n        <div class="player-message service-worker-message">\n            <p class="player-message-body">Update is available, please refresh.</p>\n            <button id="js-player-message-btn" class="btn-icon player-message-btn">Refresh</button>\n        </div>\n    '),document.getElementById("js-player-message-btn").addEventListener("click",at),setTimeout(st,6e3))}),window.addEventListener("online",lt),window.addEventListener("offline",lt),window.addEventListener("load",lt),document.getElementById("js-dropbox-option").addEventListener("mouseenter",function t(e){let n=e.currentTarget;i.load({src:"https://www.dropbox.com/static/api/2/dropins.js",id:"dropboxjs","data-app-key":"6ur73hspbv8o1z9"}),n.removeEventListener("mouseenter",t)});n(56);const yt=[];let vt=null;function gt(t){rt({title:"YouTube",body:t})}function bt(t){if(t.includes("H")||(t=`0H${t}`),!t.includes("M")){const e=t.indexOf("H")+1;t=`${t.slice(0,e)}0M${t.slice(e)}`}return t.includes("S")||(t=`${t}0`),t.match(/\d{1,}/g).reverse().reduce((t,e,n)=>t+=e*60**n,0)}function ht(t,e,n,i,o){let s=`part=${e}&${n}=${i}&maxResults=50&key=AIzaSyD33Rxm4dA34Mh84oSxYTUUF_jyCLLOua4`;return o&&(s+=`&pageToken=${o}`),vt&&(s+=`&access_token=${vt}`),fetch(`https://www.googleapis.com/youtube/v3/${t}?${s}`).then(t=>t.json())}function wt(t,e){return t.reduce((t,n)=>{return e.some(t=>t.id===n.id)||t.push(n),t},[])}function kt(t){return t.filter(t=>{const e=t.snippet.title;return"Deleted video"!==e&&"Private video"!==e})}function It(t,e){return t.map(t=>({id:t.snippet.resourceId.videoId,durationInSeconds:t.durationInSeconds,duration:c(t.durationInSeconds),name:t.snippet.title,title:t.snippet.title,artist:"",album:"",thumbnail:t.snippet.thumbnails.medium.url,player:"youtube",playlistId:e}))}async function Et(t,e){const n=await ht("playlistItems","snippet","playlistId",t,e),i=n.error,o=n.items,s=n.nextPageToken;i&&function(t){let e=t.code,n=t.message;throw 403===e?n="You need to be sign in if you want to import private playlists":404===e&&(n="Playlist was not found"),gt(n),new Error(n)}(i);const r=It(await async function(t){const e=t.map(t=>t.snippet.resourceId.videoId).join(),n=await ht("videos","contentDetails","id",e);return t.reduce((t,e)=>{const i=n.items.find(t=>t.id===e.snippet.resourceId.videoId);return i&&(e.durationInSeconds=bt(i.contentDetails.duration)-1,t.push(e)),t},[])}(kt(o)),t);if(s){const e=await Et(t,s);return r.concat(e)}return r}function Lt(t,e){return B(t)||A(Object.assign({id:t,type:"grid"},e))}async function $t(t,e){const n=Lt(t,{title:"YouTube"}),i=(await ht("videos","snippet,contentDetails","id",e)).items;if(i.length){Fi(n,wt(It(kt(i).map(t=>(t.snippet.resourceId={videoId:t.id},t.durationInSeconds=bt(t.contentDetails.duration)-1,t)),"youtube"),n.tracks))}else gt("Video was not found")}async function jt(t,e,n){const i=Lt(e,{url:t}),o=await Et(e);"sync"===n&&function(t){let e=t.id,n=t._id,i=t.tracks;const o=M(e).rendered,s=Bi(e);o&&s&&(s.innerHTML="");to({action:"remove-tracks",playlist:{_id:n,tracks:i}}),i.length=0}(i),i.title||S(i.id,await async function(t){const e=(await ht("playlists","snippet,status","id",t)).items;return{title:e[0].snippet.title,isPrivate:"private"===e[0].status.privacyStatus}}(e)),Fi(i,wt(o,i.tracks))}async function Tt(t,e){if(nt)return void function(t,e){yt.some(e=>e.url===t)||yt.push({url:t,type:e})}(t,e);const n=function(t){let e="",n="";try{const i=new URL(t).searchParams;e=i.get("v"),n=i.get("list")}catch(i){const o=t.match(/v=[a-zA-Z0-9\-_]+/),s=t.match(/list=[a-zA-Z0-9\-_]+/);o&&(e=o[0].slice(2)),s&&(n=s[0].slice(5))}return{videoId:e,playlistId:n}}(t),i=n.videoId,o=n.playlistId,s=o||"youtube";if(i||o)if("WL"!==o){!function(){const t=gapi.auth2.getAuthInstance();vt=t.isSignedIn.get()?t.currentUser.get().getAuthResponse().access_token:null}(),d("import",{importing:!0,option:"youtube",playlistId:s});try{i?await $t(s,i):await jt(t,s,e)}catch(t){console.log(t)}finally{d("import",{importing:!1,option:"youtube",playlistId:s})}}else gt("Importing Watch Later playlist is not allowed");else gt("Invalid url")}window.addEventListener("google-api-initialized",()=>{yt.forEach(t=>{Tt(t.url,t.type)}),yt.length=0});const xt=document.getElementById("js-import-options");let Bt="";const At=function(){const t=Object.assign({"local-files":{storageDisabled:!1},dropbox:{storageDisabled:!1}},JSON.parse(localStorage.getItem("import-settings")));return{setSetting:function(e,n,i){t[e][n]=i,localStorage.setItem("import-settings",JSON.stringify(t))},getSetting:function(e,n){return t[e]?t[e][n]:null},getSettings:function(){return t}}}();function St(t){void 0===t&&(t=""),Bt=t}function Mt(){St(),function(){const t=document.getElementById("js-import-form");t&&(t.removeEventListener("submit",Pt),o(t),s(".import-option-btn.active","active"))}()}function Ot(t,e){const n=G(t),i=function(t){const e=document.querySelector(`[data-entry-id="${t}"]`);if(e)return e.querySelector("[data-action='sync']");return null}(t);n&&n.classList.toggle("show-spinner",e),i&&(i.disabled=e)}function Rt(t,e){let n=e.url,i=e.type;"youtube"===t&&Tt(n,i)}function Ct(t){let e=t.target;ft([...e.files]),e.value="",e.removeEventListener("change",Ct),o(e)}function Ht(t){const e=document.getElementById("js-file-picker")||function(){const t=document.createElement("input");return t.setAttribute("type","file"),t.setAttribute("id","js-file-picker"),t.setAttribute("accept","audio/*"),t.classList.add("file-picker"),t.addEventListener("change",Ct),document.body.appendChild(t),t}();"file"===t?(e.removeAttribute("webkitdirectory"),e.removeAttribute("directory"),e.removeAttribute("allowdirs"),e.setAttribute("multiple","")):"folder"===t&&(e.removeAttribute("multiple"),e.setAttribute("webkitdirectory",""),e.setAttribute("directory",""),e.setAttribute("allowdirs","")),e.click()}function Pt(t){const e=t.target.elements.url.value.trim();if(e){const n=t.target.getAttribute("data-for");Mt(),Rt(n,{url:e})}t.preventDefault()}function _t(t,e){e.element.insertAdjacentHTML("afterend",`\n        <div id="${t}" class="panel info-panel">\n            <h3 class="panel-title">Accepted formats</h3>\n            <ul>\n                <li class="info-panel-content-item">youtube.com/playlist?list={playlistId}</li>\n                <li class="info-panel-content-item">youtube.com/watch?v={videoId}</li>\n            </ul>\n        </div>\n    `)}function Dt(t,e){let n=e.element;const i=At.getSettings();n.insertAdjacentHTML("afterend",`\n        <div id="${t}" class="panel import-settings-panel">\n            <h3 class="panel-title">Settings</h3>\n            <label class="import-setting">\n                <input type="checkbox" class="checkbox-input"\n                    ${i["local-files"].storageDisabled?"checked":""} data-id="local-files">\n                <div class="checkbox"></div>\n                <span class="import-setting-label">Don't store <b>Local files</b> playlist</span>\n            </label>\n            <label class="import-setting">\n                <input type="checkbox" class="checkbox-input"\n                    ${i.dropbox.storageDisabled?"checked":""} data-id="dropbox">\n                <div class="checkbox"></div>\n                <span class="import-setting-label">Don't store <b>Dropbox</b> playlist</span>\n            </label>\n        </div>\n    `),document.getElementById(t).addEventListener("change",Vt)}function Vt(t){let e=t.target;const n=e.getAttribute("data-id");At.setSetting(n,"storageDisabled",e.checked)}function Ut(t){let e=t.attrValue,n=t.elementRef;if("form-toggle"===e){const t="youtube";!function(t){return Bt!==t}(t)?Mt():(n.classList.add("active"),function(t,e){const n="js-import-form",i=`\n        <form id=${n} class="import-form" data-for="${e}">\n            <input type="text" name="url" class="input" placeholder="URL" required>\n            <button class="btn">Import</button>\n        </form>\n    `;t.insertAdjacentHTML("afterend",i);const o=document.getElementById(n);o.elements.url.focus(),o.addEventListener("submit",Pt)}(n,t),St(t),et||it())}else"google-sign-in-or-out"===e?async function(t){if(!t.disabled){t.disabled=!0;try{const e=gapi.auth2.getAuthInstance();e.isSignedIn.get()?(await e.signOut(),t.textContent="Sign In"):(await e.signIn(),t.textContent="Sign Out")}catch(t){console.log(t)}t.disabled=!1}}(n):"youtube-info"===e&&F(`js-${e}-panel`,_t,{element:n})}function qt(){const t="js-pl-entries";return document.getElementById(t)||function(t){document.getElementById("js-tab-home").insertAdjacentHTML("beforeend",`\n        <div class="home-tab-section pl-entry-container">\n            <div class="home-tab-section-header">\n                <h2 class="home-tab-section-title">Playlists</h2>\n            </div>\n            <ul id="${t}"></ul>\n        </div>\n    `);const e=document.getElementById(t);return e.addEventListener("click",te),e.addEventListener("focus",ee,!0),e}(t)}function Wt(t){return`\n        <button class="btn-icon pl-entry-btn" data-action="${t.action}" title="${t.title}">\n            ${p({iconId:t.iconId})}\n        </button>\n    `}function Nt(t){let e=Math.floor(t/3600),n=Math.ceil(t/60%60);return 60===n&&(n=0,e+=1),`${e} hr ${n} min`}function zt(t){return function(t){const e="assets/images/album-art-placeholder.png",n=f(t.map(t=>t.thumbnail)),i=[];for(const t of n){if(4===i.length)break;t!==e&&i.push(t)}for(;i.length<4;)i.push(e);return i}(t).map(t=>`\n        <div class="pl-entry-thumb-image-container">\n            <img src="${u(t)}" class="pl-entry-thumb-image" alt="">\n        </div>\n    `).join("")}function Xt(t,e){const n=R(e);t.querySelector(".track-count").textContent=`${e.length} tracks`,t.querySelector(".playlist-duration").textContent=Nt(n)}function Yt(t,e){t.querySelector(".pl-entry-thumbnail").innerHTML=zt(e)}function Jt(t,e){const n=document.getElementById("js-pl-entries").children;for(const i of n)if(t===i.getAttribute("data-entry-id")){Xt(i,e),Yt(i,e);break}}function Kt(t,e){let n=e.element,i=e.pl;n.insertAdjacentHTML("afterend",`\n        <div id="${t}" class="panel pl-entry-panel">\n            <h3 class="panel-title">Playlist settings</h3>\n            <label class="pl-entry-setting">\n                <input type="checkbox" class="checkbox-input" ${i.syncOnInit?"checked":""}>\n                <div class="checkbox"></div>\n                <span>Synchronize playlist on startup</span>\n            </label>\n        </div>\n    `),document.getElementById(t).addEventListener("change",ne)}function Ft(t){const e=t.parentElement;var n;o(t),e.children.length||((n=e).removeEventListener("click",te),n.removeEventListener("focus",ee,!0),o(n.parentElement))}async function Zt(t){t.length&&(Mt(),t.forEach(t=>{d("import",{importing:!0,option:"youtube",playlistId:t.id})}),await it(),t.forEach(t=>{Rt("youtube",{url:t.url,type:"sync"})}))}function Gt(t){let e=t.currentTarget;const n=r("data-entry-id",e).attrValue,i=B(n),o=i._id,s=i.title,a=e.value;e.removeEventListener("blur",Gt),e.removeEventListener("keyup",Qt),a?a!==s&&(!function(t,e){G(t).querySelector(".sidebar-link").textContent=e}(n,a),S(n,{title:a}),to({action:"change-title",playlist:{_id:o,title:a}})):e.value=s}function Qt(t){let e=t.currentTarget;13===t.which&&e.blur()}function te(t){let e=t.target;const n=r("data-entry-id",e),i=r("data-action",e);if(!n||!i||i.elementRef.disabled)return;const s=i.attrValue,a=i.elementRef,l=B(n.attrValue);"remove"===s?(!function(t){let e=t.id,n=t._id;P(e)&&mi(V());(function(t){const e=ki(t);e&&(xi(t),o(e))})(e),function(t){delete E[t],delete L[t]}(e),function(t){o(G(t))}(e),function(t){w=w.filter(e=>!e.includes(t))}(e),to({action:"remove",playlist:{_id:n}})}(l),Ft(n.elementRef)):"sync"===s?Zt([l]):"settings"===s?F("js-pl-entry-panel",Kt,{element:a,pl:l}):"edit"===s&&a.querySelector(".input").focus()}function ee(t){let e=t.target;const n=r("data-action",e);n&&"edit"===n.attrValue&&(e.addEventListener("blur",Gt),e.addEventListener("keyup",Qt))}function ne(t){let e=t.target;const n=B(r("data-entry-id",e).attrValue);n.syncOnInit=e.checked,to({action:"change-sync",playlist:{_id:n._id,syncOnInit:n.syncOnInit}})}function ie(t){let e=t.currentTarget;const n=r("data-panel-item",t.target,e);if(!n)return;const i=n.attrValue,s=n.elementRef;"btn"===i?(Gi("move-to",s.parentElement,"beforeend",oe),o(s)):(e.removeEventListener("click",ie),function(t){const e=Re(Oe()),n=wi().tracks,i=B(t),o=n.filter(n=>e.includes(n.index)&&!q(t,n.name)).map(e=>Object.assign({},e,{playlistId:t}));Fi(i,o),s=`playlist/${i.id}`,window.location.hash=`/${s}`;var s}(i),J(),we())}function oe(t){const e=document.getElementById("js-move-to-list"),n=hi();Zi(t),e?e.innerHTML=se(n):t.target.insertAdjacentHTML("beforebegin",re(n))}function se(t){return Object.keys(E).map(B).reduce((e,n)=>(n.id!==t&&(e+=`\n                <li data-panel-item="${n.id}">\n                    <button class="btn-icon move-to-list-item-btn">${n.title}</button>\n                </li>\n            `),e),"")}function re(t){const e=se(t);return e?`<ul id="js-move-to-list" class="move-to-list">${e}</ul>`:""}function ae(t,e){let n=e.playlistId;document.getElementById("js-move-to-panel-container").insertAdjacentHTML("beforeend",`\n        <div id="${t}" class="panel move-to-panel">\n            <h3 class="panel-title move-to-panel-title">Move to</h3>\n            ${re(n)}\n            <button class="btn-icon move-to-new-pl-btn" data-panel-item="btn">\n                ${p({iconId:"plus"})}\n                <span>Create new playlist</span>\n            </button>\n        </div>\n    `)}xt.addEventListener("click",t=>{let e=t.currenTarget,n=t.target;const i=r("data-item",n,e);if(!i||i.elementRef.disabled)return;const o=r("data-option",n,e).attrValue;"local"===o?Ht(i.attrValue):"dropbox"===o?Dropbox.choose({success(t){const e="dropbox";mt(e,B(e)||A({id:e,title:"Dropbox",type:"grid",storageDisabled:At.getSetting(e,"storageDisabled")}),t,pt)},linkType:"direct",multiselect:!0,extensions:["audio"]}):"youtube"===o&&Ut(i)}),document.getElementById("js-import-settings-btn").addEventListener("click",t=>{F("js-import-settings-panel",Dt,{element:t.currentTarget})}),window.addEventListener("import",t=>{let e=t.detail;const n=e.importing,i=e.option,s=e.playlistId;!function(t,e){let n=t.children;Array.from(n).forEach(t=>{t.hasAttribute("data-item")&&(t.disabled=e)})}(document.querySelector(`[data-option=${i}]`),n),Ot(s,n),"local"===i&&(n?xt.insertAdjacentHTML("afterend",'\n        <div id="js-import-progress" class="import-progress">\n            <p id="js-import-progress-label" class="import-progress-label"></p>\n            <div class="import-progress-bar">\n                <div id="js-import-progress-bar-inner" class="import-progress-bar-inner"></div>\n                <div id="js-import-progress-bar-label" class="import-progress-bar-label"></div>\n            </div>\n        </div>\n    '):o(document.getElementById("js-import-progress")))});const le={},ce={};let de=null,ue=null,me=null,fe={},pe=[],ye=0,ve=!1,ge=!1;function be(){de.removeEventListener("mousedown",Se),de=null}function he(){Oe().forEach(t=>{t.classList.remove("selected")})}function we(){he(),Ie()}function ke(){ge||(ge=!0,function(){const t="js-move-to-panel-container";document.getElementById("js-playlist-tab-header-items").insertAdjacentHTML("afterbegin",`\n        <div id="${t}" class="playlist-tab-header-item" data-move-to>\n            <button class="btn-icon" data-item="move-to" title="Move to">\n                ${p({iconId:"move-to"})}\n            </button>\n        </div>\n    `),document.getElementById(t).addEventListener("click",ie)}(),setTimeout(()=>{window.addEventListener("click",Ae,!0)},0),window.addEventListener("keypress",Me))}function Ie(){ge&&(ge=!1,function(){const t=document.getElementById("js-move-to-panel-container");t.removeEventListener("click",ie),o(t)}(),window.removeEventListener("click",Ae,!0),window.removeEventListener("keypress",Me))}function Ee(t,e){return t>e?e:t<0?0:t}function Le(){clearInterval(ye),ye=0}function $e(t){ve=!0,requestAnimationFrame(()=>{me&&function(t,e,n,i){let o=t.x-e.x,s=t.y-e.y;if(o<0){const t=e.x+o;o*=-1,n.left=t,i.left=`${t}px`}else n.left!==e.x&&(n.left=e.x,i.left=`${e.x}px`);if(s<0){const t=e.y+s;s*=-1,n.top=t,i.top=`${t}px`}else n.top!==e.y&&(n.top=e.y,i.top=`${e.y}px`);n.right=n.left+o,n.bottom=n.top+s,i.width=`${o}px`,i.height=`${s}px`}(ce,le,fe,me.style),function(t,e,n){for(let i=0;i<t.length;i++){const o=t[i],s=o.ref.classList;e.right>o.left&&e.left<o.right&&e.bottom>o.top&&e.top<o.bottom?(n&&!o.selected&&s.contains("selected")&&(s.remove("selected"),o.removed=!0),o.removed||(s.add("selected"),o.selected=!0)):o.selected?(s.remove("selected"),o.selected=!1):o.removed&&(s.add("selected"),o.removed=!1)}}(pe,fe,t),ve=!1})}function je(t,e,n){let i=n.scrollHeight,o=n.height;e.scrollTop+=36,ce.y=e.scrollTop+o,ce.y>=i&&(ce.y=i,Le()),ve||$e(t)}function Te(t,e){e.scrollTop-=36,ce.y=e.scrollTop,ce.y<=0&&(ce.y=0,Le()),ve||$e(t)}function xe(t){const e=ue,n=e.top,i=e.left,o=e.width,s=e.height,r=e.scrollHeight,a=t.clientY-n;if(ce.x=Ee(t.clientX-i,o),ce.y=Ee(de.scrollTop+a,r),t.preventDefault(),!me&&function(t,e){return t.x>e.x+2||t.x<e.x-2||t.y>e.y+2||t.y<e.y-2}(ce,le))return pe=function(){const t=Bi(hi()).children;return Array.from(t).map(t=>{const e=t.offsetTop,n=t.offsetLeft;return{ref:t,top:e,left:n,right:n+t.offsetWidth,bottom:e+t.offsetHeight}})}(),me=function(t,e){let n=e.x,i=e.y;return fe.top=i,fe.left=n,t.insertAdjacentHTML("afterbegin",`\n        <div class="selection-area" style="top: ${i}px; left: ${n}px"></div>\n    `),t.firstElementChild}(de,le),document.activeElement.blur(),t.ctrlKey||he(),void Ie();if(ve||$e(t.ctrlKey),ye&&a>0&&a<s)Le();else if(!ye){let e=null;if(a>s&&ce.y<r)e=je;else{if(!(a<0&&ce.y>0))return;e=Te}ye=setInterval(e,40,t.ctrlKey,de,ue)}}function Be(t){let e=t.target,n=t.ctrlKey;if(ye&&Le(),me){const t=Oe();o(me),me=null,fe={},pe.length=0,t.length?ke():Ie()}else{const t=r("data-index",e,de);t?function(t,e){if(e||he(),t.classList.toggle("selected"),t.classList.contains("selected"))ke();else{const e=Oe();t.blur(),e.length||Ie()}}(t.elementRef,n):n||we()}window.removeEventListener("mousemove",xe),window.removeEventListener("mouseup",Be)}function Ae(t){let e=t.target;!r("data-move-to",e)&&a(e,de)&&we()}function Se(t){let e=t.currentTarget,n=t.target,i=t.which,o=t.clientX,s=t.clientY;var a;1===i&&(r("data-btn",n)?we():(ue={top:(a=e).offsetTop,left:a.offsetLeft,width:a.clientWidth,height:a.offsetHeight,scrollHeight:a.scrollHeight},le.x=o-ue.left,le.y=e.scrollTop+s-ue.top,le.x<ue.width&&(window.addEventListener("mousemove",xe),window.addEventListener("mouseup",Be))))}function Me(t){let e=t.key,n=t.keyCode;"Delete"!==e&&127!==n||(!function(){const t=Oe(),e=wi(),n=Re(t),i=function(t,e){const n=[],i=[];return t.forEach(t=>{e.includes(t.index)?i.push(t):n.push(t)}),{tracksToRemove:i,tracksToKeep:X(n)}}(e.tracks,n),s=i.tracksToKeep,r=i.tracksToRemove;e.tracks=s,function(t){t.forEach(o)}(t),a=e.id,l=n[0],Array.from(Bi(a).children).slice(l).forEach((t,e)=>{const n=t.querySelector(".list-item-index"),i=l+e;n&&(n.textContent=i+1),t.setAttribute("data-index",i)}),N(e.id,g("shuffle")),U(e.id),Jt(e.id,s),s.length||(be(),Ui(e));var a,l;to({action:"remove-tracks",playlist:{_id:e._id,tracks:r}})}(),Ie())}function Oe(){return Array.from(de.querySelectorAll(".track.selected"))}function Re(t){return t.map(t=>parseInt(t.getAttribute("data-index"),10))}n(57);const Ce=document.getElementById("js-filter-input"),He=Ce.parentElement;let Pe=0,_e="";function De(t,e,n){const i=new RegExp(n,"i");t.forEach(t=>{const n=e[t.index],o=`\n            ${t.title}\n            ${t.artist}\n            ${t.album}\n        `;n.classList.toggle("hidden",!i.test(o))})}function Ve(t,e){void 0===e&&(e="");const n=B(t).tracks;if(!n.length)return;const i=Bi(t).children;var o;_e=e?t:"",De(n,i,e),o=e,document.getElementById("js-clear-input-btn").classList.toggle("visible",o)}function Ue(){_e&&(Ce.value="",Ve(_e))}function qe(){He.classList.remove("active"),Ce.removeEventListener("keyup",We),Ce.removeEventListener("blur",qe)}function We(t){let e=t.target;const n=hi();clearTimeout(Pe),Pe=setTimeout(Ve,400,n,e.value)}function Ne(t){document.getElementById("js-order-toggle").querySelector("use").setAttribute("href",`#${1===t?"down":"up"}-arrow`)}function ze(t,e){return"index"===t?e.primaryIndex:"duration"===t?e.durationInSeconds:e[t].toLowerCase()}function Xe(t,e,n){t.sort((t,i)=>{const o=ze(e,t),s=ze(e,i);return o<s?-n:o>s?n:0})}function Ye(t,e){const n=document.getElementById("js-filter-input").value,i=t.sortedBy===e&&1===t.order?-1:1;if(Xe(t.tracks,e,i),S(t.id,{order:i,sortedBy:e,tracks:X(t.tracks)}),to({action:"change-sorting",playlist:{order:i,_id:t._id,sortedBy:e}}),U(t.id),Ui(t),n){const e=Bi(t.id).children;De(t.tracks,e,n)}}function Je(t){let e=t.sortedBy,n=t.order;var i;i=e,document.getElementById("js-sort-toggle").textContent=i,Ne(n)}function Ke(t,e){let n=e.sortedBy;document.getElementById("js-sort-panel-container").insertAdjacentHTML("beforeend",function(t,e){return`<ul id="${t}" class="panel sort-panel">${function(t){return["index","name","title","artist","album","duration"].reduce((e,n)=>{const i=n===t?" active":"";return`\n            ${e}\n            <li>\n                <button class="btn-icon sort-option-btn${i}" data-sort="${n}">\n                    ${n}\n                </button>\n            </li>\n        `},"")}(e)}</ul>`}(t,n)),document.getElementById(t).addEventListener("click",Fe)}function Fe(t){let e=t.currentTarget;const n=t.target.getAttribute("data-sort"),i=wi();e.removeEventListener("click",Fe),J(),n!==i.sortedBy&&(Je({sortedBy:n,order:1}),Ye(i,n))}Ce.addEventListener("focus",t=>{let e=t.currentTarget;He.classList.add("active"),e.addEventListener("keyup",We),e.addEventListener("blur",qe)}),He.addEventListener("click",t=>{const e=r("data-filter-item",t.target);if(!e)return;const n=e.attrValue;"icon"===n?Ce.focus():"button"===n&&(Ue(),qe())});const Ze=document.getElementById("js-volume-slider"),Ge=document.getElementById("js-track-slider"),Qe=document.getElementById("js-controls");let tn=!1;const en=function(){let t=0;function e(){clearTimeout(t)}function n(e,i,o){const s=performance.now()-i-o;tn||yn(e,e.currentTime),ei.updateTrack({currentTime:e.currentTime}),e.currentTime<=e.durationInSeconds?(e.currentTime+=1,o+=1e3,t=setTimeout(n,1e3-s,e,i,o)):d("track-end")}return{stop:e,start:function(t){const i=performance.now();e(),n(t,i,0)}}}();function nn(t){const e=Ai(t);e&&e.classList.add("show-spinner"),document.getElementById("js-play-btn").classList.add("show-spinner")}function on(t){const e=Ai(t);e&&e.classList.remove("show-spinner"),document.getElementById("js-play-btn").classList.remove("show-spinner")}function sn(t){return t?{id:"play",title:"Play"}:{id:"pause",title:"Pause"}}function rn(t,e){m(t,sn(e))}function an(t,e){const n={on:{id:"volume-off",title:"Unmute"},off:{id:"volume",title:"Mute"}};m(t,e?n.on:n.off)}function ln(t,e){const n=document.getElementById(`js-${t}-slider`).getBoundingClientRect();let i=(e-n.left)/n.width*100;return i<0?i=0:i>100&&(i=100),i}function cn(){en.stop(),yn()}function dn(t){v("volume",t),vn(t),function(t){const e=V()||{};"native"===e.player?Vn(t):"youtube"===e.player&&Qn(t)}(t)}function un(t,e){const n=e/2;return t+n+8>window.innerWidth||t-n-8<0}function mn(t,e){return`calc(${t}% - ${e}px)`}function fn(t,e){const n=document.getElementById("js-volume-slider-label");n.textContent=`${Math.floor(t)}%`;const i=n.offsetWidth;un(e,i)||(n.style.left=mn(t,i/2))}function pn(t,e){document.getElementById(`js-${t}-slider-thumb`).style.left=`${100*e}%`,document.getElementById(`js-${t}-slider-elapsed`).style.transform=`scaleX(${e})`}function yn(t,e){void 0===e&&(e=0);let n=1,i="0:00";t&&(n=t.durationInSeconds,i=t.duration);const o=c(e,n>=3600);tn||(document.getElementById("js-track-current").textContent=o),pn("track",e/n),Ge.setAttribute("aria-valuenow",e),Ge.setAttribute("aria-valuetext",`${o} of ${i}`)}function vn(t){const e=Math.floor(100*t);pn("volume",t),Ze.setAttribute("aria-valuenow",e),Ze.setAttribute("aria-valuetext",`${e}% volume`)}function gn(t,e){void 0===t&&(t="0:00"),void 0===e&&(e=0),document.getElementById("js-track-duration").textContent=t,Ge.setAttribute("aria-valuemax",e)}function bn(t,e){const n=ln("track",t);return{percent:n,currentTime:Math.floor(e*n/100)}}function hn(t,e,n){const i=document.getElementById("js-track-slider-label");i.textContent=c(e);const o=i.offsetWidth;un(n,o)||(i.style.left=mn(t,o/2))}function wn(t){let e=t.pageX;const n=V(),i=bn(e,n.durationInSeconds),o=i.percent,s=i.currentTime;yn(n,s),hn(o,s,e)}function kn(t){let e=t.pageX;const n=V();if(!n)return;const i=bn(e,n.durationInSeconds);hn(i.percent,i.currentTime,e)}function In(t){let e=t.pageX;const n=V();if(tn=!1,n){const t=bn(e,n.durationInSeconds).currentTime;yn(n,t),pi(n.player,t),ei.updateTrack({currentTime:t})}window.removeEventListener("mousemove",wn),window.removeEventListener("mouseup",In),Ge.addEventListener("mousemove",kn)}function En(t){let e=t.pageX;const n=ln("volume",e),i=n/100;i!==g("volume")&&(fn(n,e),i?(Tn(),dn(i)):jn({attrValue:"mute",elementRef:document.getElementById("js-volume-btn")}))}function Ln(t){let e=t.pageX;fn(ln("volume",e),e)}function $n(){window.removeEventListener("mousemove",En),window.removeEventListener("mouseup",$n),Ze.addEventListener("mousemove",Ln)}function jn(t){let e=t.attrValue,n=t.elementRef;const i=!g(e);n.setAttribute("aria-checked",i),v(e,i),"mute"===e?(!function(t){const e=t?0:g("volumeBeforeMute");t?v("volumeBeforeMute",g("volume")):b("volumeBeforeMute");dn(e)}(i),an(n,i)):n.classList.toggle("active")}function Tn(){const t=g("mute");if(t){const e=document.getElementById("js-volume-btn");b("volumeBeforeMute"),v("mute",!t),an(e,!t),e.classList.remove("active")}}function xn(t){return function(e){let n=e.pageX;const i=document.getElementById(`js-${t}-slider-label`),o=window.innerWidth,s=i.offsetWidth/2;if(n+s+8>o){const e=ln(t,o-s-8);i.style.left=mn(e,s)}else if(n-s-8<0){const e=ln(t,s+8);i.style.left=mn(e,s)}}}Ge.addEventListener("mousedown",t=>{1===t.which&&V()&&(tn=!0,wn(t),Ge.removeEventListener("mousemove",kn),window.addEventListener("mousemove",wn),window.addEventListener("mouseup",In))}),Ge.addEventListener("mousemove",kn),Ge.addEventListener("mouseenter",xn("track")),Ge.addEventListener("keydown",t=>{let e=t.key;if(!e.startsWith("Arrow"))return;const n=V();if(!n)return;const i=n.durationInSeconds;let o=ei.getTrack().currentTime;"ArrowRight"===e||"ArrowUp"===e?(o+=5)>i&&(o=i):"ArrowLeft"!==e&&"ArrowDown"!==e||(o-=5)<0&&(o=0),yn(n,o),pi(n.player,o),ei.updateTrack({currentTime:o})}),Ze.addEventListener("mousedown",t=>{1===t.which&&(En(t),Ze.removeEventListener("mousemove",Ln),window.addEventListener("mousemove",En),window.addEventListener("mouseup",$n))}),Ze.addEventListener("mousemove",Ln),Ze.addEventListener("mouseenter",xn("volume")),Ze.addEventListener("keydown",t=>{let e=t.key;if(!e.startsWith("Arrow"))return;let n=g("volume");if(n<1&&("ArrowRight"===e||"ArrowUp"===e))n||Tn(),(n+=.05)>1&&(n=1);else if(n&&("ArrowLeft"===e||"ArrowDown"===e)&&(n-=.05)<=0)return n=0,void jn({attrValue:"mute",elementRef:document.getElementById("js-volume-btn")});dn(n)}),document.getElementById("js-main-controls").addEventListener("click",t=>{const e=r("data-item",t.target);if(e)switch(e.attrValue){case"previous":li("direction",-1,H());break;case"play":!function(){const t=V();t?ri(t):li("direction",0,hi())}();break;case"next":ci()}}),Qe.addEventListener("click",t=>{const e=r("data-item",t.target);e&&jn(e)}),Qe.addEventListener("keyup",t=>{let e=t.which;const n=r("data-item",t.target);!n||32!==e&&13!==e||jn(n)}),document.getElementById("js-control-toggle-btn").addEventListener("click",()=>{Qe.classList.toggle("visible")}),vn(g("volume")),Array.from(document.querySelectorAll(".control-btn")).forEach(t=>{const e=t.getAttribute("data-item"),n=g(e);n&&(t.setAttribute("aria-checked",!0),"mute"===e?an(t,n):t.classList.add("active"))});const Bn=document.getElementById("js-now-playing"),An=document.getElementById("js-media-container");let Sn,Mn,On=null;function Rn(t){27===t.which&&(An.classList.remove("visible"),window.removeEventListener("keydown",Rn))}function Cn(){const t=document.getElementById("js-track-info");t&&o(t)}function Hn(t){void 0===t&&(t="./assets/images/album-art-placeholder.png"),document.getElementById("js-artwork").src=t}function Pn(t,e){Hn(),Cn(),function(t,e){Hn(e),Bn.classList.remove("inactive"),Bn.insertAdjacentHTML("beforeend",function(t,e){let n=`<div>${t.name}</div>`;return t.artist&&t.title&&(n=`\n            <div class="track-title">${t.title}</div>\n            <div>${t.artist} ${t.album?`- ${t.album}`:""}</div>\n        `),`<div id="${e}" class="track-info fade-right">${n}</div> `}(t,"js-track-info"))}(t,e)}function _n(t){On&&URL.revokeObjectURL(On),Pn(t,On=u(t.thumbnail)),function(t,e){const n=document.getElementById("js-yt-player");if("youtube"===t.player)n.classList.remove("hidden");else{const t=document.getElementById("js-media-image");n.classList.add("hidden"),t.src=e}}(t,On)}function Dn(){document.title="Veery",Hn(),Cn(),Bn.classList.add("inactive"),An.classList.remove("visible"),On&&(URL.revokeObjectURL(On),On=null)}function Vn(t){Mn.volume=t}function Un(t){Mn.currentTime=t}An.addEventListener("click",function(t){const e=r("data-item",t.target);e&&"image"===e.attrValue&&ri(V())}),document.getElementById("js-expand-media-btn").addEventListener("click",function(){An.classList.toggle("visible"),An.classList.contains("visible")?window.addEventListener("keydown",Rn):window.removeEventListener("keydown",Rn)});const qn=1,Wn=2,Nn=3,zn=-1;let Xn=!1,Yn=null,Jn=null;function Kn(t){let e=t.data;const n=V();if(!n||"youtube"!==n.player)return;const i=document.getElementById("js-yt-player"),o=ni()?Wn:qn;if(document.activeElement===i&&(e===qn&&o===Wn||e===Wn&&o===qn))return i.blur(),o===Wn&&d("track-start",Yn.getCurrentTime()),void ii(n);if(e===qn){if(o===Wn)return void Yn.pauseVideo();d("track-start",Yn.getCurrentTime())}else e===Wn&&o===qn?Yn.playVideo():e===Nn?(en.stop(),nn(n)):on(n)}function Fn(){Xn=!0,Gn(...Jn),Jn=null}function Zn(t){let e="";if(100===t.data?e="Video is either removed or marked as private":101!==t.data&&150!==t.data||(e="The owner of the requested video does not allow it to be played in embedded players"),console.log(t),e){const t=V(),n=z(t.playlistId,1).name;t.name===n?mi(t):ci(),rt({title:`Cannot play ${t.name}`,body:e})}}function Gn(t,e,n){if(Xn)return Qn(e),void Yn.loadVideoById(t.id,n);Jn=[t,e,n],i.load({src:"https://www.youtube.com/iframe_api"})}function Qn(t){Yn.setVolume(100*t)}window.onYouTubeIframeAPIReady=function(){Yn=new YT.Player("js-yt-player",{playerVars:{autoplay:0,disablekb:1,controls:0,fs:0,iv_load_policy:3},events:{onReady:Fn,onStateChange:Kn,onError:Zn}})};let ti=!0;const ei=function(){function t(){return JSON.parse(localStorage.getItem("track"))||{}}function e(t){localStorage.setItem("track",JSON.stringify(t))}function n(){localStorage.removeItem("track")}return{getTrack:t,removeTrack:n,saveTrack:e,updateTrack:function(n){e(Object.assign(t(),n))},initTrack:function(){const e=t();if(!e)return;const i=_(q(e.playlistId,e.name));i?(ai(i,{startTime:e.currentTime}),yn(i,e.currentTime)):n()}}}();function ni(){return ti}function ii(t,e){(ti="boolean"==typeof e?e:!ti)&&(Q(),en.stop()),si(t,ti),yi()}function oi(t,e){let n=e.scrollToTrack,i=e.startTime;const o=M(t.playlistId).rendered;_n(t),gn(t.duration,t.durationInSeconds),Ge.classList.add("visible"),C(t.playlistId),W(t.index),D(t),o&&-1!==t.index&&Ni(t,n),void 0===i?(ti=!1,yi(),nn(t),si(t,ti)):ti=!0}function si(t,e){rn(document.getElementById("js-play-btn"),e),zi(t,e)}function ri(t){"native"===t.player?ti?Mn.play():Mn.pause():"youtube"===t.player&&function(t){if(!Xn)return;const e=Yn.getPlayerState();e!==Nn&&e!==zn&&(t?Yn.playVideo():Yn.pauseVideo())}(ti),ii(t)}function ai(t,e){void 0===e&&(e={});const n=g("volume");oi(t,e),"native"===t.player?function(t,e,n){Sn=URL.createObjectURL(t),(Mn=new Audio(Sn)).onplaying=function(){d("track-start",Mn.currentTime)},Vn(e),"number"!=typeof n?Mn.play():Un(n)}(t.audioTrack,n,e.startTime):"youtube"===t.player&&Gn(t,n,e.startTime)}function li(t,e,n){if(!n)return;const i=g("shuffle"),o=V(),s=M(n).shuffled;let r=!1;if(o&&(Wi(o.element),cn(),zi(o,!0),ui(o)),s!==i&&(r=!0,N(n,i)),"index"===t){const t=B(n).tracks;!r&&i&&N(n,i),ai(_(t[e]))}else if("direction"===t){const t=z(n,e);t?ai(t,{scrollToTrack:!0}):fi(o)}}function ci(){li("direction",1,H())}function di(t){let e=t.currentTarget,n=t.detail,i=t.target;const o=hi(),s=r("data-btn",i,e),a=r("data-index",i,e);if(2===n&&a&&!s)li("index",a.attrValue,o);else if(s){const t=parseInt(a.attrValue,10),e=V();e&&e.playlistId===o&&t===e.index?ri(e):li("index",t,o)}}function ui(t){"native"===t.player?(Mn.pause(),Mn.currentTime=0,Mn=null,Sn&&(URL.revokeObjectURL(Sn),Sn=null)):"youtube"===t.player&&function(t){Xn&&(on(t),Yn.stopVideo())}(t)}function mi(t){t&&ui(t),fi(t)}function fi(t){ti=!0,ei.removeTrack(),gn(),Ge.classList.remove("visible"),Dn(),D(),C(),Q(),t&&(Wi(t.element),cn(),on(t),si(t,ti))}function pi(t,e){en.stop(),"native"===t?Un(e):"youtube"===t&&function(t){Yn.seekTo(t,!0)}(e)}function yi(t){void 0===t&&(t=hi());const e=ni(),n=B(t);let i="Veery";if(e)n&&(i=`${n.title} | ${i}`);else{const t=V(),e=t.artist,n=t.name,o=t.title;i=`${e&&o?`${e} - ${o}`:n} | ${i}`}document.title=i}window.addEventListener("track-start",t=>{let e=t.detail;const n=V();!function(t){const e=G(t);Q(),e.insertAdjacentHTML("beforeend",p({iconId:"volume",elementId:"js-active-playlist-icon",className:"active-playlist-icon"}))}(n.playlistId),ei.saveTrack({name:n.name,playlistId:n.playlistId}),en.start({currentTime:Math.floor(e),duration:n.duration,durationInSeconds:n.durationInSeconds}),on(n)}),window.addEventListener("track-end",()=>{const t=V();g("once")?mi(t):(ei.removeTrack(),g("repeat")?ai(t):ci())});const vi=document.getElementById("js-tab-header"),gi=matchMedia("(max-width: 540px)");let bi="";function hi(){return bi}function wi(){return B(bi)}function ki(t){return document.getElementById(`js-tab-${t}`)}function Ii(t){const e=B(t);M(t).rendered||function(t){const e=function(t){const e=Di(t);return`<div id="js-tab-${t.id}" class="tab">${e}</div>`}(t);document.getElementById("js-tabs").insertAdjacentHTML("beforeend",e),O(t.id,{rendered:!0}),t.tracks.length&&(Vi(t.id),$i(t.id))}(e),"list"===e.type&&gi.matches?Yi("grid",e):Xi(e.type),Je(e),function(t){let e=t.id,n=t.tracks;de&&be(),n.length&&(de=ki(e)).addEventListener("mousedown",Se)}(e),Ue(),e.tracks.length&&ki(t).addEventListener("click",di)}vi.addEventListener("click",t=>{let e=t.currentTarget;const n=r("data-item",t.target,e);if(!n)return;const i=wi(),o=n.attrValue;"move-to"===o?F("js-move-to-panel",ae,{playlistId:i.id,element:n.elementRef}):"list"!==o&&"grid"!==o||o===i.type?"sorting"===o?F("js-sort-panel",Ke,{sortedBy:i.sortedBy,element:n.elementRef}):"order"===o&&i.sortedBy?function(t){Ye(t,t.sortedBy),Ne(t.order)}(i):"sidebar"===o&&document.getElementById("js-sidebar-container").classList.remove("hidden"):Yi(o,i)}),window.addEventListener("route-change",t=>{let e=t.detail,n=e.isPlaylistTab,i=e.tabId;const o=ki(bi);s(".sidebar-entry.active","active"),s(".tab.active","active"),function(t){void 0===t&&(t=""),bi=t}(n?i:""),o&&o.removeEventListener("click",di),n?(Ii(i),vi.classList.add("playlist-tab-active")):vi.classList.remove("playlist-tab-active"),yi(i),ki(i).classList.add("active"),"not-found"!==i&&G(i).classList.add("active")}),gi.onchange=function(t){let e=t.matches;const n=wi();e&&n&&"list"===n.type&&Yi("grid",n)};const Ei={};function Li(t){t.forEach(t=>{let e=t.isIntersecting,n=t.target;e?function(t){const e=wi(),n=e.tracks,i=e.type,o=n[t.getAttribute("data-index")],s=V(),r=ni(),a=s&&s.index===o.index?sn(r):sn(!0);t.innerHTML="list"===i?Oi(o,a):Hi(o,a)}(n):n.childElementCount&&function(t){const e=t.querySelector(".artwork");e&&URL.revokeObjectURL(e.src),t.innerHTML=""}(n)})}function $i(t){if(!IntersectionObserver||Ei[t])return;Ei[t]=new IntersectionObserver(Li,{root:ki(t)});const e=Bi(t).children;Ti(t,Array.from(e))}function ji(t){Ei[t]&&xi(t),$i(t)}function Ti(t,e){e.forEach(e=>{Ei[t].observe(e)})}function xi(t){Ei[t]&&(Ei[t].disconnect(),delete Ei[t])}function Bi(t){return document.getElementById(`js-${t}`)}function Ai(t){let e=t.element;if(-1!==t.index&&e)return e.querySelector(".btn-icon")}function Si(t){return Mi(t,Oi(t,{id:"play",title:"Play"}))}function Mi(t,e){return void 0===e&&(e=""),`<li class="list-item track" data-index="${t.index}" tabindex="0">${e}</li>`}function Oi(t,e){let n=e.title,i=e.id;return`\n        <span class="list-item-first-col">\n            <span class="list-item-index">${t.index+1}</span>\n            <button class="btn-icon track-play-pause-btn" data-btn="play" title="${n}">\n                ${p({iconId:i})}\n            </button>\n        </span>\n        <span class="list-item-col fade-right">${t.title}</span>\n        <span class="list-item-col fade-right">${t.artist}</span>\n        <span class="list-item-col fade-right">${t.album}</span>\n        <span class="list-item-last-col">${t.duration}</span>\n    `}function Ri(t){return Ci(t,Hi(t,{id:"play",title:"Play"}))}function Ci(t,e){return void 0===e&&(e=""),`<li class="grid-item track" data-index="${t.index}" tabindex="0">${e}</li>`}function Hi(t,e){return`\n        <div class="artwork-container grid-item-thumbnail" tabindex="-1">\n            <button class="btn-icon track-play-pause-btn artwork-container-btn" data-btn="play" title="${e.title}">\n                ${p({iconId:e.id})}\n            </button>\n            <img src="${u(t.thumbnail)}" class="artwork" alt="">\n        </div>\n        ${function(t){let e=t.name;t.artist&&t.title&&(e=`\n            <div class="track-title">${t.title}</div>\n            <div>${t.artist} ${t.album?`- ${t.album}`:""}</div>\n        `);return`<div class="track-info fade-right">${e}</div> `}(t)}\n        <div class="grid-item-duration">${t.duration}</div>\n    `}function Pi(){let t=Si,e=Ri;return"IntersectionObserver"in window&&(t=Mi,e=Ci),{listItemCb:t,gridItemCb:e}}function _i(t,e){return t.reduce((t,n)=>t+e(n),"")}function Di(t){return t.tracks.length?function(t){let e=t.id,n=t.type,i=t.tracks;const o=Pi(),s=o.listItemCb,r=o.gridItemCb;return"list"===n?function(t,e){return`\n        <ul class="list-view-header">\n            <li class="list-item-first-col">#</li>\n            <li>Title</li>\n            <li>Artist</li>\n            <li>Album</li>\n            <li class="list-item-last-col">Duration</li>\n        </ul>\n        <ul id="js-${t}" class="playlist-view">${e}</ul>\n    `}(e,_i(i,s)):function(t,e){return`<ul id="js-${t}" class="playlist-view grid-view">${e}</ul>`}(e,_i(i,r))}(t):'<p class="playlist-message">This playlist is empty</p>'}function Vi(t){const e=V();e&&e.playlistId===t&&-1!==e.index&&Ni(e,!0)}function Ui(t){ki(t.id).innerHTML=Di(t),t.tracks.length?(Vi(t.id),ji(t.id)):xi(t.id)}function qi(t){t.element=document.getElementById(`js-${t.playlistId}`).children[t.index],t.element.classList.add("playing")}function Wi(t){t&&t.classList.remove("playing")}function Ni(t,e){qi(t),e&&function(t,e){const n=ki(e),i=t.offsetHeight,o=t.offsetTop,s=n.clientHeight,r=n.scrollTop,a=r+s;(o-i<r||o>a)&&(n.scrollTop=o-s/2)}(t.element,t.playlistId)}function zi(t,e){const n=Ai(t);n&&rn(n,e)}function Xi(t){const e=document.getElementById("js-list-toggle-btn"),n=document.getElementById("js-grid-toggle-btn");"list"===t?(e.classList.add("active"),n.classList.remove("active")):(n.classList.add("active"),e.classList.remove("active"))}function Yi(t,e){S(e.id,{type:t}),to({action:"change-type",playlist:{_id:e._id,type:t}}),Ui(e),Xi(t)}function Ji(t){Xe(t.tracks,t.sortedBy,t.order),t.tracks=X(t.tracks)}function Ki(t){var e,n,i;O(t.id,{initialized:!0}),e=t.title,n=t.id,document.getElementById("js-sidebar-entries").insertAdjacentHTML("beforeend",`\n        <li id="js-sidebar-entry-${n}" class="sidebar-entry">\n            <a href="./#/playlist/${n}" class="sidebar-link" data-link>\n                <div class="fade-right">${e}</div>\n            </a>\n        </li>\n    `),function(t){const e=qt(),n=R(t.tracks),i=t.url?Wt({action:"sync",title:"Synchronize playlist",iconId:"sync"}):"",o=t.url?`\n        <div class="pl-entry-panel-container">\n            ${Wt({action:"settings",title:"Settings",iconId:"settings"})}\n        </div>\n    `:"",s=Wt({action:"remove",title:"Remove playlist",iconId:"trash"}),r=p({iconId:"edit",className:"pl-entry-input-icon"}),a=t.storageDisabled?p({iconId:"alert",className:"pl-entry-stats-item",title:"This playlist will not persist through reload"}):"",l=t.isPrivate?p({iconId:"lock",className:"pl-entry-stats-item",title:"Private"}):"";e.insertAdjacentHTML("beforeend",`\n        <li class="pl-entry" data-entry-id=${t.id}>\n            <div class="pl-entry-thumbnail">${zt(t.tracks)}</div>\n            <div class="pl-entry-content">\n                <div class="pl-entry-input-container" data-action="edit">\n                    <input type="text" class="input pl-entry-input" value="${t.title}">\n                    ${r}\n                </div>\n                <div class="pl-entry-footer">\n                    <div class="pl-entry-stats">\n                        ${a}\n                        ${l}\n                        <span class="pl-entry-stats-item track-count">${t.tracks.length} tracks</span>\n                        <span class="pl-entry-stats-item playlist-duration">${Nt(n)}</span>\n                    </div>\n                    ${i}\n                    ${o}\n                    ${s}\n                </div>\n            </div>\n        </li>\n    `)}(t),Ji(t),k(i=`playlist/${t.id}`)||w.push(i)}function Fi(t,e){const n=M(t.id),i=n.initialized,o=n.rendered;e.length&&(e=function(t,e){void 0===e&&(e=0);return t.map((t,n)=>(t.primaryIndex=e+n,t))}(e,t.lastTrackIndex),t.lastTrackIndex=e[e.length-1].primaryIndex+1,t.tracks=t.tracks.concat(e)),i?(P(t.id)&&N(t.id,g("shuffle")),Ji(t),U(t.id),Jt(t.id,t.tracks),o&&(e.length?function(t,e){const n=V(),i=Bi(t.id);if(i){const n=Pi(),o=n.listItemCb,s=n.gridItemCb,r=_i(e,"list"===t.type?o:s);i.insertAdjacentHTML("beforeend",r),Ti(t.id,[...i.children].slice(-e.length))}else ki(t.id).innerHTML=Di(t),ji(t.id);n&&n.playlistId===t.id&&q(t.id,n.name)&&(Wi(n.element),qi(n))}(t,e):Ui(t)),to({action:"add-tracks",playlist:{_id:t._id,lastTrackIndex:t.lastTrackIndex,tracks:e}})):(Ki(t),to({action:"add",playlist:t}))}function Zi(t){const e=A({title:t.target.title.value,id:Math.random().toString(36).slice(2),type:"grid"});Ki(e),to({action:"add",playlist:e}),t.preventDefault(),t.target.reset()}function Gi(t,e,n,i){e.insertAdjacentHTML(n,`\n        <form id="js-${t}-form" class="${t}-form">\n            <input type="text" name="title" class="input" autocomplete="off" placeholder="Playlist title" required>\n            <button class="btn">Create</button>\n        </form>\n    `);const o=document.getElementById(`js-${t}-form`);o.elements.title.focus(),o.addEventListener("submit",i)}const Qi=new Worker("./ww.js");function to(t){t.playlist.storageDisabled||("add"===t.action||t.playlist._id)&&Qi.postMessage(t)}Qi.onmessage=function(t){let e=t.data,n=e.action,i=e.payload;"init"===n?(i.forEach(t=>{Ki(A(t))}),Zt(i.filter(t=>t.syncOnInit)),ei.initTrack(),I()):"update"===n&&S(i.id,i)},Qi.onerror=function(t){console.log(t)},"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("./sw.js").then(t=>{t.onupdatefound=(()=>{const e=t.installing;e.onstatechange=(()=>{"installed"===e.state&&navigator.serviceWorker.controller&&d("sw-state-change","update")})})}).catch(console.log)})}});