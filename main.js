!function(t){function e(e){for(var n,o,r=e[0],s=e[1],a=0,l=[];a<r.length;a++)o=r[a],i[o]&&l.push(i[o][0]),i[o]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n]);for(c&&c(e);l.length;)l.shift()()}var n={},i={2:0};function o(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.e=function(t){var e=[],n=i[t];if(0!==n)if(n)e.push(n[2]);else{var r=new Promise(function(e,o){n=i[t]=[e,o]});e.push(n[2]=r);var s=document.getElementsByTagName("head")[0],a=document.createElement("script");a.charset="utf-8",a.timeout=12e4,o.nc&&a.setAttribute("nonce",o.nc),a.src=o.p+""+({}[t]||t)+".js";var c=setTimeout(function(){l({type:"timeout",target:a})},12e4);function l(e){a.onerror=a.onload=null,clearTimeout(c);var n=i[t];if(0!==n){if(n){var o=e&&("load"===e.type?"missing":e.type),r=e&&e.target&&e.target.src,s=new Error("Loading chunk "+t+" failed.\n("+o+": "+r+")");s.type=o,s.request=r,n[1](s)}i[t]=void 0}}a.onerror=a.onload=l,s.appendChild(a)}return Promise.all(e)},o.m=t,o.c=n,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},o.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o.oe=function(t){throw console.error(t),t};var r=window.webpackJsonp=window.webpackJsonp||[],s=r.push.bind(r);r.push=e,r=r.slice();for(var a=0;a<r.length;a++)e(r[a]);var c=s;o(o.s=15)}([function(t,e,n){var i=n(14).f,o=Function.prototype,r=/^\s*function ([^ (]*)/;"name"in o||n(4)&&i(o,"name",{configurable:!0,get:function(){try{return(""+this).match(r)[1]}catch(t){return""}}})},function(t,e){var n=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,e,n){n(7)("split",2,function(t,e,i){"use strict";var o=n(26),r=i,s=[].push;if("c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length){var a=void 0===/()??/.exec("")[1];i=function(t,e){var n=String(this);if(void 0===t&&0===e)return[];if(!o(t))return r.call(n,t,e);var i,c,l,u,d,f=[],m=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),p=0,v=void 0===e?4294967295:e>>>0,y=new RegExp(t.source,m+"g");for(a||(i=new RegExp("^"+y.source+"$(?!\\s)",m));(c=y.exec(n))&&!((l=c.index+c[0].length)>p&&(f.push(n.slice(p,c.index)),!a&&c.length>1&&c[0].replace(i,function(){for(d=1;d<arguments.length-2;d++)void 0===arguments[d]&&(c[d]=void 0)}),c.length>1&&c.index<n.length&&s.apply(f,c.slice(1)),u=c[0].length,p=l,f.length>=v));)y.lastIndex===c.index&&y.lastIndex++;return p===n.length?!u&&y.test("")||f.push(""):f.push(n.slice(p)),f.length>v?f.slice(0,v):f}}else"0".split(void 0,0).length&&(i=function(t,e){return void 0===t&&0===e?[]:r.call(this,t,e)});return[function(n,o){var r=t(this),s=void 0==n?void 0:n[e];return void 0!==s?s.call(n,r,o):i.call(String(r),n,o)},i]})},function(t,e,n){t.exports=!n(2)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e,n){var i=n(14),o=n(29);t.exports=n(4)?function(t,e,n){return i.f(t,e,o(1,n))}:function(t,e,n){return t[e]=n,t}},function(t,e,n){"use strict";var i=n(6),o=n(13),r=n(2),s=n(10),a=n(9);t.exports=function(t,e,n){var c=a(t),l=n(s,c,""[t]),u=l[0],d=l[1];r(function(){var e={};return e[c]=function(){return 7},7!=""[t](e)})&&(o(String.prototype,t,u),i(RegExp.prototype,c,2==e?function(t,e){return d.call(t,this,e)}:function(t){return d.call(t,this)}))}},function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,e,n){var i=n(27)("wks"),o=n(12),r=n(1).Symbol,s="function"==typeof r;(t.exports=function(t){return i[t]||(i[t]=s&&r[t]||(s?r:o)("Symbol."+t))}).store=i},function(t,e){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,e){var n=t.exports={version:"2.5.3"};"number"==typeof __e&&(__e=n)},function(t,e){var n=0,i=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++n+i).toString(36))}},function(t,e,n){var i=n(1),o=n(6),r=n(28),s=n(12)("src"),a=Function.toString,c=(""+a).split("toString");n(11).inspectSource=function(t){return a.call(t)},(t.exports=function(t,e,n,a){var l="function"==typeof n;l&&(r(n,"name")||o(n,"name",e)),t[e]!==n&&(l&&(r(n,s)||o(n,s,t[e]?""+t[e]:c.join(String(e)))),t===i?t[e]=n:a?t[e]?t[e]=n:o(t,e,n):(delete t[e],o(t,e,n)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[s]||a.call(this)})},function(t,e,n){var i=n(33),o=n(32),r=n(30),s=Object.defineProperty;e.f=n(4)?Object.defineProperty:function(t,e,n){if(i(t),e=r(e,!0),i(n),o)try{return s(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},function(t,e,n){"use strict";n.r(e),n(34),n(39);const i=function(){const t=[];return{load:function(e){return t.includes(e.src)?Promise.resolve():new Promise(n=>{const i=document.createElement("script");Object.keys(e).forEach(t=>{i.setAttribute(t,e[t])}),document.getElementsByTagName("body")[0].appendChild(i),t.push(e.src),i.onload=n})}}}();function o(t){return t.charAt(0).toUpperCase()+t.slice(1)}function r(t){t.parentElement.removeChild(t)}function s(t,e){const n=document.querySelector(t);n&&n.classList.remove(e)}function a(t,e,n=null){for(;e&&e!==n;){if(e.hasAttribute(t))return{elementRef:e,attrValue:e.getAttribute(t)};e=e.parentElement}}function c(t,e){return!!e&&!e.contains(t)}function l(t){const e=function(t){const e=t%60;return e<10?`0${e}`:e}(t),n=function(t){const e=Math.floor(t/60%60);return t>=3600&&e<10?`0${e}`:e}(t);return`${function(t){const e=Math.floor(t/3600);return e?`${e}:`:""}(t)}${n}:${e}`}function u(t,e){const n=new CustomEvent(t,{detail:e});window.dispatchEvent(n)}function d(t){return"object"==typeof t?URL.createObjectURL(t):t}function f(t,{id:e,title:n}){t.setAttribute("title",n),t.querySelector(".js-icon").setAttribute("href",`#${e}`)}const m=Object.assign({repeat:!1,shuffle:!1,once:!1,mute:!1,volume:.2},JSON.parse(localStorage.getItem("settings"))||{});function p(t,e){m[t]=e,localStorage.setItem("settings",JSON.stringify(m))}function v(t){return m[t]}function y(t){delete m[t]}n(3),n(24);const g=[];function h(t){return g.some(e=>e===t)}function b(){const t=window.location.hash.slice(2).replace(/\/+$/g,"");let e=!1,n="home";u("route-change",{tabId:n=t&&!h(t)?"not-found":(e=t.startsWith("playlist/"))?t.split("playlist/")[1]:n,isPlaylistTab:e})}window.addEventListener("hashchange",b),n(0);const w={};let E="",L=null;function k(t){return w[t]}function I(t){return t.tracks&&(t.duration=j(t.tracks)),w[t.id]=Object.assign({sortedBy:"index",order:1,shuffled:!1,tracks:[],playbackIndex:0,playbackOrder:[],duration:0},t,{rendered:!1,initialized:!1}),w[t.id]}function x(t,e){Object.assign(w[t],e)}function j(t){return t.reduce((t,e)=>t+=e.durationInSeconds,0)}function T(t=""){E=t}function $(){return E}function B(t){return t===E}function A(){return w[E]}function S(t){return t?Object.assign({},t):null}function M(t){L=S(t)}function O(t){Object.assign(L,t)}function _(){return L}function R(t,e){const n=k(t);return S(n?n.tracks.find(t=>t.name===e):null)}function P(t){const e=A();x(e.id,{playbackIndex:e.playbackOrder.indexOf(parseInt(t,10))})}function H(t,e){const n=t.map((t,e)=>e);return e?function(t){let e=t.length;for(;e;){const i=Math.floor(Math.random()*e);e-=1;var n=[t[i],t[e]];t[e]=n[0],t[i]=n[1]}return t}(n):n}function C({id:t,tracks:e},n){x(t,{shuffled:n,playbackOrder:H(e,n)}),function(){const t=_();t&&P(t.index)}()}function V(t){return t.map((t,e)=>(t.index=e,t))}function U(t){return document.getElementById(`js-sidebar-entry-${t}`)}function q(){const t=document.getElementById("js-active-playlist-icon");t&&r(t)}document.getElementById("js-sidebar-container").addEventListener("click",({currentTarget:t,target:e})=>{if(a("data-link",e,t)||c(e,t.firstElementChild))return void t.classList.add("hidden");const n=a("data-btn",e,t);n&&function(t){const e=document.getElementById("js-sidebar-form");e?r(e):bi("sidebar",t.parentElement,"afterend",hi)}(n.elementRef)});let D=null;function z(){window.removeEventListener("click",K,!0),r(D.element),D=null}function F(t,e,n){e(t,n),D={id:t,element:document.getElementById(t),removeOnClick:n.removeOnClick,initiator:n.element},window.addEventListener("click",K,!0)}function N(t,e,n){if(D){const i=D.id;z(),i!==t&&F(t,e,n)}else F(t,e,n)}function K({target:t}){if(D.removeOnClick)return void z();const e=c(t,D.element),n=c(t,D.initiator);e&&n&&z()}let W=!1,X=!1;function Y(){return W}async function J(){if(W||X)return;const t=document.getElementById("js-google-sign-in-or-out-btn");X=!0,t.disabled=!0;try{await i.load({src:"https://apis.google.com/js/api.js"}),await new Promise(t=>gapi.load("client:auth2",t)),await gapi.client.init({apiKey:"AIzaSyD33Rxm4dA34Mh84oSxYTUUF_jyCLLOua4",clientId:"293076144560-r5cear7rprgo094u6ibcd6nl3bbg18te.apps.googleusercontent.com",discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest"],scope:"https://www.googleapis.com/auth/youtube.force-ssl"}),gapi.auth2.getAuthInstance().isSignedIn.get()&&(t.textContent="Sign Out"),W=!0,X=!1,u("google-api-initialized")}catch(t){X=!1,console.log(t)}finally{t.disabled=!1}}const Z=document.getElementById("js-volume-slider"),G=document.getElementById("js-track-slider"),Q=document.getElementById("js-controls");let tt=!1;const et=function(){let t=0;function e(){clearTimeout(t)}function n(e,i,o){const r=performance.now()-i-o;tt||dt(e,e.currentTime),ee.updateTrack({currentTime:e.currentTime}),e.currentTime<=e.durationInSeconds?(e.currentTime+=1,o+=1e3,t=setTimeout(n,1e3-r,e,i,o)):u("track-end")}return{stop:e,start:function(t){const i=performance.now();e(),n(t,i,0)}}}();function nt(t){const e=ni(t);e&&e.classList.add("show-spinner"),document.getElementById("js-play-btn").classList.add("show-spinner")}function it(t){const e=ni(t);e&&e.classList.remove("show-spinner"),document.getElementById("js-play-btn").classList.remove("show-spinner")}function ot(t,e){const n={on:{id:"play",title:"Play"},off:{id:"pause",title:"Pause"}};f(t,e?n.on:n.off)}function rt(t,e){const n={on:{id:"volume-off",title:"Unmute"},off:{id:"volume",title:"Mute"}};f(t,e?n.on:n.off)}function st(t,e){const n=document.getElementById(`js-${t}-slider`).getBoundingClientRect();let i=(e-n.left)/n.width*100;return i<0?i=0:i>100&&(i=100),i}function at(){et.stop(),dt()}function ct(t){p("volume",t),ft(t),function(t){const e=_()||{};"native"===e.player?Zt(t):"youtube"===e.player&&Pt(t)}(t)}function lt(t){const e=document.getElementById("js-volume-slider-label");e.textContent=`${Math.floor(t)}%`,e.style.left=`${t}%`}function ut(t,e){document.getElementById(`js-${t}-slider-thumb`).style.left=`${100*e}%`,document.getElementById(`js-${t}-slider-elapsed`).style.transform=`scaleX(${e})`}function dt(t,e=0){const n=l(e),i=t?t.durationInSeconds:1,o=t?t.duration:n;tt||(document.getElementById("js-track-current").textContent=n),ut("track",e/i),G.setAttribute("aria-valuenow",e),G.setAttribute("aria-valuetext",`${n} of ${o}`)}function ft(t){const e=Math.floor(100*t);ut("volume",t),Z.setAttribute("aria-valuenow",e),Z.setAttribute("aria-valuetext",`${e}% volume`)}function mt(t="0:00",e=0){document.getElementById("js-track-duration").textContent=t,G.setAttribute("aria-valuemax",e)}function pt(t,e){const n=st("track",t);return{percent:n,currentTime:Math.floor(e*n/100)}}function vt(t,e){const n=document.getElementById("js-track-slider-label");n.style.left=`${t}%`,n.textContent=l(e)}function yt({pageX:t}){const e=_(),n=pt(t,e.durationInSeconds),i=n.percent,o=n.currentTime;dt(e,o),vt(i,o)}function gt({pageX:t}){const e=_();if(!e)return;const n=pt(t,e.durationInSeconds);vt(n.percent,n.currentTime)}function ht({pageX:t}){const e=_();if(tt=!1,e){const n=pt(t,e.durationInSeconds).currentTime;dt(e,n),me(e.player,n),ee.updateTrack({currentTime:n})}window.removeEventListener("mousemove",yt),window.removeEventListener("mouseup",ht),G.addEventListener("mousemove",gt)}function bt({pageX:t}){const e=st("volume",t),n=e/100;n!==v("volume")&&(lt(e),n?(kt(),ct(n)):Lt({attrValue:"mute",elementRef:document.getElementById("js-volume-btn")}))}function wt({pageX:t}){lt(st("volume",t))}function Et(){window.removeEventListener("mousemove",bt),window.removeEventListener("mouseup",Et),Z.addEventListener("mousemove",wt)}function Lt({attrValue:t,elementRef:e}){const n=!v(t);e.classList.toggle("active"),e.setAttribute("aria-checked",n),p(t,n),"shuffle"===t?function(t){const e=A();e&&C(e,t)}(n):"mute"===t&&(function(t){const e=t?0:v("volumeBeforeMute");t?p("volumeBeforeMute",v("volume")):y("volumeBeforeMute"),ct(e)}(n),rt(e,n))}function kt(){const t=v("mute");if(t){const e=document.getElementById("js-volume-btn");y("volumeBeforeMute"),p("mute",!t),rt(e,!t),e.classList.remove("active")}}G.addEventListener("mousedown",t=>{1===t.which&&_()&&(tt=!0,yt(t),G.removeEventListener("mousemove",gt),window.addEventListener("mousemove",yt),window.addEventListener("mouseup",ht))}),G.addEventListener("mousemove",gt),G.addEventListener("keydown",({which:t})=>{const e=_();if(!e||t<37||t>40)return;const n=e.durationInSeconds;let i=ee.getTrack().currentTime;38===t||39===t?(i+=5)>n&&(i=n):37!==t&&40!==t||(i-=5)<0&&(i=0),dt(e,i),me(e.player,i),ee.updateTrack({currentTime:i})}),Z.addEventListener("mousedown",t=>{1===t.which&&(bt(t),Z.removeEventListener("mousemove",wt),window.addEventListener("mousemove",bt),window.addEventListener("mouseup",Et))}),Z.addEventListener("mousemove",wt),Z.addEventListener("keydown",({which:t})=>{let e=v("volume");if(38===t||39===t)(e+=.05)>1&&(e=1),kt();else if(e&&(37===t||40===t)&&(e-=.05)<=0)return e=0,void Lt({attrValue:"mute",elementRef:document.getElementById("js-volume-btn")});ct(e)}),document.getElementById("js-main-controls").addEventListener("click",({target:t})=>{const e=a("data-item",t);e&&function(t){switch(e.attrValue){case"previous":ae("direction",-1,$());break;case"play":!function(){const t=_();t?re(t):ae("direction",0,Zn())}();break;case"next":ce()}}()}),Q.addEventListener("click",({target:t})=>{const e=a("data-item",t);e&&Lt(e)}),Q.addEventListener("keyup",({which:t,target:e})=>{const n=a("data-item",e);!n||32!==t&&13!==t||Lt(n)}),document.getElementById("js-control-toggle-btn").addEventListener("click",()=>{Q.classList.toggle("visible")}),ft(v("volume")),Array.from(document.querySelectorAll(".control-btn")).forEach(t=>{const e=t.getAttribute("data-item"),n=v(e);n&&(t.classList.add("active"),t.setAttribute("aria-checked",!0),"mute"===e&&rt(t,n))});const It=1,xt=2,jt=3,Tt=-1;let $t=!1,Bt=!1,At=null,St=null;function Mt({data:t}){const e=_();if(!e||"youtube"!==e.player)return;const n=document.getElementById("js-yt-player"),i=ne(),o=i?xt:It;if(document.activeElement===n&&(t===It&&o===xt||t===xt&&o===It))return n.blur(),o===xt&&u("track-start",At.getCurrentTime()),void ie(!i,e);if(t===It){if(o===It&&($t=!1),$t||o===xt)return $t=!1,At.pauseVideo(),void it(e);u("track-start",At.getCurrentTime())}else t===xt&&o===It?(At.playVideo(),it(e)):t===jt&&(et.stop(),nt(e))}function Ot(){Bt=!0,Rt(...St),St=null}function _t(t){if(console.log(t),t.data>=100){const t=_();de(t),pe({title:`Cannot play ${t.name}`,body:"It is either removed or marked as private"})}}function Rt(t,e,n){if(!Bt)return St=[t,e,n],void i.load({src:"https://www.youtube.com/iframe_api"});Pt(e),"number"==typeof n?($t=!0,At.loadVideoById(t.id,n)):At.loadVideoById(t.id)}function Pt(t){At.setVolume(100*t)}window.onYouTubeIframeAPIReady=function(){At=new YT.Player("js-yt-player",{playerVars:{autoplay:0,disablekb:1,controls:0,fs:0,showinfo:0,rel:0,iv_load_policy:3},events:{onReady:Ot,onStateChange:Mt,onError:_t}})};const Ht=document.getElementById("js-now-playing"),Ct=document.getElementById("js-media-container");let Vt,Ut,qt=null,Dt=null,zt=0,Ft=0;function Nt(){clearTimeout(Ft),cancelAnimationFrame(zt),Dt.style.textIndent="0",Ft=0,Dt=null}function Kt(t,e,n,i=0){i=Math.abs(i)<e+10?i-1:n,t.style.textIndent=`${i}px`,zt=requestAnimationFrame(()=>{Kt(t,e,n,i)})}function Wt({currentTarget:t}){t.removeEventListener("mouseleave",Wt),Dt&&Nt()}function Xt(){const t=document.getElementById("js-track-name");t&&r(t)}function Yt(t="./assets/images/album-art-placeholder.png"){document.getElementById("js-artwork").src=t}function Jt(t){qt&&URL.revokeObjectURL(qt),function(t,e){document.title=t.artist&&t.title?`${t.artist} - ${t.title}`:t.name,Yt(),Xt(),function(t,e){Yt(e),Ht.classList.remove("inactive"),Ht.insertAdjacentHTML("beforeend",ai(t,"js-track-name"))}(t,e)}(t,qt=d(t.thumbnail)),function(t,e){const n=document.getElementById("js-yt-player");if("youtube"===t.player){const e=document.getElementById("js-yt-player-watch");n.classList.remove("hidden"),e.setAttribute("href",`https://www.youtube.com/watch?v=${t.id}`)}else{const t=document.getElementById("js-media-image");n.classList.add("hidden"),t.src=e}}(t,qt)}function Zt(t){Ut.volume=t}function Gt(t){Ut.currentTime=t}Ht.addEventListener("mousemove",function({currentTarget:t,target:e}){if(Dt&&e!==Dt&&e!==t)Nt();else if(Ft)return;const n=e.scrollWidth,i=e.offsetWidth;n>i&&(Dt=e,Ft=setTimeout(Kt,400,e,n,i),e.addEventListener("mouseleave",Wt))}),Ct.addEventListener("click",function({currentTarget:t,target:e}){const n=a("data-item",e);if(!n)return;const i=n.attrValue,o=n.elementRef,r=_();"image"===i?re(r):"yt-watch"===i?function(t,e){const n=ne(),i=ee.getTrack().currentTime;n||(At.pauseVideo(),ie(!n,e)),t.setAttribute("href",`https://www.youtube.com/watch?v=${e.id}&time_continue=${i}`)}(o,r):"close"===i&&t.classList.remove("visible")}),document.getElementById("js-expand-media-btn").addEventListener("click",function(){Ct.classList.toggle("visible")});let Qt=!0,te=!1;const ee=function(){function t(){return JSON.parse(localStorage.getItem("track"))||{}}function e(t){localStorage.setItem("track",JSON.stringify(t))}function n(){localStorage.removeItem("track")}return{getTrack:t,removeTrack:n,saveTrack:e,updateTrack:function(n){e(Object.assign(t(),n))},initTrack:function(){const e=t();if(!e)return;const i=R(e.playlistId,e.name);i?(se(i,e.currentTime),dt(i,e.currentTime),Qt=!0):n()}}}();function ne(){return Qt}function ie(t,e){(Qt=t)&&(q(),et.stop()),oe(e,Qt)}function oe(t,e){ot(document.getElementById("js-play-btn"),e),di(t,e)}function re(t){"native"===t.player?Qt?Ut.play():Ut.pause():"youtube"===t.player&&function(t){if(!Bt)return;const e=At.getPlayerState();e!==jt&&e!==Tt&&(t?At.playVideo():At.pauseVideo())}(Qt),ie(!Qt,t)}function se(t,e){const n=v("volume");T(t.playlistId),P(t.index),M(t),function(t){const e=k(t.playlistId);Jt(t),mt(t.duration,t.durationInSeconds),G.classList.add("visible"),e.rendered&&-1!==t.index&&ui(e.id,t.index,{scrollToTrack:te}),te=!1,Qt=!1}(t),void 0===e&&(nt(t),oe(t,Qt)),"native"===t.player?function(t,e,n){Vt=URL.createObjectURL(t),(Ut=new Audio(Vt)).onplaying=function(){u("track-start",Ut.currentTime)},Zt(e),"number"!=typeof n?Ut.play():Gt(n)}(t.audioTrack,n,e):"youtube"===t.player&&Rt(t,n,e)}function ae(t,e,n){const i=k(n),o=v("shuffle"),r=_();let s=null;if(i){if(r&&(at(),di(r,!0),ue(r)),i.shuffled!==o&&C(i,o),"index"===t)s=S(i.tracks[e]);else if("direction"===t){if(!(s=function(t,e){const n=function({playbackIndex:t,playbackOrder:e},n){return t+=n,!n||t>=e.length?t=0:-1===t&&(t=e.length-1),e[t]}(t,e);return S(t.tracks[n])}(i,e)))return void fe(r);te=!0}se(s)}}function ce(){ae("direction",1,$())}function le({currentTarget:t,detail:e,target:n}){const i=t.id.split("js-tab-")[1],o=a("data-btn",n,t),r=a("data-index",n,t);if(2===e&&r&&!o)ae("index",r.attrValue,i);else if(o){const t=parseInt(r.attrValue,10),e=_();e&&e.playlistId===i&&t===e.index?re(e):ae("index",t,i)}}function ue(t){"native"===t.player?(Vt&&(URL.revokeObjectURL(Vt),Vt=null),Ut.pause(),Ut.currentTime=0,Ut=null):"youtube"===t.player&&function(t){Bt&&(it(t),At.stopVideo())}(t)}function de(t){t&&ue(t),fe(t)}function fe(t){Qt=!0,ee.removeTrack(),mt(),G.classList.remove("visible"),document.title="Veery",Yt(),Xt(),Ht.classList.add("inactive"),Ct.classList.remove("visible"),qt&&(URL.revokeObjectURL(qt),qt=null),M(),T(),q(),s(".track.playing","playing"),t&&(at(),it(t),oe(t,Qt))}function me(t,e){et.stop(),"native"===t?Gt(e):"youtube"===t&&function(t){At.seekTo(t,!0)}(e)}function pe({title:t,body:e}){N("js-player-message",function(t,e){return(n,{element:i})=>{i.insertAdjacentHTML("beforeend",`\n            <div id="${n}" class="panel player-message">\n                <p class="play-message-title">${t}</p>\n                <p class="play-message-body">${e}</p>\n            </div>\n        `)}}(t,e),{element:document.getElementById("js-player"),removeOnClick:!0})}function ve(t){return new Promise(e=>{let n=URL.createObjectURL(t),i=new Audio(n);i.preload="metadata",i.addEventListener("loadedmetadata",function t(){e(Math.floor(i.duration)),i.removeEventListener("loadedmetadata",t),i=null,n=URL.revokeObjectURL(n)})})}async function ye(t,e,i=[]){const o=t[i.length],r=o.audioTrack,s=o.name,a=await async function(t){if("audio/flac"===t.type)return(0,(await n.e(1).then(n.bind(null,23))).default)(t);if("audio/ogg"===t.type)return(0,(await n.e(0).then(n.bind(null,22))).default)(t);let e={};var i=await Promise.all([new Promise(e=>{parse_audio_metadata(t,e)}),ve(t)]);return(e=i[0]).duration=i[1],e}(r),c=a.artist,u=a.title,d=a.album,f=a.duration,m=a.picture;return i.push({audioTrack:r,name:s,title:c?u.trim():s,artist:c?c.trim():"",album:d?d.trim():"",thumbnail:m||"assets/images/album-art-placeholder.png",durationInSeconds:f,duration:l(f),player:"native",playlistId:e}),i.length!==t.length?await ye(t,e,i):i}function ge(t,e,{initialized:n,id:i}){pe({title:`${t} files`,body:e}),Se(t),n&&Ei(i)}async function he(t,e,n,o){if(Ae(t),!n.length)return void ge(t,"No valid audio file found",e);const r=(s=n,a=e.tracks,s.reduce((t,e)=>{const n=(c=e.name.trim()).slice(0,c.lastIndexOf("."));return a.some(t=>t.name===n)||t.push({audioTrack:e,name:n}),t},[]));var s,a,c;if(r.length)try{await i.load({src:"libs/metadata-audio-parser.min.js"}),gi(e,await o(r,e.id))}catch(t){console.log(t),Ei(e.id)}finally{Se(t)}else ge(t,`Track${n.length>1?"s":""} already exist`,e)}async function be(t,e,n=[]){const i=t[n.length],o=await(r=i.audioTrack.link,fetch(r).then(t=>t.blob()));var r;const s=await ve(o);return n.push({audioTrack:o,durationInSeconds:s,index:n.length,title:i.name,artist:"",album:"",name:i.name,duration:l(s),thumbnail:"assets/images/album-art-placeholder.png",player:"native",playlistId:e}),n.length!==t.length?await be(t,e,n):n}window.addEventListener("track-start",({detail:t})=>{const e=_();!function(t){const e=U(t);q(),e.insertAdjacentHTML("beforeend",'\n        <svg viewBox="0 0 24 24" id="js-active-playlist-icon" class="active-playlist-icon">\n            <use href="#volume"></use>\n        </svg>\n    ')}(e.playlistId),ee.saveTrack({name:e.name,playlistId:e.playlistId}),et.start({currentTime:Math.floor(t),duration:e.duration,durationInSeconds:e.durationInSeconds}),it(e)}),window.addEventListener("track-end",()=>{const t=_();v("once")?de(t):(ee.removeTrack(),v("repeat")?se(t):ce())}),document.getElementById("js-dropbox-option").addEventListener("mouseenter",function t({currentTarget:e}){i.load({src:"https://www.dropbox.com/static/api/2/dropins.js",id:"dropboxjs","data-app-key":"6ur73hspbv8o1z9"}),e.removeEventListener("mouseenter",t)}),n(21);const we=[];function Ee(t){pe({title:"YouTube",body:t}),Se("youtube")}function Le(t){if(t.includes("H")||(t=`0H${t}`),!t.includes("M")){const e=t.indexOf("H")+1;t=`${t.slice(0,e)}0M${t.slice(e)}`}return t.includes("S")||(t=`${t}0`),t.match(/\d{1,}/g).reverse().reduce((t,e,n)=>t+=e*60**n,0)}function ke(t,e,n,i,o){let r=`part=${e}&${n}=${i}&maxResults=50&key=AIzaSyD33Rxm4dA34Mh84oSxYTUUF_jyCLLOua4`;const s=gapi.auth2.getAuthInstance();return o&&(r+=`&pageToken=${o}`),s.isSignedIn.get()&&(r+=`&access_token=${s.currentUser.get().getAuthResponse().access_token}`),fetch(`https://www.googleapis.com/youtube/v3/${t}?${r}`).then(t=>t.json())}function Ie(t){return t.filter(t=>{const e=t.snippet.title;return"Deleted video"!==e&&"Private video"!==e})}function xe(t,e){return t.map(t=>({id:t.snippet.resourceId.videoId,durationInSeconds:t.durationInSeconds,duration:l(t.durationInSeconds),name:t.snippet.title,title:t.snippet.title,artist:"",album:"",thumbnail:t.snippet.thumbnails.medium.url,player:"youtube",playlistId:e}))}async function je(t,e,n){const i=k(e);n||(n=i?"update":"new"),i&&wi(e);const o=await async function t(e,n){const i=await ke("playlistItems","snippet","playlistId",e,n);i.error&&function({code:t,message:e},n){throw 403===t?Ee("You need to be sign in if you want to import private playlist"):404===t&&Ee("Playlist was not found"),Ei(n),new Error(e)}(i.error,e);const o=Ie(i.items),r=xe(await async function(t){const e=t.map(t=>t.snippet.resourceId.videoId).join(),n=await ke("videos","contentDetails","id",e);return t.reduce((t,e)=>{const i=n.items.find(({id:t})=>t===e.snippet.resourceId.videoId);return i&&(e.durationInSeconds=Le(i.contentDetails.duration)-1,t.push(e)),t},[])}(o),e);if(i.nextPageToken){const n=await t(e,i.nextPageToken);return r.concat(n)}return r}(e),r=await async function(t){const e=(await ke("playlists","snippet,status","id",t)).items;return{title:e[0].snippet.title,status:e[0].status.privacyStatus}}(e);Re({url:t,title:r.title,id:e,tracks:o,player:"youtube",type:"grid",isPrivate:"private"===r.status},n)}function Te(t,e){if(X)return void function(t,e){we.some(e=>e.url===t)||we.push({url:t,type:e})}(t,e);const n=function(t){let e="",n="";try{const i=new URL(t).searchParams;e=i.get("v"),n=i.get("list")}catch(i){const o=t.match(/v=[a-zA-Z0-9\-_]+/),r=t.match(/list=[a-zA-Z0-9\-_]+/);o&&(e=o[0].slice(2)),r&&(n=r[0].slice(5))}return{videoId:e,playlistId:n}}(t),i=n.videoId,o=n.playlistId;i?async function(t,e){const n=k("youtube");e||(e=n?"update":"new"),n&&wi("youtube");const i=(await ke("videos","snippet,contentDetails","id",t)).items;if(n&&n.tracks.length,!i.length)return Ee("Video was not found"),void Ei("youtube");var o;Re({title:"YouTube",id:"youtube",tracks:(o=i,xe(Ie(o).map(t=>(t.snippet.resourceId={videoId:t.id},t.durationInSeconds=Le(t.contentDetails.duration)-1,t)),"youtube")),player:"youtube",type:"grid"},e)}(i,e):o?"WL"===o?Ee("Importing Watch Later playlist is not allowed"):je(t,o,e):Ee("Invalid url")}window.addEventListener("google-api-initialized",()=>{we.forEach(({url:t,type:e})=>{Te(t,e)}),we.length=0});let $e="";function Be(t=""){$e=t}function Ae(t){Me(t,!0)}function Se(t){Me(t,!1)}function Me(t,e){const n=document.querySelector(`[data-option=${t}]`).children;Array.from(n).forEach(t=>{t.hasAttribute("data-item")&&(t.disabled=e)})}function Oe(){Be(),function(){const t=document.getElementById("js-import-form");t&&(t.removeEventListener("submit",He),r(t),s(".import-option-btn.active","active"))}()}function _e(t,{url:e,type:n}){"youtube"===t&&Te(e,n)}async function Re(t,e="new"){const n=t.tracks.splice(0);let i=null,o=[];if("new"===e)i=I(t),o=n;else if("sync"===e)o=n,function(t){ki({action:"remove-tracks",playlist:{_id:t._id,tracks:t.tracks}}),t.tracks.length=0,t.duration=0}(i=k(t.id));else{if("update"!==e)throw new Error("Unknown import type");o=function(t,e){return t.reduce((t,n)=>(e.some(t=>t.name===n.name)||t.push(n),t),[])}(n,(i=k(t.id)).tracks)}gi(i,await function(t){return t.length?new Promise(e=>{let n=0;t.forEach(i=>{const o=new Image;o.onload=function(){(n+=1)===t.length&&e(t)},o.onerror=function(){i.thumbnail="assets/images/album-art-placeholder.png",(n+=1)===t.length&&e(t)},o.src=i.thumbnail})}):Promise.resolve(t)}(o)),Oe(),Se(t.player)}function Pe({target:t}){(function(t){const e=function(t){const e=new Audio;return t.filter(t=>e.canPlayType(t.type))}(t),n="local-files";let i=k(n);i&&i.initialized?wi(n):i=I({id:n,title:"Local files",type:"list",player:"native"}),he("local",i,e,ye)})([...t.files]),t.value="",t.removeEventListener("change",Pe),r(t)}function He(t){const e=t.target.elements.url.value.trim();if(e){const n=t.target.getAttribute("data-for");Oe(),Ae(n),_e(n,{url:e})}t.preventDefault()}function Ce(t,{element:e}){e.insertAdjacentHTML("afterend",`\n        <div id="${t}" class="panel info-panel">\n            <h3 class="panel-title info-panel-title">Accepted formats</h3>\n            <ul>\n                <li class="info-panel-content-item">youtube.com/playlist?list={playlistId}</li>\n                <li class="info-panel-content-item">youtube.com/watch?v={videoId}</li>\n            </ul>\n        </div>\n    `)}function Ve(t){const e=document.querySelector(`[data-entry-id="${t}"]`);return e?e.querySelector("[data-action='sync']"):null}function Ue(t){const e=Ve(t);e&&(e.disabled=!1)}function qe(t){const e=Ve(t);e&&(e.disabled=!0)}function De(){const t=document.getElementById("js-pl-entries");t&&Array.from(t.children).forEach(t=>{const e=k(t.getAttribute("data-entry-id")),n=e.tracks,i=e.duration;t.querySelector(".track-count").textContent=`${n.length} tracks`,t.querySelector(".playlist-duration").textContent=Fe(i)})}function ze({action:t,title:e,iconId:n}){return`\n        <button class="btn-icon pl-entry-btn" data-action="${t}" title="${e}">\n            <svg viewBox="0 0 24 24">\n                <use href="#${n}">\n            </svg>\n        </button>\n    `}function Fe(t){let e=Math.floor(t/3600),n=Math.ceil(t/60%60);return 60===n&&(n=0,e+=1),`${e} hr ${n} min`}function Ne(t,{element:e,pl:n}){e.insertAdjacentHTML("afterend",`\n        <div id="${t}" class="panel pl-entry-panel">\n            <h3 class="panel-title">Playlist settings</h3>\n            <label class="pl-entry-setting">\n                <input type="checkbox" class="checkbox-input" ${n.syncOnInit?"checked":""}>\n                <div class="checkbox"></div>\n                <span>Synchronize playlist on startup</span>\n            </label>\n        </div>\n    `),document.getElementById(t).addEventListener("change",Ze)}async function Ke(t){t.length&&(Y()||(t.forEach(t=>{qe(t.id)}),await J(),t.forEach(t=>{Ue(t.id)})),Oe(),Ae("youtube"),t.forEach(({player:t,url:e})=>{_e(t,{url:e,type:"sync"})}))}function We({currentTarget:t}){const e=a("data-entry-id",t).attrValue,n=k(e),i=n._id,o=n.title,r=t.value;t.removeEventListener("blur",We),t.removeEventListener("keyup",Xe),r?r!==o&&(function(t,e){U(t).querySelector(".sidebar-link").textContent=e}(e,r),x(e,{title:r}),ki({action:"change-title",playlist:{_id:i,title:r}})):t.value=o}function Xe({currentTarget:t,which:e}){13===e&&t.blur()}function Ye({target:t}){const e=a("data-entry-id",t),n=a("data-action",t);if(!e||!n||n.elementRef.disabled)return;const i=n.attrValue,o=n.elementRef,s=k(e.attrValue);"remove"===i?(function({id:t,rendered:e,_id:n}){B(t)&&de(_()),e&&function(t){r(Qn(t))}(t),function(t){delete w[t]}(t),function(t){r(U(t))}(t),ki({action:"remove",playlist:{_id:n}})}(s),function(t){const e=t.parentElement;var n;r(t),e.children.length||((n=e).removeEventListener("click",Ye),n.removeEventListener("focus",Je,!0),r(n.parentElement))}(e.elementRef)):"sync"===i?Ke([s]):"settings"===i?N("js-pl-entry-panel",Ne,{element:o,pl:s}):"edit"===i&&o.querySelector(".input").focus()}function Je({target:t}){const e=a("data-action",t);e&&"edit"===e.attrValue&&(t.addEventListener("blur",We),t.addEventListener("keyup",Xe))}function Ze(t){const e=k(a("data-entry-id",t.target).attrValue);e.syncOnInit=t.target.checked,ki({action:"change-sync",playlist:{_id:e._id,syncOnInit:e.syncOnInit}})}function Ge({currentTarget:t,target:e}){const n=a("data-panel-item",e,t);if(!n)return;const i=n.attrValue,o=n.elementRef;"btn"===i?(bi("move-to",o.parentElement,"beforeend",Qe),r(o)):(t.removeEventListener("click",Ge),function(t){const e=An(Bn()),n=Gn().tracks;gi(k(t),n.filter(n=>e.includes(n.index)&&!R(t,n.name)).map(e=>Object.assign({},e,{playlistId:t})),!0)}(i),z(),yn())}function Qe(t){const e=document.getElementById("js-move-to-list"),n=Zn();hi(t),e?e.innerHTML=tn(n):t.target.insertAdjacentHTML("beforebegin",en(n))}function tn(t){return Object.keys(w).map(k).reduce((e,n)=>(n.id!==t&&(e+=`\n                <li data-panel-item="${n.id}">\n                    <button class="btn move-to-list-item-btn">${n.title}</button>\n                </li>\n            `),e),"")}function en(t){const e=tn(t);return e?`<ul id="js-move-to-list" class="move-to-list">${e}</ul>`:""}function nn(t,{playlistId:e}){document.getElementById("js-move-to-panel-container").insertAdjacentHTML("beforeend",`\n        <div id="${t}" class="panel move-to-panel">\n            <h3 class="panel-title move-to-panel-title">Move to</h3>\n            ${en(e)}\n            <button class="btn-icon move-to-new-pl-btn" data-panel-item="btn">\n                <svg viewBox="0 0 24 24">\n                    <use href="#plus"></use>\n                </svg>\n                <span>Create new playlist</span>\n            </button>\n        </div>\n    `)}document.getElementById("js-import-options").addEventListener("click",({currenTarget:t,target:e})=>{const n=a("data-item",e,t);if(!n||n.elementRef.disabled)return;const i=a("data-option",e,t).attrValue;"local"===i?function(t){const e=document.getElementById("js-file-picker")||function(){const t=document.createElement("input");return t.setAttribute("type","file"),t.setAttribute("id","js-file-picker"),t.classList.add("file-picker"),t.addEventListener("change",Pe),document.body.appendChild(t),t}();"file"===t?(e.removeAttribute("webkitdirectory"),e.removeAttribute("directory"),e.removeAttribute("allowdirs"),e.setAttribute("multiple","")):"folder"===t&&(e.removeAttribute("multiple"),e.setAttribute("webkitdirectory",""),e.setAttribute("directory",""),e.setAttribute("allowdirs","")),e.click()}(n.attrValue):"dropbox"===i?Dropbox.choose({success(t){const e="dropbox";he(e,k(e)||I({id:e,title:"Dropbox",type:"grid",player:"native"}),t,be)},linkType:"direct",multiselect:!0,extensions:["audio"]}):"youtube"===i&&function({attrValue:t,elementRef:e}){if("form-toggle"===t){const t="youtube";$e!==t?(e.classList.add("active"),function(t,e){const n="js-import-form",i=`\n        <form id=${n} class="import-form" data-for="${e}">\n            <input type="text" name="url" class="input" placeholder="URL" required>\n            <button class="btn">Import</button>\n        </form>\n    `;t.insertAdjacentHTML("afterend",i);const o=document.getElementById(n);o.elements.url.focus(),o.addEventListener("submit",He)}(e,t),Be(t),Y()||J()):Oe()}else"google-sign-in-or-out"===t?async function(t){if(!t.disabled){t.disabled=!0;try{const e=gapi.auth2.getAuthInstance();e.isSignedIn.get()?(await e.signOut(),t.textContent="Sign In"):(await e.signIn(),t.textContent="Sign Out")}catch(t){console.log(t)}t.disabled=!1}}(e):"youtube-info"===t&&N(`js-${t}-panel`,Ce,{element:e})}(n)});const on={},rn={};let sn=null,an=null,cn=null,ln={},un=[],dn=0,fn=!1,mn=!1;function pn({id:t,tracks:e}){sn&&(sn.removeEventListener("mousedown",Tn),sn=null),e.length&&(sn=Qn(t)).addEventListener("mousedown",Tn)}function vn(){Bn().forEach(t=>{t.classList.remove("selected")})}function yn(){vn(),hn()}function gn(){mn||(mn=!0,function(){const t="js-move-to-panel-container";document.getElementById("js-playlist-type-btns").insertAdjacentHTML("beforebegin",`\n        <div id="${t}" class="playlist-tab-header-item" data-move-to>\n            <button class="btn-icon" data-item="move-to" title="Move to">\n                <svg viewBox="0 0 24 24">\n                    <path d="M2,16H10V14H2M18,14V10H16V14H12V16H16V20H18V16H22V14M14,6H2V8H14M14,10H2V12H14V10Z" />\n                </svg>\n            </button>\n        </div>\n    `),document.getElementById(t).addEventListener("click",Ge)}(),setTimeout(()=>{window.addEventListener("click",jn,!0)},0),window.addEventListener("keypress",$n))}function hn(){mn&&(mn=!1,function(){const t=document.getElementById("js-move-to-panel-container");t.removeEventListener("click",Ge),r(t)}(),window.removeEventListener("click",jn,!0),window.removeEventListener("keypress",$n))}function bn(t,e){return t>e?e:t<0?0:t}function wn(){clearInterval(dn),dn=0}function En(t){fn=!0,requestAnimationFrame(()=>{cn&&function(t,e,n,i){let o=t.x-e.x,r=t.y-e.y;if(o<0){const t=e.x+o;o*=-1,n.left=t,i.left=`${t}px`}else n.left!==e.x&&(n.left=e.x,i.left=`${e.x}px`);if(r<0){const t=e.y+r;r*=-1,n.top=t,i.top=`${t}px`}else n.top!==e.y&&(n.top=e.y,i.top=`${e.y}px`);n.right=n.left+o,n.bottom=n.top+r,i.width=`${o}px`,i.height=`${r}px`}(rn,on,ln,cn.style),function(t,e,n){for(let i=0;i<t.length;i++){const o=t[i],r=o.ref.classList;e.right>o.left&&e.left<o.right&&e.bottom>o.top&&e.top<o.bottom?(n&&!o.selected&&r.contains("selected")&&(r.remove("selected"),o.removed=!0),o.removed||(r.add("selected"),o.selected=!0)):o.selected?(r.remove("selected"),o.selected=!1):o.removed&&(r.add("selected"),o.removed=!1)}}(un,ln,t),fn=!1})}function Ln(t,e,{scrollHeight:n,height:i}){e.scrollTop+=36,rn.y=e.scrollTop+i,rn.y>=n&&(rn.y=n,wn()),fn||En(t)}function kn(t,e){e.scrollTop-=36,rn.y=e.scrollTop,rn.y<=0&&(rn.y=0,wn()),fn||En(t)}function In(t){const e=an,n=e.top,i=e.left,o=e.width,r=e.height,s=e.scrollHeight,a=t.clientY-n;if(rn.x=bn(t.clientX-i,o),rn.y=bn(sn.scrollTop+a,s),t.preventDefault(),!cn&&function(t,e){return t.x>e.x+2||t.x<e.x-2||t.y>e.y+2||t.y<e.y-2}(rn,on))return un=function(){const t=ti(Zn());return Array.from(t).map(t=>{const e=t.offsetTop,n=t.offsetLeft;return{ref:t,top:e,left:n,right:n+t.offsetWidth,bottom:e+t.offsetHeight}})}(),cn=function(t,{x:e,y:n}){return ln.top=n,ln.left=e,t.insertAdjacentHTML("afterbegin",`\n        <div class="selection-area" style="top: ${n}px; left: ${e}px"></div>\n    `),t.firstElementChild}(sn,on),document.activeElement.blur(),t.ctrlKey||vn(),void hn();if(fn||En(t.ctrlKey),dn&&a>0&&a<r)wn();else if(!dn){let e=null;if(a>r&&rn.y<s)e=Ln;else{if(!(a<0&&rn.y>0))return;e=kn}dn=setInterval(e,40,t.ctrlKey,sn,an)}}function xn({target:t,ctrlKey:e}){if(dn&&wn(),cn){const t=Bn();r(cn),cn=null,ln={},un.length=0,t.length?gn():hn()}else{const n=a("data-index",t,sn);n?function(t,e){if(e||vn(),t.classList.toggle("selected"),t.classList.contains("selected"))gn();else{const e=Bn();t.blur(),e.length||hn()}}(n.elementRef,e):e||yn()}window.removeEventListener("mousemove",In),window.removeEventListener("mouseup",xn)}function jn({target:t}){!a("data-move-to",t)&&c(t,sn)&&yn()}function Tn({currentTarget:t,target:e,which:n,clientX:i,clientY:o}){var r;1===n&&(a("data-btn",e)?yn():(an={top:(r=t).offsetTop,left:r.offsetLeft,width:r.clientWidth,height:r.offsetHeight,scrollHeight:r.scrollHeight},on.x=i-an.left,on.y=t.scrollTop+o-an.top,on.x<an.width&&(window.addEventListener("mousemove",In),window.addEventListener("mouseup",xn))))}function $n({key:t,keyCode:e}){"Delete"!==t&&127!==e||(function(){const t=Bn(),e=Gn(),n=An(t),i=function(t,e){const n=[],i=[];return t.forEach(t=>{e.includes(t.index)?i.push(t):n.push(t)}),{tracksToRemove:i,tracksToKeep:V(n)}}(e.tracks,n),o=i.tracksToKeep,s=i.tracksToRemove;(function(t){t.forEach(r)})(t),function(t,e,n){const i=Math.min(...n),o=Array.from(ti(t)).slice(i);"list"===e?function(t,e){o.forEach((t,n)=>{t.setAttribute("data-index",e+n),t.querySelector(".list-item-index").textContent=e+n+1})}(0,i):function(t,e){o.forEach((t,n)=>{t.setAttribute("data-index",e+n)})}(0,i)}(e.id,e.type,n),x(e.id,{playbackOrder:H(o,v("shuffle")),tracks:o,duration:j(o)}),ki({action:"remove-tracks",playlist:{_id:e._id,tracks:s}}),function(t,e){const n=_();if(n&&B(t)){const i=R(t,n.name);let o=n.index;e.includes(o)||!i?O({index:-1}):O({index:o=i.index}),P(o)}}(e.id,n),o.length||(pn(e),li(e))}(),hn())}function Bn(){return Array.from(sn.querySelectorAll(".track.selected"))}function An(t){return t.map(t=>parseInt(t.getAttribute("data-index"),10))}n(20);const Sn=document.getElementById("js-filter-input"),Mn=Sn.parentElement;let On=0,_n="";function Rn(t,e,n){t.forEach(t=>{const i=e[t.index],o=new RegExp(n,"gi"),r=`\n            ${t.title}\n            ${t.artist}\n            ${t.album}\n        `;o.test(r)?i.classList.remove("hidden"):i.classList.add("hidden")})}function Pn(t,e=""){const n=k(t).tracks;if(!n.length)return;const i=ti(t);_n=e?t:"",Rn(n,i,e),function(t){const e=document.getElementById("js-clear-input-btn");t?e.classList.add("visible"):e.classList.remove("visible")}(e)}function Hn(){_n&&(Sn.value="",Pn(_n))}function Cn(){Sn.classList.remove("active"),Sn.removeEventListener("keyup",Un),window.removeEventListener("click",Vn)}function Vn({target:t}){c(t,Mn)&&Cn()}function Un({target:t}){const e=Zn(),n=t.value.trim().toLowerCase();clearTimeout(On),On=setTimeout(Pn,400,e,n)}function qn(t){document.getElementById("js-order-toggle").querySelector(".js-icon").setAttribute("href",`#${1===t?"down":"up"}-arrow`)}function Dn(t,e){return"index"===t?e.primaryIndex:"duration"===t?e.durationInSeconds:e[t].toLowerCase()}function zn(t,e,n){t.sort((t,i)=>{const o=Dn(e,t),r=Dn(e,i);return o<r?-n:o>r?n:0})}function Fn(t,e){const n=document.getElementById("js-filter-input").value,i=t.sortedBy===e&&1===t.order?-1:1;if(zn(t.tracks,e,i),x(t.id,{order:i,sortedBy:e,tracks:V(t.tracks)}),ki({action:"change-sorting",playlist:{order:i,_id:t._id,sortedBy:e}}),li(t),yi(t),n){const e=ti(t.id);Rn(t.tracks,e,n)}}function Nn({sortedBy:t,order:e}){var n;n=t,document.getElementById("js-sort-toggle").textContent=o(n),qn(e)}function Kn(t,{sortedBy:e}){document.getElementById("js-sort-panel-container").insertAdjacentHTML("beforeend",function(t,e){return`<ul id="${t}" class="panel sort-panel">${function(t){return["index","name","title","artist","album","duration"].reduce((e,n)=>`\n            ${e}\n            <li>\n                <button class="btn sort-option-btn${n===t?" active":""}" data-sort="${n}">\n                    ${o(n)}\n                </button>\n            </li>\n        `,"")}(e)}</ul>`}(t,e)),document.getElementById(t).addEventListener("click",Wn)}function Wn({currentTarget:t,target:e}){const n=e.getAttribute("data-sort"),i=Gn();t.removeEventListener("click",Wn),z(),n!==i.sortedBy&&(Nn({sortedBy:n,order:1}),Fn(i,n))}Sn.addEventListener("focus",({currentTarget:t})=>{t.classList.add("active"),t.addEventListener("keyup",Un),window.addEventListener("click",Vn)}),Mn.addEventListener("click",({target:t})=>{const e=a("data-filter-item",t);if(!e)return;const n=e.attrValue;"icon"===n?Sn.focus():"button"===n&&(Hn(),Cn())});const Xn=document.getElementById("js-tab-header"),Yn=matchMedia("(max-width: 540px)");let Jn="";function Zn(){return Jn}function Gn(){return k(Jn)}function Qn(t){return document.getElementById(`js-tab-${t}`)}function ti(t){return document.getElementById(`js-${t}`).children}function ei(t,e){return ti(t)[e]}function ni(t){const e=k(t.playlistId);if(-1!==t.index&&e.rendered)return ei(t.playlistId,t.index).querySelector(".btn-icon")}function ii(t){return`\n        <li class="list-item track" data-index="${t.index}" tabindex="0">\n            <span class="list-item-first-col">\n                <span class="list-item-index">${t.index+1}</span>\n                <button class="btn-icon track-play-pause-btn" data-btn="play" title="Play">\n                    <svg viewBox="0 0 24 24">\n                        <use class="js-icon" href="#play"></use>\n                    </svg>\n                </button>\n            </span>\n            <span class="list-item-col">${t.title}</span>\n            <span class="list-item-col">${t.artist}</span>\n            <span class="list-item-col">${t.album}</span>\n            <span class="list-item-last-col">${t.duration}</span>\n        </li>\n    `}function oi(t){return`\n        <li class="grid-item track" data-index="${t.index}" tabindex="0">\n            <div class="artwork-container grid-item-first-col" tabindex="-1">\n                <button class="btn-icon track-play-pause-btn artwork-container-btn" data-btn="play" title="Play">\n                    <svg viewBox="0 0 24 24">\n                        <use class="js-icon" href="#play"></use>\n                    </svg>\n                </button>\n                <img src="${d(t.thumbnail)}" class="artwork" alt="">\n            </div>\n            ${ai(t)}\n            <div class="grid-item-duration">${t.duration}</div>\n        </li>\n    `}function ri(t,e){return t.map(e).join("")}function si(t){return t.tracks.length?function({id:t,type:e,tracks:n}){return"list"===e?function(t,e){return`\n        <ul class="list-view-header">\n            <li class="list-item-first-col">#</li>\n            <li class="list-item-col">Title</li>\n            <li class="list-item-col">Artist</li>\n            <li class="list-item-col">Album</li>\n            <li class="list-item-last-col">Duration</li>\n        </ul>\n        <ul id="js-${t}" class="playlist-view">${ri(n,ii)}</ul>\n    `}(t):function(t,e){return`<ul id="js-${t}" class="playlist-view grid-view">${ri(n,oi)}</ul>`}(t)}(t):'<p class="playlist-message">This playlist is empty</p>'}function ai(t,e=""){let n=t.name;return t.artist&&t.title&&(n=`\n            <div class="track-title">${t.title}</div>\n            <div class="track-artist">${t.artist} ${t.album?`- ${t.album}`:""}</div>\n        `),`<div id="${e}" class="track-name">${n}</div>`}function ci(t){const e=_();e&&e.playlistId===t&&-1!==e.index&&requestAnimationFrame(()=>{ui(t,e.index,{scrollToTrack:!0}),di(e,ne())})}function li(t){Qn(t.id).innerHTML=si(t),ci(t.id)}function ui(t,e,{scrollToTrack:n}={}){const i=ei(t,e);s(".track.playing","playing"),i.classList.add("playing"),n&&function(t,e){const n=document.getElementById(`js-tab-${e}`),i=t.offsetHeight,o=t.offsetTop,r=n.scrollTop,s=n.clientHeight;(o-i<r||o>r+s)&&(n.scrollTop=o-s/2)}(i,t)}function di(t,e){const n=ni(t);n&&ot(n,e)}function fi(t){const e=document.getElementById("js-list-toggle-btn"),n=document.getElementById("js-grid-toggle-btn");"list"===t?(e.classList.add("active"),n.classList.remove("active")):(n.classList.add("active"),e.classList.remove("active"))}function mi(t,e){x(e.id,{type:t}),ki({action:"change-type",playlist:{_id:e._id,type:t}}),li(e),pn(e),fi(t)}function pi(t){C(t,v("shuffle")),zn(t.tracks,t.sortedBy,t.order),t.tracks=V(t.tracks)}function vi(t){var e,n,i;t.initialized=!0,h(e=`playlist/${t.id}`)||g.push(e),n=t.title,i=t.id,document.getElementById("js-sidebar-entries").insertAdjacentHTML("beforeend",`\n        <li id="js-sidebar-entry-${i}" class="sidebar-entry">\n            <a href="./#/playlist/${i}" class="sidebar-link" data-link>${n}</a>\n        </li>\n    `),function(t){const e=function(){const t="js-pl-entries";return document.getElementById(t)||function(t){document.getElementById("js-tab-home").insertAdjacentHTML("beforeend",`\n        <div class="pl-entry-container">\n            <h2 class="home-tab-section-title">Playlists</h2>\n            <ul id="${t}"></ul>\n        </div>\n    `);const e=document.getElementById(t);return e.addEventListener("click",Ye),e.addEventListener("focus",Je,!0),e}(t)}(),n=t.url?ze({action:"sync",title:"Synchronize playlist",iconId:"sync"}):"",i=t.url?`\n        <div class="pl-entry-panel-container">\n            ${ze({action:"settings",title:"Settings",iconId:"settings"})}\n        </div>\n    `:"",o=ze({action:"remove",title:"Remove playlist",iconId:"trash"});e.insertAdjacentHTML("beforeend",`\n        <li class="pl-entry" data-entry-id=${t.id}>\n            <div class="pl-entry-input-container" data-action="edit">\n                <input type="text" class="input pl-entry-input" value="${t.title}">\n                <svg viewBox="0 0 24 24" class="pl-entry-input-icon">\n                    <use href="#edit">\n                </svg>\n            </div>\n            <div class="pl-entry-content">\n                <div class="pl-entry-stats">\n                    ${t.isPrivate?'\n        <svg viewBox="0 0 24 24" class="pl-entry-stats-item">\n            <use href="#lock"></use>\n        </svg>\n    ':""}\n                    <span class="pl-entry-stats-item track-count">${t.tracks.length} tracks</span>\n                    <span class="pl-entry-stats-item playlist-duration">${Fe(t.duration)}</span>\n                </div>\n                ${n}\n                ${i}\n                ${o}\n            </div>\n        </li>\n    `)}(t),pi(t)}function yi(t){const e=_();if(e&&B(t.id)){const n=R(t.id,e.name);let i=-1;n?i=n.index:s(".track.playing","playing"),O({index:i}),P(i)}}function gi(t,e,n){var i;e.length&&(e=function(t,e=0){return t.map((t,n)=>(t.primaryIndex=e+n,t))}(e,t.lastTrackIndex),t.lastTrackIndex=e[e.length-1].primaryIndex+1,t.tracks=t.tracks.concat(e),t.duration=j(t.tracks)),t.initialized?(Ei(t.id),pi(t),yi(t),t.rendered&&li(t),ki({action:"add-tracks",playlist:{_id:t._id,tracks:e}})):(vi(t),ki({action:"add",playlist:t})),n&&(i=`playlist/${t.id}`,window.location.hash=`/${i}`),De()}function hi(t){const e=I({title:t.target.title.value,id:Math.random().toString(36).slice(2),type:"grid"});vi(e),ki({action:"add",playlist:e}),t.preventDefault(),t.target.reset()}function bi(t,e,n,i){e.insertAdjacentHTML(n,`\n        <form id="js-${t}-form" class="${t}-form">\n            <input type="text" name="title" class="input" autocomplete="off" placeholder="Playlist title" required>\n            <button class="btn">Create</button>\n        </form>\n    `);const o=document.getElementById(`js-${t}-form`);o.elements.title.focus(),o.addEventListener("submit",i)}function wi(t){U(t).classList.add("show-spinner"),qe(t)}function Ei(t){U(t).classList.remove("show-spinner"),Ue(t)}Xn.addEventListener("click",({currentTarget:t,target:e})=>{const n=a("data-item",e,t);if(!n)return;const i=Gn(),o=n.attrValue;"move-to"===o?N("js-move-to-panel",nn,{playlistId:i.id,element:n.elementRef}):"list"!==o&&"grid"!==o||o===i.type?"sorting"===o?N("js-sort-panel",Kn,{sortedBy:i.sortedBy,element:n.elementRef}):"order"===o&&i.sortedBy?(Fn(i=i,i.sortedBy),qn(i.order)):"sidebar"===o&&document.getElementById("js-sidebar-container").classList.remove("hidden"):mi(o,i)}),window.addEventListener("route-change",({detail:{isPlaylistTab:t,tabId:e}})=>{const n=Jn,i=document.getElementById(`js-tab-${n}`);s(".sidebar-entry.active","active"),s(".tab.active","active"),function(t=""){Jn=t}(t?e:""),i&&i.removeEventListener("click",le),t?(function(t){const e=k(t);e.rendered||function(t){const e=function(t){const e=si(t);return`<div id="js-tab-${t.id}" class="tab">${e}</div>`}(t),n=document.getElementById("js-tabs");t.rendered=!0,n.insertAdjacentHTML("beforeend",e),ci(t.id)}(e),"list"===e.type&&Yn.matches?mi("grid",e):fi(e.type),Nn(e),pn(e),Hn(),e.tracks.length&&Qn(t).addEventListener("click",le)}(e),Xn.classList.add("playlist-tab-active")):(De(),Xn.classList.remove("playlist-tab-active")),Qn(e).classList.add("active"),"not-found"!==e&&U(e).classList.add("active")}),Yn.onchange=function({matches:t}){const e=Gn();t&&e&&"list"===e.type&&mi("grid",e)};const Li=new Worker("./ww.js");function ki(t){Li.postMessage(t)}Li.onmessage=function({data:{action:t,payload:e}}){"init"===t?(e.forEach(t=>{vi(I(t))}),Ke(e.filter(t=>t.syncOnInit)),b(),ee.initTrack()):"update"===t&&x(e.id,e)},Li.onerror=function(t){console.log(t)}},function(t,e,n){"use strict";var i=n(2);t.exports=function(t,e){return!!t&&i(function(){e?t.call(null,function(){},1):t.call(null)})}},function(t,e,n){var i=n(10);t.exports=function(t){return Object(i(t))}},function(t,e,n){var i=n(8);t.exports=function(t,e,n){if(i(t),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,i){return t.call(e,n,i)};case 3:return function(n,i,o){return t.call(e,n,i,o)}}return function(){return t.apply(e,arguments)}}},function(t,e,n){var i=n(1),o=n(11),r=n(6),s=n(13),a=n(18),c=function(t,e,n){var l,u,d,f,m=t&c.F,p=t&c.G,v=t&c.S,y=t&c.P,g=t&c.B,h=p?i:v?i[e]||(i[e]={}):(i[e]||{}).prototype,b=p?o:o[e]||(o[e]={}),w=b.prototype||(b.prototype={});for(l in p&&(n=e),n)d=((u=!m&&h&&void 0!==h[l])?h:n)[l],f=g&&u?a(d,i):y&&"function"==typeof d?a(Function.call,d):d,h&&s(h,l,d,t&c.U),b[l]!=d&&r(b,l,f),y&&w[l]!=d&&(w[l]=d)};i.core=o,c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,t.exports=c},function(t,e,n){"use strict";var i=n(19),o=n(8),r=n(17),s=n(2),a=[].sort,c=[1,2,3];i(i.P+i.F*(s(function(){c.sort(void 0)})||!s(function(){c.sort(null)})||!n(16)(a)),"Array",{sort:function(t){return void 0===t?a.call(r(this)):a.call(r(this),o(t))}})},function(t,e,n){n(7)("match",1,function(t,e,n){return[function(n){"use strict";var i=t(this),o=void 0==n?void 0:n[e];return void 0!==o?o.call(n,i):new RegExp(n)[e](String(i))},n]})},,,function(t,e,n){n(7)("replace",2,function(t,e,n){return[function(i,o){"use strict";var r=t(this),s=void 0==i?void 0:i[e];return void 0!==s?s.call(i,r,o):n.call(String(r),i,o)},n]})},function(t,e){var n={}.toString;t.exports=function(t){return n.call(t).slice(8,-1)}},function(t,e,n){var i=n(5),o=n(25),r=n(9)("match");t.exports=function(t){var e;return i(t)&&(void 0!==(e=t[r])?!!e:"RegExp"==o(t))}},function(t,e,n){var i=n(1),o=i["__core-js_shared__"]||(i["__core-js_shared__"]={});t.exports=function(t){return o[t]||(o[t]={})}},function(t,e){var n={}.hasOwnProperty;t.exports=function(t,e){return n.call(t,e)}},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e,n){var i=n(5);t.exports=function(t,e){if(!i(t))return t;var n,o;if(e&&"function"==typeof(n=t.toString)&&!i(o=n.call(t)))return o;if("function"==typeof(n=t.valueOf)&&!i(o=n.call(t)))return o;if(!e&&"function"==typeof(n=t.toString)&&!i(o=n.call(t)))return o;throw TypeError("Can't convert object to primitive value")}},function(t,e,n){var i=n(5),o=n(1).document,r=i(o)&&i(o.createElement);t.exports=function(t){return r?o.createElement(t):{}}},function(t,e,n){t.exports=!n(4)&&!n(2)(function(){return 7!=Object.defineProperty(n(31)("div"),"a",{get:function(){return 7}}).a})},function(t,e,n){var i=n(5);t.exports=function(t){if(!i(t))throw TypeError(t+" is not an object!");return t}},function(t,e,n){!function(){"use strict";!function(t){var e;function n(){e||(e=!0,t())}"complete"===document.readyState?t():(e=!1,document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1))}(function(){var t=!0,e=!1,n=null,i={text:!0,search:!0,url:!0,tel:!0,email:!0,password:!0,number:!0,date:!0,month:!0,week:!0,time:!0,datetime:!0,"datetime-local":!0};function o(e){t=!1}function r(){document.addEventListener("mousemove",s),document.addEventListener("mousedown",s),document.addEventListener("mouseup",s),document.addEventListener("pointermove",s),document.addEventListener("pointerdown",s),document.addEventListener("pointerup",s),document.addEventListener("touchmove",s),document.addEventListener("touchstart",s),document.addEventListener("touchend",s)}function s(e){"html"!==e.target.nodeName.toLowerCase()&&(t=!1,document.removeEventListener("mousemove",s),document.removeEventListener("mousedown",s),document.removeEventListener("mouseup",s),document.removeEventListener("pointermove",s),document.removeEventListener("pointerdown",s),document.removeEventListener("pointerup",s),document.removeEventListener("touchmove",s),document.removeEventListener("touchstart",s),document.removeEventListener("touchend",s))}document.addEventListener("keydown",function(e){e.altKey||e.ctrlKey||e.metaKey||(t=!0)},!0),document.addEventListener("mousedown",o,!0),document.addEventListener("pointerdown",o,!0),document.addEventListener("touchstart",o,!0),document.addEventListener("focus",function(e){var n,o,r;e.target!=document&&"HTML"!=e.target.nodeName&&(t||(o=(n=e.target).type,"INPUT"==(r=n.tagName)&&i[o]&&!n.readonly||"TEXTAREA"==r&&!n.readonly||"true"==n.contentEditable))&&(function(t){t.classList.contains("focus-visible")||(t.classList.add("focus-visible"),t.setAttribute("data-focus-visible-added",""))}(e.target),t=!1)},!0),document.addEventListener("blur",function(t){var i;t.target!=document&&"HTML"!=t.target.nodeName&&t.target.classList.contains("focus-visible")&&(e=!0,window.clearTimeout(n),n=window.setTimeout(function(){e=!1,window.clearTimeout(n)},100),(i=t.target).hasAttribute("data-focus-visible-added")&&(i.classList.remove("focus-visible"),i.removeAttribute("data-focus-visible-added")))},!0),document.addEventListener("visibilitychange",function(n){"hidden"==document.visibilityState&&(e&&(t=!0),r())},!0),r(),document.body.classList.add("js-focus-visible")})}()},,,,,function(t,e){}]);